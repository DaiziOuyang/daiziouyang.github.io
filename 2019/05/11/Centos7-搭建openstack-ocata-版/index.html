<!DOCTYPE html>
<html class="theme-next pisces use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">
<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
  <meta name="google-site-verification" content="dYiRwj1ulGaUvTQRrCjJA9YKnNF8JN4wRKXzdbE6wBc" />
  <meta name="msvalidate.01" content="true" />
  <meta name="yandex-verification" content="true" />
  <meta name="baidu-site-verification" content="{ theme.baidu_site_verification }" />
  <meta name="360-site-verification" content="theme.qihu_site_verification" />
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />
<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />
<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">
  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">
  <meta name="keywords" content="欧阳博客, 欧阳Blog,欧阳seo,www.5658.pw,5658,5658.pw,欧阳,欧阳博客,欧阳SEO,欧阳网络,ddos,黑客,欧阳工作室,欧阳社区,欧阳论坛,欧阳家族,欧阳,挖矿" />
  <link rel="alternate" href="/atom.xml" title="欧阳博客" type="application/atom+xml" />
<meta name="description" content="一、openstack 介绍 123456789101112131415161718192021OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，项目目标是提供实施简单、可">
<meta property="og:type" content="article">
<meta property="og:title" content="Centos7 搭建openstack ocata 版">
<meta property="og:url" content="https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/index.html">
<meta property="og:site_name" content="欧阳博客">
<meta property="og:description" content="一、openstack 介绍 123456789101112131415161718192021OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，项目目标是提供实施简单、可">
<meta property="og:locale" content="zh-Hans">
<meta property="og:image" content="http://yun.name168.cn/OpenStack001.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack002.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack003.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack004.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack005.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack006.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack007.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack008.png">
<meta property="og:image" content="http://yun.name168.cn/OpenStack009.png">
<meta property="og:updated_time" content="2019-05-11T05:42:06.151Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Centos7 搭建openstack ocata 版">
<meta name="twitter:description" content="一、openstack 介绍 123456789101112131415161718192021OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，项目目标是提供实施简单、可">
<meta name="twitter:image" content="http://yun.name168.cn/OpenStack001.png">
<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '5.1.4',
    sidebar: {"position":"left","display":"always","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>
  <link rel="canonical" href="https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/"/>
  <title>Centos7 搭建openstack ocata 版 | 欧阳博客</title>
</head>
<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">欧阳博客</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
        <h1 class="site-subtitle" itemprop="description">三分孤独,七分狂傲</h1>
  </div>
  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>
<nav class="site-nav">
    <ul id="menu" class="menu">
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            首页
          </a>
        </li>
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            标签
          </a>
        </li>
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            分类
          </a>
        </li>
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            归档
          </a>
        </li>
        <li class="menu-item menu-item-resources">
          <a href="/buddy" rel="section">
              <i class="menu-item-icon fa fa-fw fa-american-sign-language-interpreting"></i> <br />
            小伙伴
          </a>
        </li>
        <li class="menu-item menu-item-娱乐">
          <a href="/entertainment" rel="section">
              <i class="menu-item-icon fa fa-fw fa-gamepad"></i> <br />
            娱乐
          </a>
        </li>
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            关于
          </a>
        </li>
        <li class="menu-item menu-item-search">
            <a href="javascript:;" class="popup-trigger">
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            搜索
          </a>
        </li>
    </ul>
    <div class="site-search">
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>
    </div>
</nav>
 </div>
    </header>
    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
  <div id="posts" class="posts-expand">
  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/">
    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="欧阳 Blog">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.png">
    </span>
    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="欧阳博客">
    </span>
      <header class="post-header">
          <h2 class="post-title" itemprop="name headline">Centos7 搭建openstack ocata 版</h2>
        <div class="post-meta">
          <span class="post-time">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
                <span class="post-meta-item-text">发表于</span>
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2019-05-11T13:21:57+08:00">
                2019-05-11
              </time>
          </span>
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/05/11/Centos7-搭建openstack-ocata-版/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count valine-comment-count" data-xid="/2019/05/11/Centos7-搭建openstack-ocata-版/" itemprop="commentCount"></span>
                </a>
              </span>
            <span class="post-meta-divider">|</span>
            <span class="page-pv"><i class="fa fa-file-o"></i> 浏览
            <span class="busuanzi-value" id="busuanzi_value_page_pv" ></span>次
            </span>
            <div class="post-wordcount">
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                  <span class="post-meta-item-text">字数统计&#58;</span>
                <span title="字数统计">
                  8.4k
                </span>
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                <span title="阅读时长">
                  44
                </span>
            </div>
        </div>
      </header>
    <div class="post-body" itemprop="articleBody">
        <p><strong>一、openstack 介绍</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">OpenStack是一个由NASA（美国国家航空航天局）和Rackspace合作研发并发起的，以Apache许可证授权的自由软件和开放源代码项目。</span><br><span class="line"></span><br><span class="line">OpenStack是一个开源的云计算管理平台项目，由几个主要的组件组合起来完成具体工作。OpenStack支持几乎所有类型的云环境，</span><br><span class="line"></span><br><span class="line">项目目标是提供实施简单、可大规模扩展、丰富、标准统一的云计算管理平台。OpenStack通过各种互补的服务提供了基础设施即服务（IaaS）的解决方案，</span><br><span class="line"></span><br><span class="line">每个服务提供API以进行集成。</span><br><span class="line"></span><br><span class="line">OpenStack是一个旨在为公共及私有云的建设与管理提供软件的开源项目。它的社区拥有超过<span class="number">130</span>家企业及<span class="number">1350</span>位开发者，</span><br><span class="line"></span><br><span class="line">这些机构与个人都将OpenStack作为基础设施即服务（IaaS）资源的通用前端。OpenStack项目的首要任务是简化云的部署过程并为其带来良好的可扩展性。</span><br><span class="line"></span><br><span class="line">本文希望通过提供必要的指导信息，帮助大家利用OpenStack前端来设置及管理自己的公共云或私有云。</span><br><span class="line"></span><br><span class="line">OpenStack云计算平台，帮助服务商和企业内部实现类似于 Amazon EC2 和 S3 的云基础架构服务(Infrastructure <span class="keyword">as</span> a Service, IaaS)。</span><br><span class="line"></span><br><span class="line">OpenStack 包含两个主要模块：Nova 和 Swift，前者是 NASA 开发的虚拟服务器部署和业务计算模块；后者是 Rackspace开发的分布式云存储模块，</span><br><span class="line"></span><br><span class="line">两者可以一起用，也可以分开单独用。OpenStack除了有 Rackspace 和 NASA 的大力支持外，还有包括 Dell、Citrix、 Cisco、 Canonical等重量级公司的贡献和支持，</span><br><span class="line"></span><br><span class="line">发展速度非常快，有取代另一个业界领先开源云平台 Eucalyptus 的态势。</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>官方文档地址：<a href="https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html&gt;" target="_blank" rel="noopener">https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html&gt;</a></p>
<h1 id="二、基础环境"><a href="#二、基础环境" class="headerlink" title="二、基础环境"></a><strong>二、基础环境</strong></h1><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">系统版本： Centos7<span class="number">.3</span>  两块网卡(eth0,eth1)</span><br><span class="line"></span><br><span class="line">机器的配置： <span class="number">4</span>G <span class="number">50</span>G硬盘（两块） <span class="number">4</span>个CPU</span><br><span class="line"></span><br><span class="line">机器名： linux-node1（计算节点）</span><br><span class="line"></span><br><span class="line">机器名： linux-node2（控制节点）</span><br><span class="line"></span><br><span class="line">Node2 IP：eth0 <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span>， eth1:<span class="number">192.168</span><span class="number">.57</span><span class="number">.146</span></span><br><span class="line"></span><br><span class="line">Node1IP:  eth0: <span class="number">192.168</span><span class="number">.57</span><span class="number">.142</span>  eth1:<span class="number">192.168</span><span class="number">.57</span><span class="number">.143</span></span><br><span class="line"></span><br><span class="line">主控制节点主要安装如下：（keystone、Glance、nova、networking、Dashboard）</span><br><span class="line"></span><br><span class="line">计算节点主要安装如下：（nova、networking）</span><br></pre></td></tr></table></figure>
<h2 id="2-1-时间同步（node1-node2-操作）"><a href="#2-1-时间同步（node1-node2-操作）" class="headerlink" title="2.1 时间同步（node1 +node2 操作）"></a><strong>2.1 时间同步（node1 +node2 操作）</strong></h2><p><a href="https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html" target="_blank" rel="noopener">https://docs.openstack.org/ocata/install-guide-rdo/glance-install.html</a></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">node1 </span><br><span class="line"># yum install chrony</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line">设置</span><br><span class="line">allow <span class="number">192.168</span><span class="number">.57</span><span class="number">.0</span>/<span class="number">24</span></span><br><span class="line">####启动</span><br><span class="line">[root@linux-node2 ~]# systemctl enable chronyd.service</span><br><span class="line">[root@linux-node2 ~]#systemctl start chronyd.service</span><br><span class="line">########node1 的时间先同步一下标准时间</span><br><span class="line">[root@linux-node2 ~]# ntpdate pool.ntp.org</span><br><span class="line"># chronyc sources</span><br><span class="line">node2 </span><br><span class="line">修改主配置文件</span><br><span class="line">vim /etc/chrony.conf</span><br><span class="line">把所有行去掉</span><br><span class="line">添加一行</span><br><span class="line">Server <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span> iburst</span><br><span class="line">[root@linux-node2 ~]#systemctl start chronyd.service</span><br><span class="line"># chronyc sources</span><br></pre></td></tr></table></figure>
<h2 id="2-2-安装mysql（node2主控制节点操作）"><a href="#2-2-安装mysql（node2主控制节点操作）" class="headerlink" title="2.2 安装mysql（node2主控制节点操作）"></a><strong>2.2 安装mysql（node2主控制节点操作）</strong></h2><p>*配置一下mysql</p>
<p>添加文件/etc/my.cnf.d/openstack.cnf 内容如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"> [mysqld]</span><br><span class="line">bind-address = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line"><span class="keyword">default</span>-storage-engine = innodb</span><br><span class="line">innodb_file_per_table</span><br><span class="line">collation-server =utf8_general_ci</span><br><span class="line">init-connect = <span class="string">'SET NAMES utf8'</span></span><br><span class="line">character-set-server = utf8</span><br></pre></td></tr></table></figure>
<p>重启一下mysql</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl enable mariadb.service</span><br><span class="line">[root@linux-node2 ~]# systemctl start mariadb.service</span><br></pre></td></tr></table></figure>
<p>设置root密码</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# mysql_secure_installation</span><br></pre></td></tr></table></figure>
<p>创建数据库</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "Create database keystone;"</span><br><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "grant all privileges on keystone.* to 'keystone'@'%' identified by 'keystone'"</span><br><span class="line">[root@linux-node2 ~]# mysql -uroot -p123456 -e "grant all privileges on keystone.* to 'keystone'@'localhost' identified by 'keystone'"</span><br></pre></td></tr></table></figure>
<h2 id="2-3-安装消息队列（node2控制节点操作）"><a href="#2-3-安装消息队列（node2控制节点操作）" class="headerlink" title="2.3 安装消息队列（node2控制节点操作）"></a><strong>2.3 安装消息队列（node2控制节点操作）</strong></h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install rabbitmq-server</span><br></pre></td></tr></table></figure>
<p>启动</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable rabbitmq-server.service</span><br><span class="line"># systemctl start rabbitmq-server.service</span><br></pre></td></tr></table></figure>
<p>新建用户</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># rabbitmqctl add_user openstack openstack</span><br></pre></td></tr></table></figure>
<p>对用户授权</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">rabbitmqctl set_permissions openstack <span class="string">".*"</span> <span class="string">".*"</span> <span class="string">".*"</span></span><br></pre></td></tr></table></figure>
<p>查看插件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# rabbitmq-plugins list</span><br><span class="line">[ ] amqp_client                       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] cowboy                            <span class="number">0.5</span><span class="number">.0</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git4b93c2d</span><br><span class="line">[ ] eldap                             <span class="number">3.3</span><span class="number">.5</span>-gite309de4</span><br><span class="line">[ ] mochiweb                          <span class="number">2.7</span><span class="number">.0</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git680dba8</span><br><span class="line">[ ] rabbitmq_amqp1_0                  <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_auth_backend_ldap        <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_auth_mechanism_ssl       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_consistent_hash_exchange <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_federation               <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_federation_management    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management               <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management_agent         <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_management_visualiser    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_mqtt                     <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_shovel                   <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_shovel_management        <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_stomp                    <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_test                     <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_tracing                  <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_dispatch             <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_stomp                <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] rabbitmq_web_stomp_examples       <span class="number">3.3</span><span class="number">.5</span></span><br><span class="line">[ ] sockjs                            <span class="number">0.3</span><span class="number">.4</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-git3132eb9</span><br><span class="line">[ ] webmachine                        <span class="number">1.10</span><span class="number">.3</span>-rmq3<span class="number">.3</span><span class="number">.5</span>-gite9359c7</span><br></pre></td></tr></table></figure>
<p>启用web插件</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# rabbitmq-plugins enable rabbitmq_management</span><br></pre></td></tr></table></figure>
<p>重启一下</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl restart rabbitmq-server.service</span><br></pre></td></tr></table></figure>
<p>检查是否启动成功</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# netstat -nltp |grep 5672</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">15672</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">25672</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">5672</span>                 :::*                    LISTEN      <span class="number">16686</span>/beam.smp      </span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure>
<p>Web访问</p>
<p><a href="http://192.168.57.138:15672/#/" target="_blank" rel="noopener">http://192.168.57.138:15672/#/</a></p>
<p>用户名密码为guest</p>
<h1 id="三、搭建openstack"><a href="#三、搭建openstack" class="headerlink" title="三、搭建openstack"></a><strong>三、搭建openstack</strong></h1><h2 id="3-1-安装keystone-组件介绍"><a href="#3-1-安装keystone-组件介绍" class="headerlink" title="3.1 安装keystone 组件介绍"></a><strong>3.1 安装keystone 组件介绍</strong></h2><p><strong>Keystone功能：</strong></p>
<p><strong>1. 用户与认证: 用户权限与用户行为跟踪</strong></p>
<p><strong>2. 服务目录：提供一个服务目录、包括所有服务项与相关API的端点</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Keystone名词：</span><br><span class="line">User： 用户</span><br><span class="line">Tenant： 租户/项目</span><br><span class="line">Token： 令牌</span><br><span class="line">Role： 角色</span><br><span class="line">Service： 服务</span><br><span class="line">Endpoint： 端点</span><br></pre></td></tr></table></figure>
<h2 id="3-2-安装keystone-组件（node2-主控制节点操作）"><a href="#3-2-安装keystone-组件（node2-主控制节点操作）" class="headerlink" title="3.2 安装keystone 组件（node2 主控制节点操作）"></a><strong>3.2 安装keystone 组件（node2 主控制节点操作）</strong></h2><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">安装openstack最新的源：</span><br><span class="line">　　　　#yum install centos-release-openstack-ocata </span><br><span class="line">　　　　#yum install https://rdoproject.org/repos/rdo-release.rpm </span><br><span class="line">　　　　#yum upgrade                                               (在主机上升级包）</span><br><span class="line">　　　　#yum install python-openstackclient            （安装opentack必须的插件）</span><br><span class="line">　　　　#yum install openstack-selinux                    （可选则安装这个插件，我直接关闭了selinux，因为不熟，对后续不会有影响）</span><br><span class="line"> [root@linux-node1 home]# yum install openstack-keystone httpd mod_wsgi</span><br></pre></td></tr></table></figure>
<h3 id="3-2-1修改配置文件"><a href="#3-2-1修改配置文件" class="headerlink" title="3.2.1修改配置文件"></a><strong>3.2.1修改配置文件</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/keystone/keystone.conf</span><br><span class="line">[database]</span><br><span class="line">connection = mysql:<span class="comment">//keystone:keystone@192.168.57.145/keystone </span></span><br><span class="line">[token]</span><br><span class="line">provider = fernet</span><br></pre></td></tr></table></figure>
<h3 id="3-2-2同步数据库"><a href="#3-2-2同步数据库" class="headerlink" title="3.2.2同步数据库"></a><strong>3.2.2同步数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">"keystone-manage db_sync"</span> keystone</span><br><span class="line">###为什么需要su 一下呢？因为在写日志的时候文件是放在/var/log/keystone 这个下面如果是root用户执行的话。那么写日志的时候就会写不进去。</span><br><span class="line">验证一下是否成功。进入数据库查看有没有表的建立。</span><br><span class="line">MariaDB [keystone]&gt; show tables;</span><br><span class="line">+------------------------+</span><br><span class="line">| Tables_in_keystone     |</span><br></pre></td></tr></table></figure>
<p>初始化</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># keystone-manage fernet_setup --keystone-user keystone --keystone-group keystone</span><br><span class="line"># keystone-manage credential_setup --keystone-user keystone --keystone-group keystone</span><br></pre></td></tr></table></figure>
<p>引导身份信息</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">keystone-manage bootstrap --bootstrap-password admin \</span><br><span class="line">  --bootstrap-admin-url http:<span class="comment">//linux-node2:35357/v3/ \</span></span><br><span class="line">  --bootstrap-internal-url http:<span class="comment">//linux-node2:5000/v3/ \</span></span><br><span class="line">  --bootstrap-public-url http:<span class="comment">//linux-node2:5000/v3/ \</span></span><br><span class="line">  --bootstrap-region-id RegionOne</span><br></pre></td></tr></table></figure>
<h3 id="3-2-3配置memcache的配置-（-etc-sysconfig-memcached-）"><a href="#3-2-3配置memcache的配置-（-etc-sysconfig-memcached-）" class="headerlink" title="3.2.3配置memcache的配置 （**/etc/sysconfig/memcached**）"></a><strong>3.2.3配置memcache的配置 （**</strong>/etc/sysconfig/memcached<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/sysconfig/memcached</span><br><span class="line">OPTIONS=<span class="string">"-l 127.0.0.1,::1,192.168.57.145"</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-4启动memcache"><a href="#3-2-4启动memcache" class="headerlink" title="3.2.4启动memcache"></a><strong>3.2.4启动memcache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# systemctl start memcached.service</span><br><span class="line"> [root@linux-node2 ~]# netstat -nltp|grep 121</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:<span class="number">11211</span>           <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span>:*               LISTEN      <span class="number">20054</span>/memcached     </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">11211</span>                :::*                    LISTEN      <span class="number">20054</span>/memcached</span><br></pre></td></tr></table></figure>
<h3 id="3-2-5设置apache"><a href="#3-2-5设置apache" class="headerlink" title="3.2.5设置apache"></a><strong>3.2.5设置apache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ln -s /usr/share/keystone/wsgi-keystone.conf /etc/httpd/conf.d/</span><br></pre></td></tr></table></figure>
<h3 id="3-2-6修改主apache的主配置文件"><a href="#3-2-6修改主apache的主配置文件" class="headerlink" title="3.2.6修改主apache的主配置文件"></a><strong>3.2.6修改主apache的主配置文件</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">vim /etc/httpd/conf/httpd.conf</span><br><span class="line">配置一下Servername</span><br><span class="line">ServerName <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span>:<span class="number">80</span></span><br></pre></td></tr></table></figure>
<h3 id="3-2-7启动apache"><a href="#3-2-7启动apache" class="headerlink" title="3.2.7启动apache"></a><strong>3.2.7启动apache</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">systemctl enable httpd.service</span><br><span class="line">systemctl start httpd.service</span><br></pre></td></tr></table></figure>
<h3 id="3-2-8检查一下是否启动成功了"><a href="#3-2-8检查一下是否启动成功了" class="headerlink" title="3.2.8检查一下是否启动成功了"></a><strong>3.2.8检查一下是否启动成功了</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 conf.d]# netstat -nltp|grep httpd</span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">80</span>                   :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">35357</span>                :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">tcp6       <span class="number">0</span>      <span class="number">0</span> :::<span class="number">5000</span>                 :::*                    LISTEN      <span class="number">20253</span>/httpd         </span><br><span class="line">[root@linux-node2 conf.d]#</span><br></pre></td></tr></table></figure>
<h2 id="3-3-keystone-用户权限"><a href="#3-3-keystone-用户权限" class="headerlink" title="3.3   keystone 用户权限"></a><strong>3.3   keystone 用户权限</strong></h2><h3 id="3-3-1-设置环境变量"><a href="#3-3-1-设置环境变量" class="headerlink" title="3.3.1 设置环境变量"></a><strong>3.3.1 设置环境变量</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">export</span> OS_USERNAME=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_PASSWORD=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_PROJECT_NAME=admin</span><br><span class="line">$ <span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line">$ <span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">$ <span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br></pre></td></tr></table></figure>
<h3 id="3-3-2创建域、项目、用户和角色"><a href="#3-3-2创建域、项目、用户和角色" class="headerlink" title="3.3.2创建域、项目、用户和角色"></a><strong>3.3.2创建域、项目、用户和角色</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">创建服务</span><br><span class="line">[root@linux-node2 ~]# openstack project create --domain default --description "Service Project" service</span><br><span class="line">创建demo项目</span><br><span class="line"> [root@linux-node2 ~]# openstack project create --domain default \</span><br><span class="line">&gt; --description <span class="string">"Demo Project"</span> demo</span><br><span class="line">设置demo密码</span><br><span class="line">[root@linux-node2 ~]# openstack user create --domain default \</span><br><span class="line">&gt; --password-prompt demo</span><br><span class="line">创建用户组</span><br><span class="line"> [root@linux-node2 ~]# openstack role create user</span><br><span class="line">加入用户组</span><br><span class="line"> [root@linux-node2 ~]# openstack role add --project demo --user demo user</span><br></pre></td></tr></table></figure>
<h3 id="3-3-3-验证操作"><a href="#3-3-3-验证操作" class="headerlink" title="3.3.3**验证操作**"></a><strong>3.3.3**</strong>验证操作**</h3><p>\1. 出于安全原因，请禁用临时身份验证令牌机制：  <strong>( 这个可以不操作)</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">编辑/etc/keystone/keystone-paste.ini 文件并删除admin_token_auth从 [pipeline:public_api]，[pipeline:admin_api]和[pipeline:api_v3]段。</span><br></pre></td></tr></table></figure>
<p>2、取消设置临时 变量OS_AUTH_URL和OS_PASSWORD环境变量：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  unset OS_AUTH_URL OS_PASSWORD</span><br></pre></td></tr></table></figure>
<p>3、作为admin 、请求身份验证令牌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http:<span class="comment">//linux-node2:35357/v3 \</span></span><br><span class="line">  --os-project-domain-name <span class="keyword">default</span> --os-user-domain-name <span class="keyword">default</span> \</span><br><span class="line">  --os-project-name admin --os-username admin token issue</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | <span class="number">2016</span><span class="number">-02</span><span class="number">-12</span>T20:<span class="number">14</span>:<span class="number">07.056119</span>Z                                     |</span><br><span class="line">| id         | gAAAAABWvi7_B8kKQD9wdXac8MoZiQldmjEO643d-e_j-XXq9AmIegIbA7UHGPv |</span><br><span class="line">|            | atnN21qtOMjCFWX7BReJEQnVOAj3nclRQgAYRsfSU_MrsuWb4EDtnjU7HEpoBb4 |</span><br><span class="line">|            | o6ozsA_NmFWEpLeKy0uNn_WeKbAhYygrsmQGA49dclHVnz-OMVLiyM9ws       |</span><br><span class="line">| project_id | <span class="number">343</span>d245e850143a096806dfaefa9afdc                                |</span><br><span class="line">| user_id    | ac3377633149401296f6c0d92d79dc16                                |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>4、用demo用户、请求验证令牌</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">$ openstack --os-auth-url http:<span class="comment">//linux-node2:5000/v3 \</span></span><br><span class="line">  --os-project-domain-name <span class="keyword">default</span> --os-user-domain-name <span class="keyword">default</span> \</span><br><span class="line">  --os-project-name demo --os-username demo token issue</span><br><span class="line">Password:</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| Field      | Value                                                           |</span><br><span class="line">+------------+-----------------------------------------------------------------+</span><br><span class="line">| expires    | <span class="number">2016</span><span class="number">-02</span><span class="number">-12</span>T20:<span class="number">15</span>:<span class="number">39.014479</span>Z                                     |</span><br><span class="line">| id         | gAAAAABWvi9bsh7vkiby5BpCCnc-JkbGhm9wH3fabS_cY7uabOubesi-Me6IGWW |</span><br><span class="line">|            | yQqNegDDZ5jw7grI26vvgy1J5nCVwZ_zFRqPiz_qhbq29mgbQLglbkq6FQvzBRQ |</span><br><span class="line">|            | JcOzq3uwhzNxszJWmzGC7rJE_H0A_a3UFhqv8M4zMRYSbS2YF0MyFmp_U       |</span><br><span class="line">| project_id | ed0b60bf607743088218b0a533d5943f                                |</span><br><span class="line">| user_id    | <span class="number">58126687</span>cbcc4888bfa9ab73a2256f27                                |</span><br></pre></td></tr></table></figure>
<h3 id="3-3-4-创建-OpenStack-客户端环境脚本"><a href="#3-3-4-创建-OpenStack-客户端环境脚本" class="headerlink" title="3.3.4**创建 OpenStack 客户端环境脚本**"></a><strong>3.3.4**</strong>创建 OpenStack 客户端环境脚本**</h3><p>vi admin-openrc 加入如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_NAME=admin</span><br><span class="line"><span class="keyword">export</span> OS_USERNAME=admin</span><br><span class="line"><span class="keyword">export</span> OS_PASSWORD=ADMIN_PASS</span><br><span class="line"><span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line"><span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br><span class="line"><span class="keyword">export</span> OS_IMAGE_API_VERSION=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<p>#vi demo-openrc 加入：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# cat demo-openrc </span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_USER_DOMAIN_NAME=Default</span><br><span class="line"><span class="keyword">export</span> OS_PROJECT_NAME=demo</span><br><span class="line"><span class="keyword">export</span> OS_USERNAME=demo</span><br><span class="line"><span class="keyword">export</span> OS_PASSWORD=demo</span><br><span class="line"><span class="keyword">export</span> OS_AUTH_URL=http:<span class="comment">//linux-node2:5000/v3</span></span><br><span class="line"><span class="keyword">export</span> OS_IDENTITY_API_VERSION=<span class="number">3</span></span><br><span class="line"><span class="keyword">export</span> OS_IMAGE_API_VERSION=<span class="number">2</span></span><br></pre></td></tr></table></figure>
<h2 id="四-：镜像服务-Glance（node2-主控制节点操作）"><a href="#四-：镜像服务-Glance（node2-主控制节点操作）" class="headerlink" title="四**：镜像服务**Glance（node2 主控制节点操作）"></a><strong>四**</strong>：镜像服务<strong>**Glance（node2 主控制节点操作）</strong></h2><h3 id="4-1-Glance-介绍"><a href="#4-1-Glance-介绍" class="headerlink" title="4.1 Glance 介绍"></a><strong>4.1 Glance 介绍</strong></h3><p>Glance 主要由三个部分构成： glance-api、glance-registry 以 image stroe</p>
<p>   Glance-api：接受云系统镜像创建、删除、读取请求</p>
<p>   Glance-Registry： 云系统镜像注册服务</p>
<h3 id="4-2-mysql-配置"><a href="#4-2-mysql-配置" class="headerlink" title="4.2 mysql 配置"></a><strong>4.2 mysql 配置</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE glance;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'glance'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON glance.* TO <span class="string">'glance'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'glance'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="4-3-Glance安装"><a href="#4-3-Glance安装" class="headerlink" title="4.3 Glance安装"></a><strong>4.3 Glance安装</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-glance</span><br></pre></td></tr></table></figure>
<h3 id="4-4修改主配置文件-etc-glance-glance-api-conf"><a href="#4-4修改主配置文件-etc-glance-glance-api-conf" class="headerlink" title="4.4修改主配置文件**/etc/glance/glance-api.conf**"></a><strong>4.4修改主配置文件**</strong>/etc/glance/glance-api.conf**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//glance:glance@192.168.57.145/glance</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">在[keystone_authtoken]和[paste_deploy]部分中，配置身份服务访问：</span><br><span class="line">[keystone_authtoken] </span><br><span class="line">auth_uri  =  http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url  =  http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers  =  linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type  =  password</span><br><span class="line">project_domain_name  =  <span class="keyword">default</span></span><br><span class="line">user_domain_name  =  <span class="keyword">default</span></span><br><span class="line">project_name  =  service</span><br><span class="line">username  =  glance</span><br><span class="line">password  =  glance    #########这里的密码就是下面的新建 API  glance用户的密码</span><br><span class="line">＃... </span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor  =  keystone</span><br><span class="line">[glance_store]</span><br><span class="line"># ...</span><br><span class="line">stores = file,http</span><br><span class="line">default_store = file</span><br><span class="line">filesystem_store_datadir = <span class="regexp">/var/</span>lib/glance/images/</span><br></pre></td></tr></table></figure>
<h3 id="4-5-修改主配置文件-etc-glance-glance-registry-conf"><a href="#4-5-修改主配置文件-etc-glance-glance-registry-conf" class="headerlink" title="4.5 修改主配置文件**/etc/glance/glance-registry.conf**"></a><strong>4.5 修改主配置文件**</strong>/etc/glance/glance-registry.conf**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//glance:glance@192.168.57.145/glance</span></span><br></pre></td></tr></table></figure>
<p>在[keystone_authtoken]和[paste_deploy]部分中，配置身份服务访问：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[keystone_authtoken] </span><br><span class="line">auth_uri  =  http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url  =  http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers  =  linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type  =  password</span><br><span class="line">project_domain_name  =  <span class="keyword">default</span></span><br><span class="line">user_domain_name  =  <span class="keyword">default</span></span><br><span class="line">project_name  =  service</span><br><span class="line">username  =  glance</span><br><span class="line">password  =  glance  #########这里的密码就是下面的新建 API  glance用户的密码</span><br><span class="line">＃... </span><br><span class="line">[paste_deploy]</span><br><span class="line">flavor  =  keystone</span><br></pre></td></tr></table></figure>
<h3 id="4-6-设置数据库"><a href="#4-6-设置数据库" class="headerlink" title="4.6 设置数据库"></a><strong>4.6 设置数据库</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "glance-manage db_sync" glance</span><br></pre></td></tr></table></figure>
<h3 id="4-7创建镜像服务的API服务"><a href="#4-7创建镜像服务的API服务" class="headerlink" title="4.7创建镜像服务的API服务"></a><strong>4.7创建镜像服务的API服务</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt glance</span><br><span class="line">$ openstack role add --project service --user glance admin</span><br><span class="line">$ openstack service create --name glance \</span><br><span class="line">  --description <span class="string">"OpenStack Image"</span> image</span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image public http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image internal http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  image admin http:<span class="comment">//linux-node2:9292</span></span><br></pre></td></tr></table></figure>
<h3 id="4-8-启动服务"><a href="#4-8-启动服务" class="headerlink" title="4.8 启动服务"></a><strong>4.8 启动服务</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br><span class="line"># systemctl start openstack-glance-api.service \</span><br><span class="line">  openstack-glance-registry.service</span><br></pre></td></tr></table></figure>
<h3 id="4-9验证"><a href="#4-9验证" class="headerlink" title="4.9验证"></a><strong>4.9验证</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">运行环境变量：</span><br><span class="line">　　#. admin-openrc</span><br><span class="line">　　下载一个比较小的镜像：</span><br><span class="line">　　#wget http://download.cirros-cloud.net/0.3.5/cirros-0.3.5-x86_64-disk.img</span><br></pre></td></tr></table></figure>
<p>一、上传文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image create <span class="string">"cirros"</span> \</span><br><span class="line">  --file cirros<span class="number">-0.3</span><span class="number">.5</span>-x86_64-disk.img \</span><br><span class="line">  --disk-format qcow2 --container-format bare \</span><br><span class="line">  --public</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| Field            | Value                                                |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br><span class="line">| checksum         | <span class="number">133</span>eae9fb1c98f45894a4e60d8736619                     |</span><br><span class="line">| container_format | bare                                                 |</span><br><span class="line">| created_at       | <span class="number">2015</span><span class="number">-03</span><span class="number">-26</span>T16:<span class="number">52</span>:<span class="number">10</span>Z                                 |</span><br><span class="line">| disk_format      | qcow2                                                |</span><br><span class="line">| file             | <span class="regexp">/v2/im</span>ages/cc5c6982<span class="number">-4910</span><span class="number">-471</span>e-b864<span class="number">-1098015901</span>b5/file |</span><br><span class="line">| id               | cc5c6982<span class="number">-4910</span><span class="number">-471</span>e-b864<span class="number">-1098015901</span>b5                 |</span><br><span class="line">| min_disk         | <span class="number">0</span>                                                    |</span><br><span class="line">| min_ram          | <span class="number">0</span>                                                    |</span><br><span class="line">| name             | cirros                                               |</span><br><span class="line">| owner            | ae7a98326b9c455588edd2656d723b9d                     |</span><br><span class="line">| protected        | False                                                |</span><br><span class="line">| schema           | <span class="regexp">/v2/</span>schemas/image                                    |</span><br><span class="line">| size             | <span class="number">13200896</span>                                             |</span><br><span class="line">| status           | active                                               |</span><br><span class="line">| tags             |                                                      |</span><br><span class="line">| updated_at       | <span class="number">2015</span><span class="number">-03</span><span class="number">-26</span>T16:<span class="number">52</span>:<span class="number">10</span>Z                                 |</span><br><span class="line">| virtual_size     | None                                                 |</span><br><span class="line">| visibility       | public                                               |</span><br><span class="line">+------------------+------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>二、查看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| ID                                   | Name   | Status |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br><span class="line">| <span class="number">38047887</span><span class="number">-61</span>a7<span class="number">-41</span>ea<span class="number">-9</span>b49<span class="number">-27987</span>d5e8bb9 | cirros | active |</span><br><span class="line">+--------------------------------------+--------+--------+</span><br></pre></td></tr></table></figure>
<p>有输出证明glance配置正确</p>
<h2 id="五、计算服务一-nova（node2控制节点操作）"><a href="#五、计算服务一-nova（node2控制节点操作）" class="headerlink" title="五、计算服务一 nova（node2控制节点操作）"></a><strong>五、计算服务一 nova（node2控制节点操作）</strong></h2><h3 id="5-N-ova-作用"><a href="#5-N-ova-作用" class="headerlink" title="5 .**N**ova 作用"></a><strong>5 .**</strong>N<strong>**ova 作用</strong></h3><p>\1. API :负责接收和相应外部请求、支持 openstack API Ec2API</p>
<p>\2. Cert：负责身份认证</p>
<p>\3. Scheduler：用于云主机调度</p>
<p>\4. Conductor： 计算节点访问数据的中间件</p>
<p>\5. Consoleaut：用于控制台的授权验证</p>
<p>\6. NovncProxy： VNC代理</p>
<h3 id="5-1-新建数据库"><a href="#5-1-新建数据库" class="headerlink" title="5.1 新建数据库"></a><strong>5.1 新建数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_api;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova;</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE nova_cell0;</span><br><span class="line">新建用户</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_api.* TO <span class="string">'nova'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova.* TO <span class="string">'nova'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON nova_cell0.* TO <span class="string">'nova'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'nova'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="5-2-创建nova用户："><a href="#5-2-创建nova用户：" class="headerlink" title="5.2**创建nova用户：**"></a><strong>5.2**</strong>创建nova用户：**</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># . admin-openrc</span><br><span class="line"></span><br><span class="line">openstack user create --domain <span class="keyword">default</span> --password-prompt nova</span><br><span class="line">User Password: nova</span><br><span class="line">Repeat User Password: nova</span><br><span class="line">The passwords entered were not the same</span><br><span class="line">User Password: nova</span><br><span class="line">Repeat User Password:  nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | b9878680c70a4a678fd9a7a580706ccf |</span><br><span class="line">| name                | nova                             |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure>
<p>加入组</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  openstack role add --project service --user nova admin</span><br></pre></td></tr></table></figure>
<h3 id="5-3创建nova服务实体"><a href="#5-3创建nova服务实体" class="headerlink" title="5.3创建nova服务实体"></a><strong>5.3创建nova服务实体</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name nova \</span><br><span class="line">  --description <span class="string">"OpenStack Compute"</span> compute</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Compute                |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | <span class="number">060</span>d59eac51b4594815603d75a00aba2 |</span><br><span class="line">| name        | nova                             |</span><br><span class="line">| type        | compute                          |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="5-4创建服务API"><a href="#5-4创建服务API" class="headerlink" title="5.4创建服务API"></a><strong>5.4创建服务API</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute public http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b6ebf975780344a597a65650eafdf67a |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute internal http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | a2c1af804a31484cb3d82017b15fa47f |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne \</span><br><span class="line">&gt;   compute admin http:<span class="comment">//linux-node2:8774/v2.1</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | <span class="number">0304</span>b6e92bf049d09e7d28bacfb1ed16 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | d6a1591a15944bea85ab1e203af6732c |</span><br><span class="line">| service_name | nova                             |</span><br><span class="line">| service_type | compute                          |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8774/v2.1     |</span></span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="5-5新建另一个用户"><a href="#5-5新建另一个用户" class="headerlink" title="5.5新建另一个用户"></a><strong>5.5新建另一个用户</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack user create --domain default --password-prompt placement</span><br><span class="line">User Password: nova </span><br><span class="line">Repeat User Password: nova</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | <span class="number">1654</span>b6d199bf4fc582d1e70db802a31a |</span><br><span class="line">| name                | placement                        |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]#</span><br></pre></td></tr></table></figure>
<p>加入管理员组</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack role add --project service --user placement admin</span><br></pre></td></tr></table></figure>
<h3 id="5-6-在服务目录中创建Placement-API条目："><a href="#5-6-在服务目录中创建Placement-API条目：" class="headerlink" title="5.6**在服务目录中创建Placement API条目：**"></a><strong>5.6**</strong>在服务目录中创建Placement API条目：**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name placement --description <span class="string">"Placement API"</span> placement</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | Placement API                    |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | <span class="number">2</span>d1a27022e6e4185b86adac4444c495f |</span><br><span class="line">| name        | placement                        |</span><br><span class="line">| type        | placement                        |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="5-7-创建Placement-API服务端点："><a href="#5-7-创建Placement-API服务端点：" class="headerlink" title="5.7**创建Placement API服务端点：**"></a><strong>5.7**</strong>创建Placement API服务端点：**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]#  openstack endpoint create --region RegionOne placement public http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | <span class="number">4</span>b82fb4b30de4228982dea8c663f6d26 |</span><br><span class="line">| interface    | public                           |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne placement internal http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | bea3dbb6003d4cea802527de411f8cde |</span><br><span class="line">| interface    | internal                         |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack endpoint create --region RegionOne placement admin http://linux-node2:8778</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| Field        | Value                            |</span><br><span class="line">+--------------+----------------------------------+</span><br><span class="line">| enabled      | True                             |</span><br><span class="line">| id           | b5d6d62d8f3f4e7c9ee2d6241b832bc5 |</span><br><span class="line">| interface    | admin                            |</span><br><span class="line">| region       | RegionOne                        |</span><br><span class="line">| region_id    | RegionOne                        |</span><br><span class="line">| service_id   | ba2a8b23524a4635af583cbfc80abd91 |</span><br><span class="line">| service_name | placement                        |</span><br><span class="line">| service_type | placement                        |</span><br><span class="line">| url          | http:<span class="comment">//linux-node2:8778          |</span></span><br><span class="line">+--------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="5-8-安装和配置的部件"><a href="#5-8-安装和配置的部件" class="headerlink" title="5.8**安装和配置的部件**"></a><strong>5.8**</strong>安装和配置的部件**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-nova-api openstack-nova-conductor \</span><br><span class="line">  openstack-nova-<span class="built_in">console</span> openstack-nova-novncproxy \</span><br><span class="line">  openstack-nova-scheduler openstack-nova-placement-api</span><br></pre></td></tr></table></figure>
<h3 id="5-9修改配置文件-etc-nova-nova-conf"><a href="#5-9修改配置文件-etc-nova-nova-conf" class="headerlink" title="5.9修改配置文件 /etc/nova/nova.conf"></a><strong>5.9修改配置文件</strong> <strong>/etc/nova/nova.conf</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line"> [api_database]</span><br><span class="line">connection=mysql:<span class="comment">//nova:nova@192.168.57.145/nova_api</span></span><br><span class="line">[database]</span><br><span class="line">connection=connection=mysql:<span class="comment">//nova:nova@192.168.57.145/nova</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@192.168.57.145</span></span><br></pre></td></tr></table></figure>
<h3 id="5-10设置api和连接信息"><a href="#5-10设置api和连接信息" class="headerlink" title="5.10设置api和连接信息"></a><strong>5.10设置api和连接信息</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">[api]</span><br><span class="line"># ...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span> </span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br><span class="line"></span><br><span class="line">设置IP</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line">enabled = <span class="literal">true</span></span><br><span class="line"># ...</span><br><span class="line">vncserver_listen = $my_ip</span><br><span class="line">vncserver_proxyclient_address = $my_ip</span><br></pre></td></tr></table></figure>
<h3 id="5-11设置glance"><a href="#5-11设置glance" class="headerlink" title="5.11设置glance"></a><strong>5.11设置glance</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[glance]</span><br><span class="line"># ...</span><br><span class="line">api_servers = http:<span class="comment">//linux-node2:9292</span></span><br></pre></td></tr></table></figure>
<h3 id="5-12设置-oslo-concurrency"><a href="#5-12设置-oslo-concurrency" class="headerlink" title="5.12设置**[oslo_concurrency]**"></a><strong>5.12设置**</strong>[oslo_concurrency]**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/nova/tmp</span><br></pre></td></tr></table></figure>
<h3 id="5-13设置-placement"><a href="#5-13设置-placement" class="headerlink" title="5.13设置**[placement]**"></a><strong>5.13设置**</strong>[placement]**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[placement]</span><br><span class="line"># ...</span><br><span class="line"> os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">username = placement</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure>
<h3 id="5-14设置apache"><a href="#5-14设置apache" class="headerlink" title="5.14设置apache"></a><strong>5.14设置apache</strong></h3><p>vim  /etc/httpd/conf.d/00-nova-placement-api.conf:</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&lt;Directory /usr/bin&gt;</span><br><span class="line">   &lt;IfVersion &gt;= <span class="number">2.4</span>&gt;</span><br><span class="line">      Require all granted</span><br><span class="line">   &lt;<span class="regexp">/IfVersion&gt;</span></span><br><span class="line"><span class="regexp">   &lt;IfVersion &lt; 2.4&gt;</span></span><br><span class="line"><span class="regexp">      Order allow,deny</span></span><br><span class="line"><span class="regexp">      Allow from all</span></span><br><span class="line"><span class="regexp">   &lt;/</span>IfVersion&gt;</span><br><span class="line">&lt;<span class="regexp">/Directory&gt;</span></span><br></pre></td></tr></table></figure>
<h3 id="5-15重启apache"><a href="#5-15重启apache" class="headerlink" title="5.15重启apache"></a><strong>5.15重启apache</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart httpd</span><br></pre></td></tr></table></figure>
<p>填充nova-api数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage api_db sync" nova</span><br></pre></td></tr></table></figure>
<p>注册cell0数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage cell_v2 map_cell0" nova</span><br></pre></td></tr></table></figure>
<p>创建cell1单元格：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage cell_v2 create_cell --name=cell1 --verbose" nova</span><br><span class="line"><span class="number">109e1</span>d4b<span class="number">-536</span>a<span class="number">-40</span>d0<span class="number">-83</span>c6<span class="number">-5</span>f121b82b650</span><br></pre></td></tr></table></figure>
<p>填充nova数据库：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "nova-manage db sync" nova</span><br></pre></td></tr></table></figure>
<h3 id="5-17验证"><a href="#5-17验证" class="headerlink" title="5.17验证"></a><strong>5.17验证</strong></h3><p>验证nova cell0和cell1是否正确注册：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">＃ nova-manage cell_v2 list_cells</span><br><span class="line"> + ------- + ----------------------------------- --- + </span><br><span class="line">| 名称| UUID | </span><br><span class="line">+ ------- + -------------------------------------- + </span><br><span class="line">| cell1 | <span class="number">109e1</span>d4b<span class="number">-536</span>a<span class="number">-40</span>d0<span class="number">-83</span>c6<span class="number">-5</span>f121b82b650 | </span><br><span class="line">| cell0 | <span class="number">00000000</span><span class="number">-0000</span><span class="number">-0000</span><span class="number">-0000</span><span class="number">-000000000000</span> | </span><br><span class="line">+ ------- + -------------------------------------- +</span><br><span class="line">设置开机自启动</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-api.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-consoleauth.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-scheduler.service</span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-conductor.service </span><br><span class="line">[root@linux-node2 nova]# systemctl enable openstack-nova-novncproxy.service</span><br><span class="line">[root@linux-node2 nova]#</span><br><span class="line">启动服务</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-api.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-consoleauth.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-scheduler.service</span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-conductor.service </span><br><span class="line">[root@linux-node2 nova]# systemctl start openstack-nova-novncproxy.service</span><br></pre></td></tr></table></figure>
<h2 id="六、计算服务二-nova（node1计算节点操作）"><a href="#六、计算服务二-nova（node1计算节点操作）" class="headerlink" title="六、计算服务二  nova（node1计算节点操作）"></a><strong>六、计算服务二  nova（node1计算节点操作）</strong></h2><h3 id="6-1安装nova-compute"><a href="#6-1安装nova-compute" class="headerlink" title="6.1安装nova-compute"></a><strong>6.1安装nova-compute</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-nova-compute</span><br></pre></td></tr></table></figure>
<h3 id="6-2配置主配置文件（-etc-nova-nova-conf-）"><a href="#6-2配置主配置文件（-etc-nova-nova-conf-）" class="headerlink" title="6.2配置主配置文件（**/etc/nova/nova.conf**）"></a><strong>6.2配置主配置文件（**</strong>/etc/nova/nova.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">enabled_apis = osapi_compute,metadata</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@192.168.57.145</span></span><br><span class="line">[api]</span><br><span class="line"># ...</span><br><span class="line">auth_strategy = keystone</span><br><span class="line"></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">my_ip = 192.168.57.142  ########这个是本机IP</span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">use_neutron = True</span><br><span class="line">firewall_driver = nova.virt.firewall.NoopFirewallDriver</span><br><span class="line">[vnc]</span><br><span class="line"># ...</span><br><span class="line">enabled = True</span><br><span class="line">vncserver_listen = <span class="number">0.0</span><span class="number">.0</span><span class="number">.0</span></span><br><span class="line">vncserver_proxyclient_address = $my_ip</span><br><span class="line">novncproxy_base_url = http:<span class="comment">//linux-node2:6080/vnc_auto.html</span></span><br><span class="line">[glance]</span><br><span class="line"># ...</span><br><span class="line">api_servers = http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/nova/tmp</span><br><span class="line">[placement]</span><br><span class="line"># ...</span><br><span class="line">os_region_name = RegionOne</span><br><span class="line">project_domain_name = Default</span><br><span class="line">project_name = service</span><br><span class="line">auth_type = password</span><br><span class="line">user_domain_name = Default</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357/v3</span></span><br><span class="line">username = placement</span><br><span class="line">password = nova</span><br></pre></td></tr></table></figure>
<h3 id="6-3检查是否需要硬件加速"><a href="#6-3检查是否需要硬件加速" class="headerlink" title="6.3检查是否需要硬件加速"></a><strong>6.3检查是否需要硬件加速</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ egrep -c <span class="string">'(vmx|svm)'</span> /proc/cpuinfo</span><br></pre></td></tr></table></figure>
<p>如果为0则需要修改#vi /etc/nova/nova.conf</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[libvirt]</span><br><span class="line"># ...</span><br><span class="line">virt_type = qemu</span><br></pre></td></tr></table></figure>
<h3 id="6-4启动服务"><a href="#6-4启动服务" class="headerlink" title="6.4启动服务"></a><strong>6.4启动服务</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable libvirtd.service openstack-nova-compute.service</span><br><span class="line"># systemctl start libvirtd.service openstack-nova-compute.service</span><br></pre></td></tr></table></figure>
<h3 id="6-5验证-node2-主节点操作"><a href="#6-5验证-node2-主节点操作" class="headerlink" title="6.5验证(node2 主节点操作)"></a><strong>6.5验证(node2 主节点操作)</strong></h3><p>将计算节点添加到单元数据库<a href="https://www.o2oxy.cn/917.html#add-the-compute-node-to-the-cell-database" target="_blank" rel="noopener"><strong>¶</strong></a>（在主节点操作）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">su -s /bin/sh -c <span class="string">"nova-manage cell_v2 discover_hosts --verbose"</span> nova</span><br><span class="line"></span><br><span class="line">Found <span class="number">2</span> cell mappings.</span><br><span class="line">Skipping cell0 since it does not contain hosts.</span><br><span class="line">Getting compute nodes <span class="keyword">from</span> cell <span class="string">'cell1'</span>: ad5a5985-a719<span class="number">-4567</span><span class="number">-98</span>d8<span class="number">-8</span>d148aaae4bc</span><br><span class="line">Found <span class="number">1</span> computes <span class="keyword">in</span> cell: ad5a5985-a719<span class="number">-4567</span><span class="number">-98</span>d8<span class="number">-8</span>d148aaae4bc</span><br><span class="line">Checking host mapping <span class="keyword">for</span> compute host <span class="string">'linux-node1'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br><span class="line">Creating host mapping <span class="keyword">for</span> compute host <span class="string">'linux-node1'</span>: fe58ddc1<span class="number">-1</span>d65<span class="number">-4</span>f87<span class="number">-9456</span>-bc040dc106b3</span><br></pre></td></tr></table></figure>
<p>查看comput节点</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">$ openstack compute service list</span><br><span class="line"></span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">| Id | Binary             | Host       | Zone     | Status  | State | Updated At                 |</span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">|  <span class="number">1</span> | nova-consoleauth   | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">15.000000</span> |</span><br><span class="line">|  <span class="number">2</span> | nova-scheduler     | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">15.000000</span> |</span><br><span class="line">|  <span class="number">3</span> | nova-conductor     | controller | internal | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">16.000000</span> |</span><br><span class="line">|  <span class="number">4</span> | nova-compute       | compute1   | nova     | enabled | up    | <span class="number">2016</span><span class="number">-02</span><span class="number">-09</span>T23:<span class="number">11</span>:<span class="number">20.000000</span> |</span><br><span class="line">+----+--------------------+------------+----------+---------+-------+----------------------------+</span><br><span class="line">查看catalog</span><br><span class="line">$ openstack catalog list</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| Name      | Type      | Endpoints                               |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br><span class="line">| keystone  | identity  | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:5000/v3/    |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:5000/v3/  |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:35357/v3/    |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| glance    | image     | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:9292         |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:9292        |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:9292      |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| nova      | compute   | RegionOne                               |</span><br><span class="line">|           |           |   admin: h http:<span class="comment">//linux-node2:8774/v2.1    |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:8774/v2.1 |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:8774/v2.1   |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">| placement | placement | RegionOne                               |</span><br><span class="line">|           |           |   public: http:<span class="comment">//linux-node2:8778        |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   admin: http:<span class="comment">//linux-node2:8778         |</span></span><br><span class="line">|           |           | RegionOne                               |</span><br><span class="line">|           |           |   internal: http:<span class="comment">//linux-node2:8778      |</span></span><br><span class="line">|           |           |                                         |</span><br><span class="line">+-----------+-----------+-----------------------------------------+</span><br></pre></td></tr></table></figure>
<p>列出Image服务中的图像以验证与Image服务的连接性：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack image list</span><br><span class="line"></span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br><span class="line">| ID                                   | Name        | Status      |</span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br><span class="line">| <span class="number">9</span>a76d9f9<span class="number">-9620</span><span class="number">-4</span>f2e<span class="number">-8</span>c69<span class="number">-6</span>c5691fae163 | cirros      | active      |</span><br><span class="line">+--------------------------------------+-------------+-------------+</span><br></pre></td></tr></table></figure>
<p>检查单元格和放置API正在成功工作：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># nova-status upgrade check</span><br><span class="line"></span><br><span class="line">+---------------------------+</span><br><span class="line">| Upgrade Check Results     |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Cells v2           |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Placement API      |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br><span class="line">| Check: Resource Providers |</span><br><span class="line">| Result: Success           |</span><br><span class="line">| Details: None             |</span><br><span class="line">+---------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="七、网络节点一（node2-主控制节点操作）"><a href="#七、网络节点一（node2-主控制节点操作）" class="headerlink" title="七、网络节点一（node2 主控制节点操作）"></a><strong>七、网络节点一（node2 主控制节点操作）</strong></h2><h3 id="7-1-设置mysql"><a href="#7-1-设置mysql" class="headerlink" title="7.1 设置mysql"></a><strong>7.1 设置mysql</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [（none）] CREATE DATABASE neutron;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">'neutron'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'neutron'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON neutron.* TO <span class="string">'neutron'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'neutron'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="7-2-创建服务凭据"><a href="#7-2-创建服务凭据" class="headerlink" title="7.2**创建服务凭据**"></a><strong>7.2**</strong>创建服务凭据**</h3><p>在admin的环境下</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt neutron</span><br><span class="line"></span><br><span class="line">User Password: neutron  #密码</span><br><span class="line">Repeat User Password: neutron  #密码</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | fdb0f541e28141719b6a43c8944bf1fb |</span><br><span class="line">| name                | neutron                          |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p>加入到admin组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user neutron admin</span><br></pre></td></tr></table></figure>
<p>创建neutron 服务实体</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name neutron \</span><br><span class="line">  --description <span class="string">"OpenStack Networking"</span> network</span><br></pre></td></tr></table></figure>
<p>创建neutron API</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network public http:<span class="comment">//linux-node2:9696</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network internal http:<span class="comment">//linux-node2:9696</span></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  network admin http:<span class="comment">//linux-node2:9696</span></span><br></pre></td></tr></table></figure>
<h3 id="7-3-配置网络选项-（这里我选用的是网络1-的配置）"><a href="#7-3-配置网络选项-（这里我选用的是网络1-的配置）" class="headerlink" title="7.3**配置网络选项**（这里我选用的是网络1 的配置）"></a><strong>7.3**</strong>配置网络选项<strong>**（这里我选用的是网络1 的配置）</strong></h3><p>您可以使用选项1和2所代表的两种体系结构之一来部署网络服务。</p>
<p>选项1部署了最简单的架构，只支持将实例连接到提供者（外部）网络。没有自助服务（专用）网络，</p>
<p>路由器或浮动IP地址。只有admin或其他特权用户才能管理提供商网络。</p>
<p>选项2增加了选项1，其中第三层服务支持将实例附加到自助服务网络。这个demo或其他非特权用户可以管理自助服务网络，</p>
<p>包括在自助服务和提供商网络之间提供连接的路由器。此外，浮动IP地址还提供与使用来自外部网络（如Internet）的自助服务网络的实例的连接。</p>
<p>自助服务网络通常使用覆盖网络。覆盖网络协议（如VXLAN）包含额外的标头，这些标头会增加开销并减少有效负载或用户数据的可用空间。</p>
<p>在不了解虚拟网络基础架构的情况下，实例将尝试使用1500字节的默认以太网<a href="https://www.o2oxy.cn/917.html#term-maximum-transmission-unit-mtu" target="_blank" rel="noopener">最大传输单元（MTU）</a>发送数据包。</p>
<p>网络服务通过DHCP自动为实例提供正确的MTU值。但是，某些云图像不使用DHCP或忽略DHCP MTU选项并需要使用元数据或脚本进行配置。</p>
<h3 id="7-4-安装网络openstack-neutron"><a href="#7-4-安装网络openstack-neutron" class="headerlink" title="7.4 安装网络openstack-neutron"></a><strong>7.4 安装网络openstack-neutron</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-neutron openstack-neutron-ml2 \</span><br><span class="line">  openstack-neutron-linuxbridge ebtables</span><br></pre></td></tr></table></figure>
<h3 id="7-5-编辑-etc-neutron-neutron-conf"><a href="#7-5-编辑-etc-neutron-neutron-conf" class="headerlink" title="7.5 编辑/etc/neutron/neutron.conf"></a><strong>7.5</strong> <strong>编辑/etc/neutron/neutron.conf</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//neutron:neutron@linux-node2/neutron</span></span><br><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">core_plugin = ml2</span><br><span class="line">service_plugins =</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">notify_nova_on_port_status_changes = <span class="literal">true</span></span><br><span class="line">notify_nova_on_port_data_changes = <span class="literal">true</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron  ######这个密码是上面设置的密码</span><br><span class="line">[nova]</span><br><span class="line"># ...</span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">region_name = RegionOne</span><br><span class="line">project_name = service</span><br><span class="line">username = nova</span><br><span class="line">password = nova  ####注意这个是nova设置的密码</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/neutron/tmp</span><br></pre></td></tr></table></figure>
<h3 id="7-6-配置模块化层2（ML2）插件（-etc-neutron-plugins-ml2-ml2-conf-ini-）"><a href="#7-6-配置模块化层2（ML2）插件（-etc-neutron-plugins-ml2-ml2-conf-ini-）" class="headerlink" title="7.6**配置模块化层2（ML2）插件（/etc/neutron/plugins/ml2/ml2_conf.ini**）"></a><strong>7.6**</strong>配置模块化层2（ML2）插件<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/ml2_conf.ini<strong>**）</strong></h3><p>编辑配置文件设置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[ml2]</span><br><span class="line">type_drivers = flat,vlan</span><br><span class="line">tenant_network_types =</span><br><span class="line">mechanism_drivers = linuxbridge</span><br><span class="line">[ml2_type_flat]</span><br><span class="line">flat_networks = provider</span><br><span class="line">[securitygroup]</span><br><span class="line">enable_ipset = <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-7-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><a href="#7-7-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）" class="headerlink" title="7.7**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）"></a><strong>7.7**</strong>配置Linux网桥代理<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/linuxbridge_agent.ini<strong>**）</strong></h3><p>编辑配置文件设置如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eth1  ####这个是为底层实现网络的网络接口（我这里用了eth1）</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line"># ...</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="7-8-配置DHCP代理（-etc-neutron-dhcp-agent-ini-）"><a href="#7-8-配置DHCP代理（-etc-neutron-dhcp-agent-ini-）" class="headerlink" title="7.8**配置DHCP代理（/etc/neutron/dhcp_agent.ini**）"></a><strong>7.8**</strong>配置DHCP代理<strong><strong>（</strong></strong>/etc/neutron/dhcp_agent.ini<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT] </span><br><span class="line">＃... </span><br><span class="line">interface_driver  =  linuxbridge </span><br><span class="line">dhcp_driver  =  neutron.agent.linux.dhcp.Dnsmasq </span><br><span class="line">enable_isolated_metadata  =  <span class="literal">true</span></span><br></pre></td></tr></table></figure>
<h3 id="7-9-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><a href="#7-9-配置计算服务以使用网络服务（-etc-nova-nova-conf-）" class="headerlink" title="7.9**配置计算服务以使用网络服务（/etc/nova/nova.conf**）"></a><strong>7.9**</strong>配置计算服务以使用网络服务<strong><strong>（</strong></strong>/etc/nova/nova.conf<strong>**）</strong></h3><p>在该[neutron]部分中，配置访问参数，启用元数据代理并配置密钥：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[neutron] </span><br><span class="line">＃... </span><br><span class="line">url  =  http：<span class="comment">//linux-node2：9696 </span></span><br><span class="line">auth_url  =  http：<span class="comment">//linux-node2：35357 </span></span><br><span class="line">auth_type  =  password </span><br><span class="line">project_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">user_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">region_name  =  RegionOne </span><br><span class="line">project_name  =  service </span><br><span class="line">username  =  neutron </span><br><span class="line">password  = neutron      ###在身份识别服务中为用户选择的密码。</span><br><span class="line">service_metadata_proxy  =  <span class="literal">true</span> </span><br><span class="line">metadata_proxy_shared_secret  =  neutron     #  #为元数据代理选择的密码。</span><br></pre></td></tr></table></figure>
<p>创建扩展链接</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># ln -s /etc/neutron/plugins/ml2/ml2_conf.ini /etc/neutron/plugin.ini</span><br></pre></td></tr></table></figure>
<h3 id="7-10同步数据库"><a href="#7-10同步数据库" class="headerlink" title="7.10同步数据库"></a><strong>7.10同步数据库</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "neutron-db-manage --config-file /etc/neutron/neutron.conf \</span><br><span class="line">  --config-file /etc/neutron/plugins/ml2/ml2_conf.ini upgrade head<span class="string">" neutron</span></span><br></pre></td></tr></table></figure>
<h3 id="7-10-启动服务"><a href="#7-10-启动服务" class="headerlink" title="7.10 启动服务"></a><strong>7.10 启动服务</strong></h3><p>重新启动计算API服务：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">重新启动计算API服务：</span><br><span class="line"># systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure>
<p>启动网络服务并将其配置为在系统引导时启动。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service</span><br><span class="line"># systemctl start neutron-server.service \</span><br><span class="line">  neutron-linuxbridge-agent.service neutron-dhcp-agent.service \</span><br><span class="line">  neutron-metadata-agent.service</span><br></pre></td></tr></table></figure>
<h2 id="八、网络节点二、（node1-计算节点操作）"><a href="#八、网络节点二、（node1-计算节点操作）" class="headerlink" title="八、网络节点二、（node1 计算节点操作）"></a><strong>八、网络节点二、（node1 计算节点操作）</strong></h2><h3 id="8-1-安装openstack-neutron"><a href="#8-1-安装openstack-neutron" class="headerlink" title="8.1 安装openstack-neutron"></a><strong>8.1 安装openstack-neutron</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-neutron-linuxbridge ebtables ipset</span><br></pre></td></tr></table></figure>
<h3 id="8-2-配置通用组件（-etc-neutron-neutron-conf-）"><a href="#8-2-配置通用组件（-etc-neutron-neutron-conf-）" class="headerlink" title="8.2**配置通用组件（/etc/neutron/neutron.conf**）"></a><strong>8.2**</strong>配置通用组件<strong><strong>（</strong></strong>/etc/neutron/neutron.conf<strong>**）</strong></h3><p>修改如下配置文件：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers =linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = neutron</span><br><span class="line">password = neutron</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/neutron/tmp</span><br></pre></td></tr></table></figure>
<h3 id="8-3-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><a href="#8-3-配置计算服务以使用网络服务（-etc-nova-nova-conf-）" class="headerlink" title="8.3**配置计算服务以使用网络服务（/etc/nova/nova.conf**）"></a><strong>8.3**</strong>配置计算服务以使用网络服务<strong><strong>（</strong></strong>/etc/nova/nova.conf<strong>**）</strong></h3><p>在该[neutron]部分中，配置访问参数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[neutron] </span><br><span class="line">＃... </span><br><span class="line">url  =  http：<span class="comment">//linux-node2：9696 </span></span><br><span class="line">auth_url  =  http：<span class="comment">//linux-node2：35357 </span></span><br><span class="line">auth_type  =  password </span><br><span class="line">project_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">user_domain_name  =  <span class="keyword">default</span> </span><br><span class="line">region_name  =  RegionOne </span><br><span class="line">project_name  =  service </span><br><span class="line">username  =  neutron </span><br><span class="line">password  =  neutron</span><br></pre></td></tr></table></figure>
<h3 id="8-4-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><a href="#8-4-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）" class="headerlink" title="8.4**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）"></a><strong>8.4**</strong>配置Linux网桥代理<strong><strong>（</strong></strong>/etc/neutron/plugins/ml2/linuxbridge_agent.ini<strong>**）</strong></h3><p>编辑文件修改如下配置：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[linux_bridge]</span><br><span class="line">physical_interface_mappings = provider:eht1 #这里是为底层服务的网卡名称</span><br><span class="line">[vxlan]</span><br><span class="line">enable_vxlan = <span class="literal">false</span></span><br><span class="line">[securitygroup]</span><br><span class="line"># ...</span><br><span class="line">enable_security_group = <span class="literal">true</span></span><br><span class="line">firewall_driver = neutron.agent.linux.iptables_firewall.IptablesFirewallDriver</span><br></pre></td></tr></table></figure>
<h3 id="8-5-启动服务"><a href="#8-5-启动服务" class="headerlink" title="8.5 启动服务"></a><strong>8.5 启动服务</strong></h3><p>重启一下openstack-nova-compute</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart openstack-nova-compute.service</span><br></pre></td></tr></table></figure>
<p>启动Linux桥代理并将其配置为在系统引导时启动：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable neutron-linuxbridge-agent.service</span><br><span class="line"># systemctl start neutron-linuxbridge-agent.service</span><br></pre></td></tr></table></figure>
<h3 id="8-6-验证操作"><a href="#8-6-验证操作" class="headerlink" title="8.6 验证操作"></a><strong>8.6 验证操作</strong></h3><p>1.运行管理员环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br></pre></td></tr></table></figure>
<p>2.查看网络</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><span class="line">$ openstack extension list --network</span><br><span class="line"></span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br><span class="line">| Name                      | Alias                     | Description                |</span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br><span class="line">| Default Subnetpools       | <span class="keyword">default</span>-subnetpools       | Provides ability to mark   |</span><br><span class="line">|                           |                           | and use a subnetpool <span class="keyword">as</span>    |</span><br><span class="line">|                           |                           | the <span class="keyword">default</span>                |</span><br><span class="line">| Availability Zone         | availability_zone         | The availability zone      |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| Network Availability Zone | network_availability_zone | Availability zone support  |</span><br><span class="line">|                           |                           | <span class="keyword">for</span> network.               |</span><br><span class="line">| Port Binding              | binding                   | Expose port bindings <span class="keyword">of</span> a  |</span><br><span class="line">|                           |                           | virtual port to external   |</span><br><span class="line">|                           |                           | application                |</span><br><span class="line">| agent                     | agent                     | The agent management       |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| Subnet Allocation         | subnet_allocation         | Enables allocation <span class="keyword">of</span>      |</span><br><span class="line">|                           |                           | subnets <span class="keyword">from</span> a subnet pool |</span><br><span class="line">| DHCP Agent Scheduler      | dhcp_agent_scheduler      | Schedule networks among    |</span><br><span class="line">|                           |                           | dhcp agents                |</span><br><span class="line">| Tag support               | tag                       | Enables to set tag on      |</span><br><span class="line">|                           |                           | resources.                 |</span><br><span class="line">| Neutron external network  | external-net              | Adds external network      |</span><br><span class="line">|                           |                           | attribute to network       |</span><br><span class="line">|                           |                           | resource.                  |</span><br><span class="line">| Neutron Service Flavors   | flavors                   | Flavor specification <span class="keyword">for</span>   |</span><br><span class="line">|                           |                           | Neutron advanced services  |</span><br><span class="line">| Network MTU               | net-mtu                   | Provides MTU attribute <span class="keyword">for</span> |</span><br><span class="line">|                           |                           | a network resource.        |</span><br><span class="line">| Network IP Availability   | network-ip-availability   | Provides IP availability   |</span><br><span class="line">|                           |                           | data <span class="keyword">for</span> each network and  |</span><br><span class="line">|                           |                           | subnet.                    |</span><br><span class="line">| Quota management support  | quotas                    | Expose functions <span class="keyword">for</span>       |</span><br><span class="line">|                           |                           | quotas management per      |</span><br><span class="line">|                           |                           | tenant                     |</span><br><span class="line">| Provider Network          | provider                  | Expose mapping <span class="keyword">of</span> virtual  |</span><br><span class="line">|                           |                           | networks to physical       |</span><br><span class="line">|                           |                           | networks                   |</span><br><span class="line">| Multi Provider Network    | multi-provider            | Expose mapping <span class="keyword">of</span> virtual  |</span><br><span class="line">|                           |                           | networks to multiple       |</span><br><span class="line">|                           |                           | physical networks          |</span><br><span class="line">| Address scope             | address-scope             | Address scopes extension.  |</span><br><span class="line">| Subnet service types      | subnet-service-types      | Provides ability to set    |</span><br><span class="line">|                           |                           | the subnet service_types   |</span><br><span class="line">|                           |                           | field                      |</span><br><span class="line">| Resource timestamps       | standard-attr-timestamp   | Adds created_at and        |</span><br><span class="line">|                           |                           | updated_at fields to all   |</span><br><span class="line">|                           |                           | Neutron resources that     |</span><br><span class="line">|                           |                           | have Neutron standard      |</span><br><span class="line">|                           |                           | attributes.                |</span><br><span class="line">| Neutron Service Type      | service-type              | API <span class="keyword">for</span> retrieving service |</span><br><span class="line">| Management                |                           | providers <span class="keyword">for</span> Neutron      |</span><br><span class="line">|                           |                           | advanced services          |</span><br><span class="line">| Tag support <span class="keyword">for</span>           | tag-ext                   | Extends tag support to     |</span><br><span class="line">| resources: subnet,        |                           | more L2 and L3 resources.  |</span><br><span class="line">| subnetpool, port, router  |                           |                            |</span><br><span class="line">| Neutron Extra DHCP opts   | extra_dhcp_opt            | Extra options              |</span><br><span class="line">|                           |                           | configuration <span class="keyword">for</span> DHCP.    |</span><br><span class="line">|                           |                           | For example PXE boot       |</span><br><span class="line">|                           |                           | options to DHCP clients    |</span><br><span class="line">|                           |                           | can be specified (e.g.     |</span><br><span class="line">|                           |                           | tftp-server, server-ip-    |</span><br><span class="line">|                           |                           | address, bootfile-name)    |</span><br><span class="line">| Resource revision numbers | standard-attr-revisions   | This extension will        |</span><br><span class="line">|                           |                           | display the revision       |</span><br><span class="line">|                           |                           | number <span class="keyword">of</span> neutron          |</span><br><span class="line">|                           |                           | resources.                 |</span><br><span class="line">| Pagination support        | pagination                | Extension that indicates   |</span><br><span class="line">|                           |                           | that pagination is         |</span><br><span class="line">|                           |                           | enabled.                   |</span><br><span class="line">| Sorting support           | sorting                   | Extension that indicates   |</span><br><span class="line">|                           |                           | that sorting is enabled.   |</span><br><span class="line">| security-group            | security-group            | The security groups        |</span><br><span class="line">|                           |                           | extension.                 |</span><br><span class="line">| RBAC Policies             | rbac-policies             | Allows creation and        |</span><br><span class="line">|                           |                           | modification <span class="keyword">of</span> policies   |</span><br><span class="line">|                           |                           | that control tenant access |</span><br><span class="line">|                           |                           | to resources.              |</span><br><span class="line">| standard-attr-description | standard-attr-description | Extension to add           |</span><br><span class="line">|                           |                           | descriptions to standard   |</span><br><span class="line">|                           |                           | attributes                 |</span><br><span class="line">| Port Security             | port-security             | Provides port security     |</span><br><span class="line">| Allowed Address Pairs     | allowed-address-pairs     | Provides allowed address   |</span><br><span class="line">|                           |                           | pairs                      |</span><br><span class="line">| project_id field enabled  | project-id                | Extension that indicates   |</span><br><span class="line">|                           |                           | that project_id field is   |</span><br><span class="line">|                           |                           | enabled.                   |</span><br><span class="line">+---------------------------+---------------------------+----------------------------+</span><br></pre></td></tr></table></figure>
<p>\1. 查看网络</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">3.</span>$ openstack network agent list</span><br><span class="line"><span class="number">4.</span></span><br><span class="line"><span class="number">5.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line"><span class="number">6.</span>| ID                                   | Agent Type         | Host       | Availability Zone | Alive | State | Binary                    |</span><br><span class="line"><span class="number">7.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br><span class="line"><span class="number">8.</span>| <span class="number">0400</span>c2f6<span class="number">-4</span>d3b<span class="number">-44</span>bc<span class="number">-89</span>fa<span class="number">-99093432</span>f3bf | Metadata agent     | controller | None              | True  | UP    | neutron-metadata-agent    |</span><br><span class="line"><span class="number">9.</span>| <span class="number">83</span>cf853d-a2f2<span class="number">-450</span>a<span class="number">-99</span>d7-e9c6fc08f4c3 | DHCP agent         | controller | nova              | True  | UP    | neutron-dhcp-agent        |</span><br><span class="line"><span class="number">10.</span>| ec302e51<span class="number">-6101</span><span class="number">-43</span>cf<span class="number">-9</span>f19<span class="number">-88</span>a78613cbee | Linux bridge agent | compute    | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line"><span class="number">11.</span>| fcb9bc6e<span class="number">-22</span>b1<span class="number">-43</span>bc<span class="number">-9054</span><span class="number">-272</span>dd517d025 | Linux bridge agent | controller | None              | True  | UP    | neutron-linuxbridge-agent |</span><br><span class="line"><span class="number">12.</span>+--------------------------------------+--------------------+------------+-------------------+-------+-------+---------------------------+</span><br></pre></td></tr></table></figure>
<h2 id="九、-Dashboard-（node2控制节点操作）"><a href="#九、-Dashboard-（node2控制节点操作）" class="headerlink" title="九、**Dashboard**（node2控制节点操作）"></a><strong>九、**</strong>Dashboard<strong>**（node2控制节点操作）</strong></h2><h3 id="9-1-安装"><a href="#9-1-安装" class="headerlink" title="9.1 安装"></a><strong>9.1 安装</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-dashboard</span><br></pre></td></tr></table></figure>
<h3 id="9-2配置主配置文件（-etc-openstack-dashboard-local-settings-）"><a href="#9-2配置主配置文件（-etc-openstack-dashboard-local-settings-）" class="headerlink" title="9.2配置主配置文件（**/etc/openstack-dashboard/local_settings**）"></a><strong>9.2配置主配置文件（**</strong>/etc/openstack-dashboard/local_settings<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">OPENSTACK_HOST = <span class="string">"linux-node2"</span></span><br><span class="line">ALLOWED_HOSTS = [<span class="string">'*'</span>]</span><br><span class="line">SESSION_ENGINE = <span class="string">'django.contrib.sessions.backends.cache'</span></span><br><span class="line"></span><br><span class="line">CACHES = &#123;</span><br><span class="line">    <span class="string">'default'</span>: &#123;</span><br><span class="line">         <span class="string">'BACKEND'</span>: <span class="string">'django.core.cache.backends.memcached.MemcachedCache'</span>,</span><br><span class="line">         <span class="string">'LOCATION'</span>: <span class="string">'controller:11211'</span>,</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_URL = <span class="string">"http://%s:5000/v3"</span> % OPENSTACK_HOST</span><br><span class="line">OPENSTACK_KEYSTONE_MULTIDOMAIN_SUPPORT = True</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">OPENSTACK_API_VERSIONS = &#123;</span><br><span class="line">    <span class="string">"identity"</span>: <span class="number">3</span>,</span><br><span class="line">    <span class="string">"image"</span>: <span class="number">2</span>,</span><br><span class="line">    <span class="string">"volume"</span>: <span class="number">2</span>,</span><br><span class="line">&#125;</span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_DOMAIN = <span class="string">"Default"</span></span><br><span class="line">OPENSTACK_KEYSTONE_DEFAULT_ROLE = <span class="string">"user"</span></span><br><span class="line">OPENSTACK_NEUTRON_NETWORK = &#123;</span><br><span class="line">    ...</span><br><span class="line">    <span class="string">'enable_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_quotas'</span>: False,</span><br><span class="line">    <span class="string">'enable_distributed_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_ha_router'</span>: False,</span><br><span class="line">    <span class="string">'enable_lb'</span>: False,</span><br><span class="line">    <span class="string">'enable_firewall'</span>: False,</span><br><span class="line">    <span class="string">'enable_vpn'</span>: False,</span><br><span class="line">    <span class="string">'enable_fip_topology_check'</span>: False,</span><br><span class="line">&#125;</span><br><span class="line">TIME_ZONE = <span class="string">"Asia/Shanghai "</span></span><br></pre></td></tr></table></figure>
<h3 id="9-4重启服务"><a href="#9-4重启服务" class="headerlink" title="9.4重启服务"></a><strong>9.4重启服务</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart httpd.service memcached.service</span><br></pre></td></tr></table></figure>
<h3 id="9-5-访问openstack"><a href="#9-5-访问openstack" class="headerlink" title="9.5 访问openstack"></a><strong>9.5 访问openstack</strong></h3><p><a href="http://192.168.57.145/dashboard/auth/login/" target="_blank" rel="noopener">http://192.168.57.145/dashboard/auth/login/</a></p>
<p><img src="http://yun.name168.cn/OpenStack001.png" alt="&quot;OpenStack&quot;"></p>
<p><img src="http://yun.name168.cn/OpenStack002.png" alt="&quot;OpenStack&quot;"></p>
<h2 id="十、启动第一个实例"><a href="#十、启动第一个实例" class="headerlink" title="十、启动第一个实例"></a><strong>十、启动第一个实例</strong></h2><h3 id="10-1-创建第一个实例"><a href="#10-1-创建第一个实例" class="headerlink" title="10.1 创建第一个实例"></a><strong>10.1 创建第一个实例</strong></h3><p>首先是我选用的网络类型是提供商网络（）</p>
<p>创建一个环境</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">openstack flavor create --id <span class="number">0</span> --vcpus <span class="number">1</span> --ram <span class="number">1024</span> --disk <span class="number">10</span> m1.nano</span><br><span class="line">##########</span><br><span class="line">ID表示为唯一识别的标志</span><br><span class="line">--ram 表示内存的大小</span><br><span class="line">--disk <span class="number">10</span> 代表存储空间为<span class="number">10</span>G</span><br><span class="line">M1.nano 为名字</span><br></pre></td></tr></table></figure>
<h3 id="10-2-生成一个密钥对"><a href="#10-2-生成一个密钥对" class="headerlink" title="10.2**生成一个密钥对**"></a><strong>10.2**</strong>生成一个密钥对**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">$ . demo-openrc</span><br><span class="line">$ ssh-keygen -q -N <span class="string">""</span></span><br><span class="line">$ openstack keypair create --public-key ~<span class="regexp">/.ssh/i</span>d_rsa.pub mykey</span><br><span class="line">+-------------+-------------------------------------------------+</span><br><span class="line">| Field       | Value                                           |</span><br><span class="line">+-------------+-------------------------------------------------+</span><br><span class="line">| fingerprint | ee:<span class="number">3</span>d:<span class="number">2</span>e:<span class="number">97</span>:d4:e2:<span class="number">6</span>a:<span class="number">54</span>:<span class="number">6</span>d:<span class="number">0</span>d:ce:<span class="number">43</span>:<span class="number">39</span>:<span class="number">2</span>c:ba:<span class="number">4</span>d |</span><br><span class="line">| name        | mykey                                           |</span><br><span class="line">| user_id     | <span class="number">58126687</span>cbcc4888bfa9ab73a2256f27                |</span><br><span class="line">+-------------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>查看</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$ openstack keypair list</span><br><span class="line"></span><br><span class="line">+-------+-------------------------------------------------+</span><br><span class="line">| Name  | Fingerprint                                     |</span><br><span class="line">+-------+-------------------------------------------------+</span><br><span class="line">| mykey | ee:<span class="number">3</span>d:<span class="number">2</span>e:<span class="number">97</span>:d4:e2:<span class="number">6</span>a:<span class="number">54</span>:<span class="number">6</span>d:<span class="number">0</span>d:ce:<span class="number">43</span>:<span class="number">39</span>:<span class="number">2</span>c:ba:<span class="number">4</span>d |</span><br><span class="line">+-------+-------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="10-3创建一个icmp"><a href="#10-3创建一个icmp" class="headerlink" title="10.3创建一个icmp"></a><strong>10.3创建一个icmp</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto icmp <span class="keyword">default</span></span><br></pre></td></tr></table></figure>
<p><strong>添加规则</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack security group rule create --proto tcp --dst-port <span class="number">22</span> <span class="keyword">default</span></span><br></pre></td></tr></table></figure>
<h3 id="10-4创建网络"><a href="#10-4创建网络" class="headerlink" title="10.4创建网络"></a><strong>10.4创建网络</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ . admin-openrc</span><br><span class="line">$ openstack network create  --share --external \</span><br><span class="line">  --provider-physical-network provider \</span><br><span class="line">  --provider-network-type flat provider</span><br><span class="line">该--share选项允许所有项目使用虚拟网络。</span><br><span class="line">该--external选项将虚拟网络定义为外部。如果你想创建一个内部网络，你可以使用--internal。默认值是internal。</span><br></pre></td></tr></table></figure>
<h3 id="10-5创建子网"><a href="#10-5创建子网" class="headerlink" title="10.5创建子网"></a><strong>10.5创建子网</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$ openstack subnet create --network provider \</span><br><span class="line">  --allocation-pool start=<span class="number">192.168</span><span class="number">.57</span><span class="number">.100</span>,end=<span class="number">192.168</span><span class="number">.57</span><span class="number">.200</span> \</span><br><span class="line">  --dns-nameserver <span class="number">202.101</span><span class="number">.224</span><span class="number">.68</span> --gateway <span class="number">192.168</span><span class="number">.57</span><span class="number">.2</span> \</span><br><span class="line">  --subnet-range <span class="number">192.168</span><span class="number">.57</span><span class="number">.0</span>/<span class="number">24</span> provider</span><br></pre></td></tr></table></figure>
<h3 id="10-6创建虚拟机"><a href="#10-6创建虚拟机" class="headerlink" title="10.6创建虚拟机"></a><strong>10.6创建虚拟机</strong></h3><p>查看有那些配置选项</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack flavor list</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br><span class="line">| ID | Name       |  RAM | Disk | Ephemeral | VCPUs | Is Public |</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br><span class="line">| <span class="number">0</span>  | m1.nano    | <span class="number">1024</span> |    <span class="number">1</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">10</span> | liang.nano | <span class="number">1024</span> |    <span class="number">5</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">2</span>  | m.nano     | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |    <span class="number">10</span> | True      |</span><br><span class="line">| <span class="number">3</span>  | m2.nano    | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">| <span class="number">4</span>  | m4.nano    | <span class="number">1024</span> |   <span class="number">10</span> |         <span class="number">0</span> |     <span class="number">1</span> | True      |</span><br><span class="line">+----+------------+------+------+-----------+-------+-----------+</span><br></pre></td></tr></table></figure>
<p>查看可以用的镜像</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack image list</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br><span class="line">| ID                                   | Name               | Status |</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br><span class="line">| <span class="number">470802</span>c8<span class="number">-3385</span><span class="number">-4e08</span>-b069-ace2d3f8e914 | Centos7            | active |</span><br><span class="line">| <span class="number">984e73</span>aa<span class="number">-1</span>faf<span class="number">-40</span>c6<span class="number">-88</span>ee<span class="number">-5532</span>ab7cf41f | cirros             | active |</span><br><span class="line">| <span class="number">742</span>c7273<span class="number">-56</span>f2<span class="number">-43e2</span><span class="number">-8816</span><span class="number">-98</span>f980fd97d7 | windows Server2003 | active |</span><br><span class="line">+--------------------------------------+--------------------+--------+</span><br></pre></td></tr></table></figure>
<p>查看可用网络</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack network list</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| ID                                   | Name     | Subnets                              |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">| <span class="number">161</span>a2f1e<span class="number">-5</span>c2d<span class="number">-418</span>a<span class="number">-91</span>a3<span class="number">-7</span>a1d9aa35200 | provider | <span class="number">80695e60</span>-cd51<span class="number">-4385</span><span class="number">-8</span>af3-cd792f3a77ef |</span><br><span class="line">+--------------------------------------+----------+--------------------------------------+</span><br><span class="line">[root@linux-node2 ~]# openstack security group list</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br><span class="line">| ID                                   | Name    | Description | Project                          |</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br><span class="line">| <span class="number">593</span>ef5a3-b48b<span class="number">-483e-8753</span>-aabd81afae8a | <span class="keyword">default</span> | 缺省安全组  | <span class="number">2534</span>c30f191a40038947f238c534c20d |</span><br><span class="line">| <span class="number">73</span>b40ecf<span class="number">-1</span>bfb<span class="number">-49</span>d1<span class="number">-9382</span><span class="number">-05e3</span>a2d0f577 | liang   | adasd       | <span class="number">497</span>f3c89978641479a56bb6954b6da7d |</span><br><span class="line">+--------------------------------------+---------+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p>创建虚拟机</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack server create --flavor m1.nano --image cirros \</span><br><span class="line">&gt; --nic net-id=<span class="number">3</span>de76652<span class="number">-72</span>aa<span class="number">-4638</span><span class="number">-9</span>c31<span class="number">-7465055</span>db1f3 --security-group <span class="keyword">default</span> \</span><br><span class="line">&gt; --key-name mykey provider-instance</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| Field                       | Value                                         |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br><span class="line">| OS-DCF:diskConfig           | MANUAL                                        |</span><br><span class="line">| OS-EXT-AZ:availability_zone |                                               |</span><br><span class="line">| OS-EXT-STS:power_state      | NOSTATE                                       |</span><br><span class="line">| OS-EXT-STS:task_state       | scheduling                                    |</span><br><span class="line">| OS-EXT-STS:vm_state         | building                                      |</span><br><span class="line">| OS-SRV-USG:launched_at      | None                                          |</span><br><span class="line">| OS-SRV-USG:terminated_at    | None                                          |</span><br><span class="line">| accessIPv4                  |                                               |</span><br><span class="line">| accessIPv6                  |                                               |</span><br><span class="line">| addresses                   |                                               |</span><br><span class="line">| adminPass                   | LYFNpN5rHRnx                                  |</span><br><span class="line">| config_drive                |                                               |</span><br><span class="line">| created                     | <span class="number">2018</span><span class="number">-01</span><span class="number">-03</span>T07:<span class="number">39</span>:<span class="number">13</span>Z                          |</span><br><span class="line">| flavor                      | m1.nano (<span class="number">0</span>)                                   |</span><br><span class="line">| hostId                      |                                               |</span><br><span class="line">| id                          | <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3          |</span><br><span class="line">| image                       | cirros (<span class="number">984e73</span>aa<span class="number">-1</span>faf<span class="number">-40</span>c6<span class="number">-88</span>ee<span class="number">-5532</span>ab7cf41f) |</span><br><span class="line">| key_name                    | mykey                                         |</span><br><span class="line">| name                        | provider-instance                             |</span><br><span class="line">| progress                    | <span class="number">0</span>                                             |</span><br><span class="line">| project_id                  | <span class="number">497</span>f3c89978641479a56bb6954b6da7d              |</span><br><span class="line">| properties                  |                                               |</span><br><span class="line">| security_groups             | name=<span class="string">'ff0181e2-596b-4e1b-87d9-90647674194b'</span>   |</span><br><span class="line">| status                      | BUILD                                         |</span><br><span class="line">| updated                     | <span class="number">2018</span><span class="number">-01</span><span class="number">-03</span>T07:<span class="number">39</span>:<span class="number">13</span>Z                          |</span><br><span class="line">| user_id                     | <span class="number">1</span>df20bd306664a498a6c9d6af66263a8              |</span><br><span class="line">| volumes_attached            |                                               |</span><br><span class="line">+-----------------------------+-----------------------------------------------+</span><br></pre></td></tr></table></figure>
<p>查看虚拟机（状态从改变BUILD到ACTIVE时构建过程成功完成。）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# openstack server list</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">| ID                                   | Name              | Status | Networks | Image  | Flavor  |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">| <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3 | provider-instance | BUILD  |          | cirros | m1.nano |</span><br><span class="line">+--------------------------------------+-------------------+--------+----------+--------+---------+</span><br><span class="line">[root@linux-node2 ~]# openstack server list</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">| ID                                   | Name              | Status | Networks                | Image  | Flavor  |</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">| <span class="number">00</span>d4afc5<span class="number">-266</span>f<span class="number">-4852</span><span class="number">-9</span>c7f-b86c2a5ec3f3 | provider-instance | ACTIVE | provider=<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> | cirros | m1.nano |</span><br><span class="line">+--------------------------------------+-------------------+--------+-------------------------+--------+---------+</span><br><span class="line">查看虚拟机的VNC的URL</span><br><span class="line">[root@linux-node2 ~]# openstack console url show provider-instance</span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br><span class="line">| Field | Value                                                                            |</span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br><span class="line">| type  | novnc                                                                            |</span><br><span class="line">| url   | http:<span class="comment">//linux-node2:6080/vnc_auto.html?token=2d0363d8-dcc7-4048-a3e8-38ad0551bc18 |</span></span><br><span class="line">+-------+----------------------------------------------------------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="10-7网页查看"><a href="#10-7网页查看" class="headerlink" title="10.7网页查看"></a><strong>10.7网页查看</strong></h3><p><img src="http://yun.name168.cn/OpenStack003.png" alt="&quot;OpenStack&quot;"></p>
<h3 id="10-8-测试网络连通性"><a href="#10-8-测试网络连通性" class="headerlink" title="10.8 测试网络连通性"></a><strong>10.8 测试网络连通性</strong></h3><p>在openstack server list中查看的IP地址为192.168.57.105</p>
<p>现在在node1 node2 进行测试</p>
<p>Node2 测试结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# ping -c 4 192.168.57.105</span><br><span class="line">PING <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> (<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>) <span class="number">56</span>(<span class="number">84</span>) bytes <span class="keyword">of</span> data.</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">2.48</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">2.23</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">1.84</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">2.64</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> ping statistics ---</span><br><span class="line"><span class="number">4</span> packets transmitted, <span class="number">4</span> received, <span class="number">0</span>% packet loss, time <span class="number">3005</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">1.841</span>/<span class="number">2.299</span>/<span class="number">2.642</span>/<span class="number">0.305</span> ms</span><br></pre></td></tr></table></figure>
<p>node1 测试结果</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node1 neutron]#  ping -c 4 192.168.57.105</span><br><span class="line">PING <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> (<span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>) <span class="number">56</span>(<span class="number">84</span>) bytes <span class="keyword">of</span> data.</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">1</span> ttl=<span class="number">64</span> time=<span class="number">1.33</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">2</span> ttl=<span class="number">64</span> time=<span class="number">0.873</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">3</span> ttl=<span class="number">64</span> time=<span class="number">1.22</span> ms</span><br><span class="line"><span class="number">64</span> bytes <span class="keyword">from</span> <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span>: icmp_seq=<span class="number">4</span> ttl=<span class="number">64</span> time=<span class="number">2.47</span> ms</span><br><span class="line"></span><br><span class="line">--- <span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span> ping statistics ---</span><br><span class="line"><span class="number">4</span> packets transmitted, <span class="number">4</span> received, <span class="number">0</span>% packet loss, time <span class="number">3004</span>ms</span><br><span class="line">rtt min/avg/max/mdev = <span class="number">0.873</span>/<span class="number">1.478</span>/<span class="number">2.476</span>/<span class="number">0.602</span> ms</span><br></pre></td></tr></table></figure>
<h3 id="10-9-S-sh连接测试一下"><a href="#10-9-S-sh连接测试一下" class="headerlink" title="10.9 S**sh连接测试一下**"></a><strong>10.9</strong> <strong>S**</strong>sh连接测试一下**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 ~]# ssh cirros@192.168.57.105</span><br><span class="line">The authenticity <span class="keyword">of</span> host <span class="string">'192.168.57.105 (192.168.57.105)'</span> can<span class="string">'t be established.</span></span><br><span class="line"><span class="string">RSA key fingerprint is SHA256:7Qa9JtqTy/3uqoJKw7doB6hC93pHEuHbv+e6xpgPGD8.</span></span><br><span class="line"><span class="string">RSA key fingerprint is MD5:61:64:aa:1a:94:f7:dc:26:58:f5:cf:fd:ba:48:66:b5.</span></span><br><span class="line"><span class="string">Are you sure you want to continue connecting (yes/no)? yes</span></span><br><span class="line"><span class="string">Warning: Permanently added '</span><span class="number">192.168</span><span class="number">.57</span><span class="number">.105</span><span class="string">' (RSA) to the list of known hosts.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">$ ifconfig</span></span><br><span class="line"><span class="string">eth0      Link encap:Ethernet  HWaddr FA:16:3E:27:D7:37  </span></span><br><span class="line"><span class="string">          inet addr:192.168.57.105  Bcast:192.168.57.255  Mask:255.255.255.0</span></span><br><span class="line"><span class="string">          inet6 addr: fe80::f816:3eff:fe27:d737/64 Scope:Link</span></span><br><span class="line"><span class="string">          UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1</span></span><br><span class="line"><span class="string">          RX packets:364 errors:0 dropped:0 overruns:0 frame:0</span></span><br><span class="line"><span class="string">          TX packets:249 errors:0 dropped:0 overruns:0 carrier:0</span></span><br><span class="line"><span class="string">          collisions:0 txqueuelen:1000 </span></span><br><span class="line"><span class="string">          RX bytes:33991 (33.1 KiB)  TX bytes:26215 (25.6 KiB)</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">lo        Link encap:Local Loopback  </span></span><br><span class="line"><span class="string">          inet addr:127.0.0.1  Mask:255.0.0.0</span></span><br><span class="line"><span class="string">          inet6 addr: ::1/128 Scope:Host</span></span><br><span class="line"><span class="string">          UP LOOPBACK RUNNING  MTU:16436  Metric:1</span></span><br><span class="line"><span class="string">          RX packets:0 errors:0 dropped:0 overruns:0 frame:0</span></span><br><span class="line"><span class="string">          TX packets:0 errors:0 dropped:0 overruns:0 carrier:0</span></span><br><span class="line"><span class="string">          collisions:0 txqueuelen:0 </span></span><br><span class="line"><span class="string">          RX bytes:0 (0.0 B)  TX bytes:0 (0.0 B)</span></span><br></pre></td></tr></table></figure>
<h2 id="十一、块存储服务（控制节点node2-操作）"><a href="#十一、块存储服务（控制节点node2-操作）" class="headerlink" title="十一、块存储服务（控制节点node2 操作）"></a><strong>十一、块存储服务（控制节点node2 操作）</strong></h2><h3 id="11-1-数据库操作"><a href="#11-1-数据库操作" class="headerlink" title="11.1 数据库操作"></a><strong>11.1 数据库操作</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ mysql -u root –p</span><br><span class="line">MariaDB [(none)]&gt; CREATE DATABASE cinder;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">'cinder'</span>@<span class="string">'localhost'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'cinder'</span>;</span><br><span class="line">MariaDB [(none)]&gt; GRANT ALL PRIVILEGES ON cinder.* TO <span class="string">'cinder'</span>@<span class="string">'%'</span> \</span><br><span class="line">  IDENTIFIED BY <span class="string">'cinder'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="11-2-创建服务凭据"><a href="#11-2-创建服务凭据" class="headerlink" title="11.2**创建服务凭据**"></a><strong>11.2**</strong>创建服务凭据**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">$ openstack user create --domain <span class="keyword">default</span> --password-prompt cinder</span><br><span class="line"></span><br><span class="line">User Password: cinder  ###密码</span><br><span class="line">Repeat User Password: cinder </span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| Field               | Value                            |</span><br><span class="line">+---------------------+----------------------------------+</span><br><span class="line">| domain_id           | <span class="keyword">default</span>                          |</span><br><span class="line">| enabled             | True                             |</span><br><span class="line">| id                  | <span class="number">9</span>d7e33de3e1a498390353819bc7d245d |</span><br><span class="line">| name                | cinder                           |</span><br><span class="line">| options             | &#123;&#125;                               |</span><br><span class="line">| password_expires_at | None                             |</span><br><span class="line">+---------------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<p>添加到admin组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ openstack role add --project service --user cinder admin</span><br></pre></td></tr></table></figure>
<h3 id="11-3-创建cinderv2和cinderv3服务实体："><a href="#11-3-创建cinderv2和cinderv3服务实体：" class="headerlink" title="11.3 创建cinderv2和cinderv3服务实体："></a><strong>11.3</strong> <strong>创建cinderv2和cinderv3服务实体：</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">$ openstack service create --name cinderv2 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev2</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | eb9fd245bdbc414695952e93f29fe3ac |</span><br><span class="line">| name        | cinderv2                         |</span><br><span class="line">| type        | volumev2                         |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">$ openstack service create --name cinderv3 \</span><br><span class="line">  --description <span class="string">"OpenStack Block Storage"</span> volumev3</span><br><span class="line"></span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| Field       | Value                            |</span><br><span class="line">+-------------+----------------------------------+</span><br><span class="line">| description | OpenStack Block Storage          |</span><br><span class="line">| enabled     | True                             |</span><br><span class="line">| id          | ab3bbbef780845a1a283490d281e7fda |</span><br><span class="line">| name        | cinderv3                         |</span><br><span class="line">| type        | volumev3                         |</span><br><span class="line">+-------------+----------------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="11-4建立快存储API"><a href="#11-4建立快存储API" class="headerlink" title="11.4建立快存储API"></a><strong>11.4建立快存储API</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 public http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 internal http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">$ openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev2 admin http:<span class="comment">//linux-node2:8776/v2/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 public http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 internal http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br><span class="line"></span><br><span class="line">openstack endpoint create --region RegionOne \</span><br><span class="line">  volumev3 admin http:<span class="comment">//linux-node2:8776/v3/%\(project_id\)s</span></span><br></pre></td></tr></table></figure>
<h3 id="11-5-安装cinder"><a href="#11-5-安装cinder" class="headerlink" title="11.5 安装cinder"></a><strong>11.5 安装cinder</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># yum install openstack-cinder</span><br></pre></td></tr></table></figure>
<h3 id="11-6配置cinder（-etc-cinder-cinder-conf-）"><a href="#11-6配置cinder（-etc-cinder-cinder-conf-）" class="headerlink" title="11.6配置cinder（**/etc/cinder/cinder.conf**）"></a><strong>11.6配置cinder（**</strong>/etc/cinder/cinder.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[database]</span><br><span class="line">connection = mysql:<span class="comment">//cinder:cinder @linux-node2/cinder</span></span><br></pre></td></tr></table></figure>
<p>default部分</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT] # ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.145</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/cinder/tmp</span><br></pre></td></tr></table></figure>
<p>配置计算使用块存储<a href="https://www.o2oxy.cn/917.html#configure-compute-to-use-block-storage" target="_blank" rel="noopener"><strong>¶</strong></a></p>
<p>编辑/etc/nova/nova.conf文件并添加以下内容：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[cinder] </span><br><span class="line">os_region_name  =  RegionOne</span><br></pre></td></tr></table></figure>
<h3 id="11-7-填充数据库"><a href="#11-7-填充数据库" class="headerlink" title="11.7 填充数据库"></a><strong>11.7 填充数据库</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># su -s /bin/sh -c "cinder-manage db sync" cinder</span><br></pre></td></tr></table></figure>
<h3 id="11-8-完成安装"><a href="#11-8-完成安装" class="headerlink" title="11.8**完成安装**"></a><strong>11.8**</strong>完成安装**</h3><p>重新启动计算API服务：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"># systemctl restart openstack-nova-api.service</span><br></pre></td></tr></table></figure>
<p>启动块存储服务并将其配置为在系统引导时启动：</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-cinder-api.service openstack-cinder-scheduler.service</span><br><span class="line"># systemctl start openstack-cinder-api.service openstack-cinder-scheduler.service</span><br></pre></td></tr></table></figure>
<h2 id="十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）"><a href="#十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）" class="headerlink" title="十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）"></a><strong>十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）</strong></h2><p>首先添加一块硬盘50G吧。使用LVM的方式</p>
<h3 id="12-1-安装lvm"><a href="#12-1-安装lvm" class="headerlink" title="12.1 安装lvm"></a><strong>12.1 安装lvm</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># yum install lvm2</span><br><span class="line"># systemctl enable lvm2-lvmetad.service</span><br><span class="line"># systemctl start lvm2-lvmetad.service</span><br></pre></td></tr></table></figure>
<h3 id="12-2配置lvm"><a href="#12-2配置lvm" class="headerlink" title="12.2配置lvm"></a><strong>12.2配置lvm</strong></h3><p>创建LVM物理卷/dev/sdb</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># pvcreate /dev/sdb</span><br><span class="line"></span><br><span class="line">Physical volume <span class="string">"/dev/sdb"</span> successfully created</span><br></pre></td></tr></table></figure>
<p>创建LVM卷组cinder-volumes：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># vgcreate cinder-volumes /dev/sdb</span><br><span class="line"></span><br><span class="line">Volume group <span class="string">"cinder-volumes"</span> successfully created</span><br></pre></td></tr></table></figure>
<p>编辑 /etc/lvm/lvm.conf</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">devices &#123;</span><br><span class="line">...</span><br><span class="line">filter = [ <span class="string">"a/sdb/"</span>, <span class="string">"r/.*/"</span>]</span><br></pre></td></tr></table></figure>
<p>#################################其他方式</p>
<p>如果您的存储节点在操作系统磁盘上使用LVM，则还必须将关联的设备添加到过滤器。例如，如果/dev/sda设备包含操作系统：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter  =  [“a / sda /”，“a / sdb /”，“r /.*<span class="regexp">/”]</span></span><br></pre></td></tr></table></figure>
<p>同样，如果计算节点在操作系统磁盘上使用LVM，则还必须修改/etc/lvm/lvm.conf这些节点上的文件中的筛选器， 使其只包含操作系统磁盘。例如，如果/dev/sda 设备包含操作系统：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">filter  =  [“a / sda /”，“r /.*<span class="regexp">/”]</span></span><br></pre></td></tr></table></figure>
<h3 id="12-3-安装和配置的部件"><a href="#12-3-安装和配置的部件" class="headerlink" title="12.3**安装和配置的部件**"></a><strong>12.3**</strong>安装和配置的部件**</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum install openstack-cinder targetcli python-keystone</span><br></pre></td></tr></table></figure>
<h3 id="12-4配置主配置文件（-etc-cinder-cinder-conf-）"><a href="#12-4配置主配置文件（-etc-cinder-cinder-conf-）" class="headerlink" title="12.4配置主配置文件（**/etc/cinder/cinder.conf**）"></a><strong>12.4配置主配置文件（**</strong>/etc/cinder/cinder.conf<strong>**）</strong></h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">[DEFAULT]</span><br><span class="line"># ...</span><br><span class="line">transport_url = rabbit:<span class="comment">//openstack:openstack@linux-node2</span></span><br><span class="line">auth_strategy = keystone</span><br><span class="line">my_ip = <span class="number">192.168</span><span class="number">.57</span><span class="number">.142</span></span><br><span class="line">enabled_backends = lvm</span><br><span class="line">glance_api_servers = http:<span class="comment">//linux-node2:9292</span></span><br><span class="line">[database]</span><br><span class="line"># ...</span><br><span class="line">connection = mysql:<span class="comment">//cinder:cinder@linux-node2/cinder</span></span><br><span class="line">[keystone_authtoken]</span><br><span class="line"># ...</span><br><span class="line">auth_uri = http:<span class="comment">//linux-node2:5000</span></span><br><span class="line">auth_url = http:<span class="comment">//linux-node2:35357</span></span><br><span class="line">memcached_servers = linux-node2:<span class="number">11211</span></span><br><span class="line">auth_type = password</span><br><span class="line">project_domain_name = <span class="keyword">default</span></span><br><span class="line">user_domain_name = <span class="keyword">default</span></span><br><span class="line">project_name = service</span><br><span class="line">username = cinder</span><br><span class="line">password = cinder</span><br><span class="line">########【lvm】在最后面添加###############</span><br><span class="line">[lvm]</span><br><span class="line">volume_driver = cinder.volume.drivers.lvm.LVMVolumeDriver</span><br><span class="line">volume_group = cinder-volumes</span><br><span class="line">iscsi_protocol = iscsi</span><br><span class="line">iscsi_helper = lioadm</span><br><span class="line">[oslo_concurrency]</span><br><span class="line"># ...</span><br><span class="line">lock_path = <span class="regexp">/var/</span>lib/cinder/tmp</span><br></pre></td></tr></table></figure>
<h3 id="12-5-启动"><a href="#12-5-启动" class="headerlink" title="12.5 启动"></a><strong>12.5 启动</strong></h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># systemctl enable openstack-cinder-volume.service target.service</span><br><span class="line"># systemctl start openstack-cinder-volume.service target.service</span><br></pre></td></tr></table></figure>
<p>12.6 检查</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# admin-openrc</span><br><span class="line">[root@linux-node2 cinder]# openstack volume service list</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br><span class="line">| Binary           | Host            | Zone | Status  | State | Updated At                 |</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br><span class="line">| cinder-scheduler | linux-node2     | nova | enabled | up    | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T16:<span class="number">11</span>:<span class="number">10.000000</span> |</span><br><span class="line">| cinder-volume    | linux-node1@lvm | nova | enabled | up    | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T16:<span class="number">11</span>:<span class="number">05.000000</span> |</span><br><span class="line">+------------------+-----------------+------+---------+-------+----------------------------+</span><br></pre></td></tr></table></figure>
<h3 id="12-7-创建块存储"><a href="#12-7-创建块存储" class="headerlink" title="12.7 创建块存储"></a><strong>12.7 创建块存储</strong></h3><p>创建一个10G的存储</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume create --size 10 volume1</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| Field               | Value                                |</span><br><span class="line">+---------------------+--------------------------------------+</span><br><span class="line">| attachments         | []                                   |</span><br><span class="line">| availability_zone   | nova                                 |</span><br><span class="line">| bootable            | <span class="literal">false</span>                                |</span><br><span class="line">| consistencygroup_id | None                                 |</span><br><span class="line">| created_at          | <span class="number">2018</span><span class="number">-01</span><span class="number">-02</span>T15:<span class="number">46</span>:<span class="number">13.269273</span>           |</span><br><span class="line">| description         | None                                 |</span><br><span class="line">| encrypted           | False                                |</span><br><span class="line">| id                  | d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c |</span><br><span class="line">| migration_status    | None                                 |</span><br><span class="line">| multiattach         | False                                |</span><br><span class="line">| name                | volume1                              |</span><br><span class="line">| properties          |                                      |</span><br><span class="line">| replication_status  | None                                 |</span><br><span class="line">| size                | <span class="number">10</span>                                   |</span><br><span class="line">| snapshot_id         | None                                 |</span><br><span class="line">| source_volid        | None                                 |</span><br><span class="line">| status              | creating                             |</span><br><span class="line">| type                | None                                 |</span><br><span class="line">| updated_at          | None                                 |</span><br><span class="line">| user_id             | <span class="number">40</span>a299a16064488facc16764cb635c12     |</span><br><span class="line">+---------------------+--------------------------------------+</span><br></pre></td></tr></table></figure>
<p><strong>查看</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume list</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br><span class="line">| ID                                   | Name    | Status    | Size | Attached to |</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br><span class="line">| d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c | volume1 | available |   <span class="number">10</span> |             |</span><br><span class="line">+--------------------------------------+---------+-----------+------+-------------+</span><br></pre></td></tr></table></figure>
<h3 id="12-7-将卷附加到实例"><a href="#12-7-将卷附加到实例" class="headerlink" title="12.7**将卷附加到实例**"></a><strong>12.7**</strong>将卷附加到实例**</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack server add volume provider-instance volume1</span><br></pre></td></tr></table></figure>
<p>查看</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[root@linux-node2 cinder]# openstack volume list</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">| ID                                   | Name    | Status | Size | Attached to                                |</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">| d1b2e03b-c80a<span class="number">-4</span>cde-ad25<span class="number">-65</span>abab621b0c | volume1 | <span class="keyword">in</span>-use |   <span class="number">10</span> | Attached to provider-instance on /dev/vdb  |</span><br><span class="line">+--------------------------------------+---------+--------+------+--------------------------------------------+</span><br><span class="line">[root@linux-node2 cinder]#</span><br></pre></td></tr></table></figure>
<h2 id="十三、安装虚拟机"><a href="#十三、安装虚拟机" class="headerlink" title="十三、安装虚拟机"></a><strong>十三、安装虚拟机</strong></h2><p>这里我是自己上传了一个Centos7 的镜像。像上面创建实例一样创建的。后面把硬盘添加到这个实例里面。后面启动。就有了下面的画面</p>
<p><img src="http://yun.name168.cn/OpenStack004.png" alt="&quot;OpenStack&quot;"></p>
<p><img src="http://yun.name168.cn/OpenStack005.png" alt="&quot;OpenStack&quot;"></p>
<p>已经显示有10G硬盘了。现在可以安装系统了。我笔记本配置比较渣渣。弄起来太慢了</p>
<p><img src="http://yun.name168.cn/OpenStack006.png" alt="&quot;OpenStack&quot;"></p>
<p>用VNC连接node1 的KVM就可以操作了。网页不好操作</p>
<p><img src="http://yun.name168.cn/OpenStack007.png" alt="&quot;OpenStack&quot;"></p>
<p>Node1 中有一个5901的进程。我们用VNC的客户端连接一下就够了</p>
<p><img src="http://yun.name168.cn/OpenStack008.png" alt="&quot;OpenStack&quot;"></p>
<p><img src="http://yun.name168.cn/OpenStack009.png" alt="&quot;OpenStack&quot;"></p>
<p>只要等它安装完就够了。</p>
    </div>
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div></div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.png" alt="欧阳 Blog 微信支付"/>
        <p>微信支付</p>
      </div>
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="欧阳 Blog 支付宝"/>
        <p>支付宝</p>
      </div>
  </div>
</div>
      </div>
      <div>
        <ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者：</strong>
    欧阳 Blog
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/" title="Centos7 搭建openstack ocata 版">https://www.5658.pw/2019/05/11/Centos7-搭建openstack-ocata-版/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>
    本博客所有文章除特别声明外，均采用 <a href="https://5658.pw" rel="external nofollow" target="_blank">CC BY-OuYang</a> 许可协议。转载请注明出处！
  </li>
</ul>
      </div>
    <footer class="post-footer">
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
              <a href="/2019/05/11/我的CSP绕过思路及总结/" rel="next" title="我的CSP绕过思路及总结">
                <i class="fa fa-chevron-left"></i> 我的CSP绕过思路及总结
              </a>
          </div>
          <span class="post-nav-divider"></span>
          <div class="post-nav-prev post-nav-item">
          </div>
        </div>
    </footer>
  </div>
  </article>
    <div class="post-spread">
    </div>
  </div>
          </div>
    <div class="comments" id="comments">
    </div>
        </div>
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>
  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
	<a href="/">
              <img class="site-author-image" itemprop="image"
                src="/images/avatar.png"
                alt="欧阳 Blog" />
	</a>
              <p class="site-author-name" itemprop="name">欧阳 Blog</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>
          <nav class="site-state motion-element">
              <div class="site-state-item site-state-posts">
                <a href="/archives/">
                  <span class="site-state-item-count">28</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">19</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">64</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
          </nav>
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
            <div class="links-of-author motion-element">
                  <span class="links-of-author-item">
                    <a href="https://www.5658.pw" target="_blank" title="QQ">
                        <i class="fa fa-fw fa-qq"></i>QQ</a>
                  </span>
                  <span class="links-of-author-item">
                    <a href="mailto:dash6@foxmail.com" target="_blank" title="E-Mail">
                        <i class="fa fa-fw fa-envelope"></i>E-Mail</a>
                  </span>
            </div>
        </div>
      </section>
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#二、基础环境"><span class="nav-number">1.</span> <span class="nav-text">二、基础环境</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-时间同步（node1-node2-操作）"><span class="nav-number">1.1.</span> <span class="nav-text">2.1 时间同步（node1 +node2 操作）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-安装mysql（node2主控制节点操作）"><span class="nav-number">1.2.</span> <span class="nav-text">2.2 安装mysql（node2主控制节点操作）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-安装消息队列（node2控制节点操作）"><span class="nav-number">1.3.</span> <span class="nav-text">2.3 安装消息队列（node2控制节点操作）</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#三、搭建openstack"><span class="nav-number">2.</span> <span class="nav-text">三、搭建openstack</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-安装keystone-组件介绍"><span class="nav-number">2.1.</span> <span class="nav-text">3.1 安装keystone 组件介绍</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-安装keystone-组件（node2-主控制节点操作）"><span class="nav-number">2.2.</span> <span class="nav-text">3.2 安装keystone 组件（node2 主控制节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-1修改配置文件"><span class="nav-number">2.2.1.</span> <span class="nav-text">3.2.1修改配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-2同步数据库"><span class="nav-number">2.2.2.</span> <span class="nav-text">3.2.2同步数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-3配置memcache的配置-（-etc-sysconfig-memcached-）"><span class="nav-number">2.2.3.</span> <span class="nav-text">3.2.3配置memcache的配置 （**/etc/sysconfig/memcached**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-4启动memcache"><span class="nav-number">2.2.4.</span> <span class="nav-text">3.2.4启动memcache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-5设置apache"><span class="nav-number">2.2.5.</span> <span class="nav-text">3.2.5设置apache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-6修改主apache的主配置文件"><span class="nav-number">2.2.6.</span> <span class="nav-text">3.2.6修改主apache的主配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-7启动apache"><span class="nav-number">2.2.7.</span> <span class="nav-text">3.2.7启动apache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-8检查一下是否启动成功了"><span class="nav-number">2.2.8.</span> <span class="nav-text">3.2.8检查一下是否启动成功了</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-3-keystone-用户权限"><span class="nav-number">2.3.</span> <span class="nav-text">3.3   keystone 用户权限</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-1-设置环境变量"><span class="nav-number">2.3.1.</span> <span class="nav-text">3.3.1 设置环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-2创建域、项目、用户和角色"><span class="nav-number">2.3.2.</span> <span class="nav-text">3.3.2创建域、项目、用户和角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-3-验证操作"><span class="nav-number">2.3.3.</span> <span class="nav-text">3.3.3**验证操作**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-4-创建-OpenStack-客户端环境脚本"><span class="nav-number">2.3.4.</span> <span class="nav-text">3.3.4**创建 OpenStack 客户端环境脚本**</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#四-：镜像服务-Glance（node2-主控制节点操作）"><span class="nav-number">2.4.</span> <span class="nav-text">四**：镜像服务**Glance（node2 主控制节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#4-1-Glance-介绍"><span class="nav-number">2.4.1.</span> <span class="nav-text">4.1 Glance 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-2-mysql-配置"><span class="nav-number">2.4.2.</span> <span class="nav-text">4.2 mysql 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-3-Glance安装"><span class="nav-number">2.4.3.</span> <span class="nav-text">4.3 Glance安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-4修改主配置文件-etc-glance-glance-api-conf"><span class="nav-number">2.4.4.</span> <span class="nav-text">4.4修改主配置文件**/etc/glance/glance-api.conf**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-5-修改主配置文件-etc-glance-glance-registry-conf"><span class="nav-number">2.4.5.</span> <span class="nav-text">4.5 修改主配置文件**/etc/glance/glance-registry.conf**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-6-设置数据库"><span class="nav-number">2.4.6.</span> <span class="nav-text">4.6 设置数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-7创建镜像服务的API服务"><span class="nav-number">2.4.7.</span> <span class="nav-text">4.7创建镜像服务的API服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-8-启动服务"><span class="nav-number">2.4.8.</span> <span class="nav-text">4.8 启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#4-9验证"><span class="nav-number">2.4.9.</span> <span class="nav-text">4.9验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#五、计算服务一-nova（node2控制节点操作）"><span class="nav-number">2.5.</span> <span class="nav-text">五、计算服务一 nova（node2控制节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#5-N-ova-作用"><span class="nav-number">2.5.1.</span> <span class="nav-text">5 .**N**ova 作用</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-1-新建数据库"><span class="nav-number">2.5.2.</span> <span class="nav-text">5.1 新建数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-2-创建nova用户："><span class="nav-number">2.5.3.</span> <span class="nav-text">5.2**创建nova用户：**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-3创建nova服务实体"><span class="nav-number">2.5.4.</span> <span class="nav-text">5.3创建nova服务实体</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-4创建服务API"><span class="nav-number">2.5.5.</span> <span class="nav-text">5.4创建服务API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-5新建另一个用户"><span class="nav-number">2.5.6.</span> <span class="nav-text">5.5新建另一个用户</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-6-在服务目录中创建Placement-API条目："><span class="nav-number">2.5.7.</span> <span class="nav-text">5.6**在服务目录中创建Placement API条目：**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-7-创建Placement-API服务端点："><span class="nav-number">2.5.8.</span> <span class="nav-text">5.7**创建Placement API服务端点：**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-8-安装和配置的部件"><span class="nav-number">2.5.9.</span> <span class="nav-text">5.8**安装和配置的部件**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-9修改配置文件-etc-nova-nova-conf"><span class="nav-number">2.5.10.</span> <span class="nav-text">5.9修改配置文件 /etc/nova/nova.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-10设置api和连接信息"><span class="nav-number">2.5.11.</span> <span class="nav-text">5.10设置api和连接信息</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-11设置glance"><span class="nav-number">2.5.12.</span> <span class="nav-text">5.11设置glance</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-12设置-oslo-concurrency"><span class="nav-number">2.5.13.</span> <span class="nav-text">5.12设置**[oslo_concurrency]**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-13设置-placement"><span class="nav-number">2.5.14.</span> <span class="nav-text">5.13设置**[placement]**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-14设置apache"><span class="nav-number">2.5.15.</span> <span class="nav-text">5.14设置apache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-15重启apache"><span class="nav-number">2.5.16.</span> <span class="nav-text">5.15重启apache</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#5-17验证"><span class="nav-number">2.5.17.</span> <span class="nav-text">5.17验证</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#六、计算服务二-nova（node1计算节点操作）"><span class="nav-number">2.6.</span> <span class="nav-text">六、计算服务二  nova（node1计算节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#6-1安装nova-compute"><span class="nav-number">2.6.1.</span> <span class="nav-text">6.1安装nova-compute</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-2配置主配置文件（-etc-nova-nova-conf-）"><span class="nav-number">2.6.2.</span> <span class="nav-text">6.2配置主配置文件（**/etc/nova/nova.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-3检查是否需要硬件加速"><span class="nav-number">2.6.3.</span> <span class="nav-text">6.3检查是否需要硬件加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-4启动服务"><span class="nav-number">2.6.4.</span> <span class="nav-text">6.4启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#6-5验证-node2-主节点操作"><span class="nav-number">2.6.5.</span> <span class="nav-text">6.5验证(node2 主节点操作)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#七、网络节点一（node2-主控制节点操作）"><span class="nav-number">2.7.</span> <span class="nav-text">七、网络节点一（node2 主控制节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#7-1-设置mysql"><span class="nav-number">2.7.1.</span> <span class="nav-text">7.1 设置mysql</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-2-创建服务凭据"><span class="nav-number">2.7.2.</span> <span class="nav-text">7.2**创建服务凭据**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-3-配置网络选项-（这里我选用的是网络1-的配置）"><span class="nav-number">2.7.3.</span> <span class="nav-text">7.3**配置网络选项**（这里我选用的是网络1 的配置）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-4-安装网络openstack-neutron"><span class="nav-number">2.7.4.</span> <span class="nav-text">7.4 安装网络openstack-neutron</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-5-编辑-etc-neutron-neutron-conf"><span class="nav-number">2.7.5.</span> <span class="nav-text">7.5 编辑/etc/neutron/neutron.conf</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-6-配置模块化层2（ML2）插件（-etc-neutron-plugins-ml2-ml2-conf-ini-）"><span class="nav-number">2.7.6.</span> <span class="nav-text">7.6**配置模块化层2（ML2）插件（/etc/neutron/plugins/ml2/ml2_conf.ini**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-7-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><span class="nav-number">2.7.7.</span> <span class="nav-text">7.7**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-8-配置DHCP代理（-etc-neutron-dhcp-agent-ini-）"><span class="nav-number">2.7.8.</span> <span class="nav-text">7.8**配置DHCP代理（/etc/neutron/dhcp_agent.ini**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-9-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><span class="nav-number">2.7.9.</span> <span class="nav-text">7.9**配置计算服务以使用网络服务（/etc/nova/nova.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-10同步数据库"><span class="nav-number">2.7.10.</span> <span class="nav-text">7.10同步数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#7-10-启动服务"><span class="nav-number">2.7.11.</span> <span class="nav-text">7.10 启动服务</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#八、网络节点二、（node1-计算节点操作）"><span class="nav-number">2.8.</span> <span class="nav-text">八、网络节点二、（node1 计算节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#8-1-安装openstack-neutron"><span class="nav-number">2.8.1.</span> <span class="nav-text">8.1 安装openstack-neutron</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-2-配置通用组件（-etc-neutron-neutron-conf-）"><span class="nav-number">2.8.2.</span> <span class="nav-text">8.2**配置通用组件（/etc/neutron/neutron.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-3-配置计算服务以使用网络服务（-etc-nova-nova-conf-）"><span class="nav-number">2.8.3.</span> <span class="nav-text">8.3**配置计算服务以使用网络服务（/etc/nova/nova.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-4-配置Linux网桥代理（-etc-neutron-plugins-ml2-linuxbridge-agent-ini-）"><span class="nav-number">2.8.4.</span> <span class="nav-text">8.4**配置Linux网桥代理（/etc/neutron/plugins/ml2/linuxbridge_agent.ini**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-5-启动服务"><span class="nav-number">2.8.5.</span> <span class="nav-text">8.5 启动服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#8-6-验证操作"><span class="nav-number">2.8.6.</span> <span class="nav-text">8.6 验证操作</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#九、-Dashboard-（node2控制节点操作）"><span class="nav-number">2.9.</span> <span class="nav-text">九、**Dashboard**（node2控制节点操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#9-1-安装"><span class="nav-number">2.9.1.</span> <span class="nav-text">9.1 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-2配置主配置文件（-etc-openstack-dashboard-local-settings-）"><span class="nav-number">2.9.2.</span> <span class="nav-text">9.2配置主配置文件（**/etc/openstack-dashboard/local_settings**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-4重启服务"><span class="nav-number">2.9.3.</span> <span class="nav-text">9.4重启服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#9-5-访问openstack"><span class="nav-number">2.9.4.</span> <span class="nav-text">9.5 访问openstack</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十、启动第一个实例"><span class="nav-number">2.10.</span> <span class="nav-text">十、启动第一个实例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#10-1-创建第一个实例"><span class="nav-number">2.10.1.</span> <span class="nav-text">10.1 创建第一个实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-2-生成一个密钥对"><span class="nav-number">2.10.2.</span> <span class="nav-text">10.2**生成一个密钥对**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-3创建一个icmp"><span class="nav-number">2.10.3.</span> <span class="nav-text">10.3创建一个icmp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-4创建网络"><span class="nav-number">2.10.4.</span> <span class="nav-text">10.4创建网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-5创建子网"><span class="nav-number">2.10.5.</span> <span class="nav-text">10.5创建子网</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-6创建虚拟机"><span class="nav-number">2.10.6.</span> <span class="nav-text">10.6创建虚拟机</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-7网页查看"><span class="nav-number">2.10.7.</span> <span class="nav-text">10.7网页查看</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-8-测试网络连通性"><span class="nav-number">2.10.8.</span> <span class="nav-text">10.8 测试网络连通性</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#10-9-S-sh连接测试一下"><span class="nav-number">2.10.9.</span> <span class="nav-text">10.9 S**sh连接测试一下**</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十一、块存储服务（控制节点node2-操作）"><span class="nav-number">2.11.</span> <span class="nav-text">十一、块存储服务（控制节点node2 操作）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#11-1-数据库操作"><span class="nav-number">2.11.1.</span> <span class="nav-text">11.1 数据库操作</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-2-创建服务凭据"><span class="nav-number">2.11.2.</span> <span class="nav-text">11.2**创建服务凭据**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-3-创建cinderv2和cinderv3服务实体："><span class="nav-number">2.11.3.</span> <span class="nav-text">11.3 创建cinderv2和cinderv3服务实体：</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-4建立快存储API"><span class="nav-number">2.11.4.</span> <span class="nav-text">11.4建立快存储API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-5-安装cinder"><span class="nav-number">2.11.5.</span> <span class="nav-text">11.5 安装cinder</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-6配置cinder（-etc-cinder-cinder-conf-）"><span class="nav-number">2.11.6.</span> <span class="nav-text">11.6配置cinder（**/etc/cinder/cinder.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-7-填充数据库"><span class="nav-number">2.11.7.</span> <span class="nav-text">11.7 填充数据库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#11-8-完成安装"><span class="nav-number">2.11.8.</span> <span class="nav-text">11.8**完成安装**</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）"><span class="nav-number">2.12.</span> <span class="nav-text">十二、块存储服务（可以新开一台机器也可以使用计算节点，我这里使用的计算节点node1）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#12-1-安装lvm"><span class="nav-number">2.12.1.</span> <span class="nav-text">12.1 安装lvm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-2配置lvm"><span class="nav-number">2.12.2.</span> <span class="nav-text">12.2配置lvm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-3-安装和配置的部件"><span class="nav-number">2.12.3.</span> <span class="nav-text">12.3**安装和配置的部件**</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-4配置主配置文件（-etc-cinder-cinder-conf-）"><span class="nav-number">2.12.4.</span> <span class="nav-text">12.4配置主配置文件（**/etc/cinder/cinder.conf**）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-5-启动"><span class="nav-number">2.12.5.</span> <span class="nav-text">12.5 启动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-7-创建块存储"><span class="nav-number">2.12.6.</span> <span class="nav-text">12.7 创建块存储</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#12-7-将卷附加到实例"><span class="nav-number">2.12.7.</span> <span class="nav-text">12.7**将卷附加到实例**</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#十三、安装虚拟机"><span class="nav-number">2.13.</span> <span class="nav-text">十三、安装虚拟机</span></a></li></ol></li></ol></div>
          </div>
        </section>
      <!--/noindex-->
    </div>
  </aside>
      </div>
    </main>
    <footer id="footer" class="footer">
      <script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https'){
   bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
  }
  else{
  bp.src = 'http://push.zhanzhang.baidu.com/push.js';
  }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
      <div class="footer-inner">
		<div>
  <span>Hosted by <a href="https://pages.coding.me" >Coding Pages</a></span>
</div>
        <div>
		 <span id="runtime_span"></span>
         <script type="text/javascript">function show_runtime(){window.setTimeout("show_runtime()",1000);X=new 
          Date("9/01/2017 5:22:00");
          Y=new Date();T=(Y.getTime()-X.getTime());M=24*60*60*1000;
          a=T/M;A=Math.floor(a);b=(a-A)*24;B=Math.floor(b);c=(b-B)*60;C=Math.floor((b-B)*60);D=Math.floor((c-C)*60);
          runtime_span.innerHTML="本站勉强运行: "+A+"天"+B+"小时"+C+"分"+D+"秒"}show_runtime();</script>
</div>
        <div class="copyright">&copy; 2018 &mdash; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="heart">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">欧阳 Blog</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
      <span class="post-meta-item-text">Site words total count&#58;</span>
    <span title="Site words total count">34.8k</span>
</div>
        <div>
<script type="text/javascript">var cnzz_protocol = (("https:" == document.location.protocol) ? " https://" : " http://");document.write(unescape("%3Cspan id='cnzz_stat_icon_1275871225'%3E%3C/span%3E%3Cscript src='" + cnzz_protocol + "s5.cnzz.com/z_stat.php%3Fid%3D1275871225%26online%3D1%26show%3Dline' type='text/javascript'%3E%3C/script%3E"));</script>
</div>
      </div>
    </footer>
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
          <span id="scrollpercent"><span>0</span>%</span>
      </div>
  </div>
<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
    <script type="text/javascript" src="/lib/canvas-nest/canvas-nest.min.js"></script>
    <script id="ribbon" type="text/javascript" size="300" alpha="0.6"  zIndex="-1" src="/lib/canvas-ribbon/canvas-ribbon.js"></script>
  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/affix.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>
  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item=>{
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: true,
        appId: 'M3FIsxHra6LzE1oYaCEKcSm9-gzGzoHsz',
        appKey: 'QRxIrvy1hxfH540G2W01l5xk',
        placeholder: 'Just Go Go ~~~',
        avatar:'wavatar',
        guest_info:guest,
        pageSize:'10' || 10,
    });
  </script>
  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;
    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }
    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }
    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';
      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');
      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }
                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }
                // show search results
                if (isMatch) {
                  // sort index by position of keyword
                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });
                  // merge hits into slices
                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;
                      // move to next position of hit
                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }
                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }
                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }
                  // sort slices in content by search text's count and hits' count
                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });
                  // select top N slices in content
                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }
                  // highlight title and content
                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }
                  var resultItem = '';
                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }
                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });
                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }
          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }
          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');
          proceedsearch();
        }
      });
    }
    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });
    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>
<script>
(function(){
    var bp = document.createElement('script');
    var curProtocol = window.location.protocol.split(':')[0];
    if (curProtocol === 'https') {
        bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';        
    }
    else {
        bp.src = 'http://push.zhanzhang.baidu.com/push.js';
    }
    var s = document.getElementsByTagName("script")[0];
    s.parentNode.insertBefore(bp, s);
})();
</script>
     <script>var OriginTitile=document.title; var st; document.addEventListener('visibilitychange',function(){ if(document.hidden){ document.title="(つェ⊂)浏览器崩溃了"; clearTimeout(st); console.log('hide'); }else{ document.title='(*´∇｀*)吖~又好了~ '+OriginTitile; console.log('show'); st=setTimeout(function(){ document.title=OriginTitile; },2000); console.log('endChange='); } });</script>
   <script>(function(){
	var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?a03b6dd0b165fe598b2e4f4f456fccda":"https://jspassport.ssl.qhimg.com/11.0.1.js?a03b6dd0b165fe598b2e4f4f456fccda";
	document.write('<script src="' + src + '" id="sozz"><\/script>');
	})();
	</script>
<script src="/live2dw/lib/L2Dwidget.min.js?0c58a1486de42ac6cc1c59c7d98ae887"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"debug":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"left","width":50,"height":100},"mobile":{"show":false},"log":false});</script></body>
</html>
